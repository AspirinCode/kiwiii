{"version":3,"file":"kw-datagrid.js","sources":["../src/common/legacySchema.js","../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/mapper.js","../src/common/collection.js","../src/datagrid/rowFactory.js","../src/common/image.js","../src/datagrid/component.js","../src/component/formBox.js","../src/datagrid.js","../src/datagrid/state.js","../src/datagrid/rowFilter.js","../src/datagrid/sort.js"],"sourcesContent":["\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  if (json.hasOwnProperty('views')) return json;\n  const now = new Date();\n  const isNW = json.hasOwnProperty('edges');\n  const data = isNW ? convertNetwork(json) : convertTable(json);\n  const nodes = isNW ? data.nodes : data;\n  const specs = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n    name: data.edges.name,\n    views: [],\n    dataset: []\n  };\n  specs.dataset.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n    collectionID: nodes.id,\n    name: nodes.name,\n    contents: [{\n      $schema: nodes.$schema,\n      workflowID: nodes.reference.workflow,\n      name: nodes.name,\n      fields: nodes.fields,\n      records: nodes.records,\n      created: nodes.created,\n      status: nodes.status,\n      query: nodes.query,\n      execTime: nodes.execTime,\n      progress: nodes.progress\n    }]\n  });\n  specs.views.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n    viewID: nodes.id,\n    name: nodes.name,\n    viewType: \"datagrid\",\n    rows: nodes.id,\n    fields: nodes.fields,\n    sortOrder: null,\n    filterText: null,\n    checkpoints: [{\n      type: 'convert',\n      date: now.toString(),\n      description: 'converted from legacy format'\n    }]\n  });\n  if (isNW) {\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: data.edges.id,\n      name: data.edges.name,\n      contents: [{\n        $schema: data.edges.$schema,\n        workflowID: data.edges.reference.workflow,\n        name: data.edges.name,\n        fields: data.edges.fields,\n        records: data.edges.records,\n        created: data.edges.created,\n        status: data.edges.status,\n        query: data.edges.query,\n        execTime: data.edges.execTime,\n        progress: data.edges.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: data.edges.id,\n      name: data.edges.name,\n      viewType: \"network\",\n      nodes: nodes.id,\n      edges: data.edges.id,\n      nodeColor: data.edges.snapshot.nodeColor,\n      nodeSize: data.edges.snapshot.nodeSize,\n      nodeLabel: data.edges.snapshot.nodeLabel,\n      nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n      edgeWidth: data.edges.snapshot.edgeWidth,\n      edgeLabel: data.edges.snapshot.edgeLabel,\n      networkThreshold: data.edges.snapshot.networkThreshold,\n      networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n      fieldTransform: data.edges.snapshot.fieldTransform,\n      coords: data.edges.snapshot.coords,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n  }\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Returns all views\n * @return {array} view objects\n */\nfunction getAllViews() {\n  return getAllItems()\n    .then(items => _.flatten(items.map(e => e.views)));\n}\n\n\n/**\n * Returns a view\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(viewID) {\n  return getAllViews()\n    .then(views => views.find(e => e.viewID === viewID));\n}\n\n\nfunction getPos(query, key, field) {\n  return getAllItems().then(items => {\n    let pos;\n    let storeID;\n    for (let item of items) {\n      const i = item[field].findIndex(e => e[key] === query);\n      if (i >= 0) {\n        storeID = item.storeID;\n        pos = i;\n        break;\n      }\n    }\n    return [storeID, pos];\n  });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(viewID, viewObj) {\n  return getPos(viewID, 'viewID', 'views').then(pos => {\n    return updateItem(pos[0], item => {\n      item.views.splice(pos[1] + 1, 0, viewObj);\n    });\n  });\n}\n\n\n/**\n * Update view\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(viewID, viewObj) {\n  return getPos(viewID, 'viewID', 'views').then(pos => {\n    return updateItem(pos[0], item => {\n      if (_.isFunction(viewObj)) {\n        viewObj(item.views[pos[1]]);\n      } else {\n        item.views[pos[1]] = viewObj;\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(items.map(e => e.dataset)));\n}\n\n\n/**\n * Returns a collection\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(collID) {\n  return getAllCollections()\n    .then(colls => colls.find(e => e.collectionID === collID));\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object\n */\nfunction appendCollection(collID, collObj) {\n  return getPos(collID, 'collectionID', 'dataset').then(pos => {\n    return updateItem(pos[0], item => {\n      item.dataset.splice(pos[1] + 1, 0, collObj);\n    });\n  });\n}\n\n\n/**\n * Update collection\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(collID, collObj) {\n  return getPos(collID, 'collectionID', 'dataset').then(pos => {\n    return updateItem(pos[0], item => {\n      if (_.isFunction(collObj)) {\n        collObj(item.dataset[pos[1]]);\n      } else {\n        item.dataset[pos[1]] = collObj;\n      }\n    });\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4().slice(0, 8);\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItem, putItem, updateItem, deleteItem,\n  getAllViews, getView, appendView, updateView,\n  getAllCollections, getCollection, appendCollection, updateCollection,\n  reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.name = coll.name || null;\n    this.contents = coll.contents || [coll];\n    this.fields = [];\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            if (data.status === 'failure') {  // No data found on server\n              return idb.updateCollection(this.collectionID, coll => {\n                const c = coll.contents.find(e => e.workflowID === query.id);\n                c.status = 'failure';\n              });\n            }\n            return idb.updateCollection(this.collectionID, coll => {\n              const i = coll.contents.findIndex(e => e.workflowID === query.id);\n              coll.contents[i] = data;\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n        .classed('dg-cell', true)\n        .classed('align-middle', true)\n        .classed('text-truncate', true)\n        .style('display', 'inline-block')\n        .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name);\n  selection\n      .style('width', '100%')\n      .dispatch('resize');\n  const pos = Math.floor(state.currentScrollTop / state.rowHeight);\n  state.setScrollPosition(pos);\n  selection.call(updateRows, state);\n}\n\n\nfunction updateRows(selection, state) {\n  selection.select('.dg-body')\n    .style('height', `${state.bodyHeight}px`);\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0);\n        d3.select(this).selectAll('.dg-cell').remove();\n        d3.select(this).call(state.rowFactory(), d, rowIndex);\n      });\n}\n\n\nfunction resizeViewport(selection, state) {\n  selection.select('.dg-viewport').style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.setViewportSize(window.innerHeight - viewportTop - 5);\n  selection.call(resizeViewport, state);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.selectAll('div').remove();\n  selection.on('resize', () => selection.call(resize, state));\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        state.currentScrollTop = this.scrollTop;\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(updateHeader, state);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    state.setScrollPosition(0);\n    selection.call(updateRows, state);\n    selection.select('.dg-viewport').node().scrollTop = 0;\n  };\n  state.updateContentsNotifier();\n}\n\n\n\nexport default {\n  updateHeader, updateRows, resizeViewport, resize, datagrid\n};\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, id, label, size, value) {  // TODO: remove size\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .attr('size', size);\n  selection.call(updateTextBox, value);\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, id, label, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .property('readonly', true);\n  selection.call(updateTextBox, value);\n}\n\n\nfunction textareaBox(selection, id, label, rows, placeholder, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .attr('id', id);\n  selection.call(updateTextareaBox, value);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, id, label, checked) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox')\n      .attr('id', id);\n  box.append('span')\n      .text(label);\n  selection.call(updateCheckBox, checked);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, id, label, min, max, step, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n  selection.call(updateNumberBox, value);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label, value) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n  selection\n      .call(updateColorBox, value)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, id, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .attr('for', id)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept)\n    .attr('id', id);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberBoxValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, fileInputBoxValue\n};\n","\n/** @module datagrid */\n\nimport {default as legacy} from './common/legacySchema.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as component} from './datagrid/component.js';\nimport {default as rowFilter} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\n\n\nexport default {\n  DatagridState, component, rowFilter, sort, legacy\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.contentWidth = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.previousNumViewportRows = null;\n    this.viewportTop = null;\n    this.previousVieportTop = null;\n    this.viewportBottom = null;\n    this.currentScrollTop = 0;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n\n    // Initialize\n    this.applyData();\n  }\n\n  applyData() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b).height;\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n    this.previousNumViewportRows = this.numViewportRows;\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n    this.updateContentsNotifier();\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n    this.updateContentsNotifier();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return Promise.all([\n      idb.updateCollection(this.rows.collectionID, this.rows.export()),\n      idb.updateView(this.viewID, this.export())\n    ]);\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n\n}\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, null, 'Search', 40, null);\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  selection.select('.dg-header').selectAll('.dg-hcell')\n    .filter(d => misc.sortType(d.format) !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n      state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n      selection.call(component.updateRows, state);\n    });\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(component.updateHeader, state)\n      .call(setSort, state);\n  };\n}\n\n\nexport default {\n  setSort\n};\n"],"names":["statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","json","fields","columns","map","e","sort","format","id","name","dataType","schemaVersion","revision","status","records","query","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","text","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","target","v08_graph","nodeContentVisible","d3","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","now","Date","isNW","v08_nodes","width","height","convertTable","specs","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","toString","description","networkThresholdCutoff","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","partialMatch","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","getAllViews","then","flatten","getPos","pos","storeID","item","findIndex","getAllCollections","updateItem","updateFunc","where","equals","modify","catch","err","console","error","version","stores","getItem","first","putItem","misc","slice","put","deleteItem","delete","getView","appendView","viewObj","splice","updateView","isFunction","getCollection","collID","colls","appendCollection","collObj","updateCollection","reset","baseURL","get","url","q","Object","keys","length","JSON","stringify","fetch","credentials","res","Promise","reject","Error","statusText","resolve","response","blob","post","formdata","method","body","serverStatus","server","singleToMulti","mapping","newMapping","entries","m","mappingToTable","mp","concat","entry","rcd","f","tableToMapping","table","ignore","filter","row","csvToMapping","csvString","lines","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","coll","this","autoIndex","content","addField","fs","mapper","command","fetcher","all","sum","some","min","d3Format","selection","record","d3_format","html","compound_id","append","attr","image","checkbox","property","disabled","on","checked","textField","style","call","cellFunc","numeric","raw","assay_id","list","plot","plotCell","vega","View","parse","initialize","node","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","reader","FileReader","onload","event","result","readAsDataURL","text_field","control","svg","rowFactory","cell","classed","updateHeader","state","select","selectAll","remove","visibleFields","enter","d","dispatch","floor","currentScrollTop","rowHeight","setScrollPosition","updateRows","bodyHeight","recordsToShow","keyFunc","exit","merge","each","rowIndex","viewportTop","rowPos","resizeViewport","viewportHeight","resize","getBoundingClientRect","top","setViewportSize","innerHeight","datagrid","scrollTop","previousViewportTop","updateContentsNotifier","applyData","updateFilterNotifier","setFilterText","updateTextBox","updateTextareaBox","updateCheckBox","updateNumberBox","updateColorBox","textBox","textBoxValue","readonlyBox","textareaBox","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","checkBoxValue","numberBox","max","step","numberBoxValue","colorBox","stopPropagation","colorBoxValue","fileInputBox","accept","fileInputBoxValue","DatagridState","view","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","contentWidth","numViewportRows","previousNumViewportRows","previousVieportTop","viewportBottom","fixedViewportHeight","factory","widthfSum","reduce","a","widthf","assign","b","applyOrder","order","orders","applyFilter","ceil","position","ki","obj","updateFields","joinFields","export","component","rowFilter","setFilter","searchBox","setSort","isAsc","setSortOrder","legacy"],"mappings":"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"}