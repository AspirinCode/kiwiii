{"version":3,"file":"kwdatagrid.js","sources":["../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/common/file.js","../src/common/mapper.js","../src/common/image.js","../src/datagrid/rowFactory.js","../src/datagrid/state.js","../src/datagrid/component.js","../src/datagrid/sort.js","../src/datagrid/view.js","../src/common/legacySchema.js","../src/component/button.js","../src/component/modal.js","../src/component/formListBox.js","../src/component/table.js","../src/dialog/fieldConfig.js","../src/component/formBox.js","../src/datagrid/rowfilter.js","../src/dialog/fieldFetch.js","../src/dialog/fieldFile.js","../src/dialog/formGroup.js","../src/dialog/networkgen.js","../src/dialog/rename.js","../src/datagrid/rowFilter.js","../src/datagrid/datagridApp.js","../src/dialog/search.js","../src/dialog/struct.js","../src/dialog/filter.js","../src/dialog/sdf.js","../src/datagrid/newDatagrid.js","../src/datagrid.js"],"sourcesContent":["\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  fetchProgress\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const c = compress ? 'c' : 'r';\n  const ext = json.hasOwnProperty('edges') ? `.gf${c}` :  `.nd${c}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\nimport {default as misc} from './misc.js';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: misc.defaultFieldProperties([keyField].concat(mp.fields)),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: misc.defaultFieldProperties(table.fields\n      .filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key))),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: misc.defaultFieldProperties(fields),\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(misc.defaultFieldProperties(mp.fields))\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nexport default {\n  plotCell, plotThumbnail\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n        .classed('dg-cell', true)\n        .classed('align-middle', true)\n        .style('display', 'inline-block')\n        .style('width', `${field.width}px`)\n        .style('word-wrap', 'break-word');\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, call, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(data) {\n    this.data = data;\n\n    this.fields = null;\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    this.fetchedAssays = [];\n\n    // Snapshot\n    const snp = this.data.snapshot || {sortOrder: [], filterText: null};\n    this.sortOrder = snp.sortOrder || [];\n    this.filterText = snp.filterText || null;\n\n    this.defaultColumnWidth = {\n      numeric: 120,\n      text: 200,\n      none: 200\n    };\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.contentWidth = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.previousNumViewportRows = null;\n    this.viewportTop = null;\n    this.previousVieportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n\n    // Initialize\n    this.applyData();\n  }\n\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n    this.previousNumViewportRows = this.numViewportRows;\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  joinFields(mapping) {\n    mapper.apply(this.data, mapping);\n    this.applyData();\n  }\n\n  applyData() {\n    this.fields = this.data.fields.map(e => {\n      const field = {\n        width: e.width || this.defaultColumnWidth[misc.sortType(e.format)],\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.visibleFields = this.fields.filter(e => e.visible);\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b).height;\n    this.contentWidth = this.visibleFields\n      .reduce((a, b) => ({width: a.width + b.width})).width + this.scrollBarSpace;\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.data.records.slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.data.records.slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  export() {\n    this.data.id = misc.uuidv4();\n    return this.data;\n  }\n\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .style('display', 'inline-block')\n      .style('width', d => `${d.width}px`)\n      .text(d => d.name);\n  selection\n      .style('width', `${state.contentWidth}px`)\n      .dispatch('resize');\n  const vp = selection.select('.dg-viewport');\n  const pos = Math.floor(vp.node().scrollTop / state.rowHeight);\n  state.setScrollPosition(pos);\n  selection.call(updateRows, state);\n}\n\n\nfunction updateRows(selection, state) {\n  selection.select('.dg-body')\n    .style('height', `${state.bodyHeight}px`);\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', \"absolute\")\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0);\n        d3.select(this).selectAll('.dg-cell').remove();\n        d3.select(this).call(state.rowFactory(), d, rowIndex);\n      });\n}\n\n\nfunction resizeViewport(selection, state) {\n  // TODO: set width\n  selection.select('.dg-viewport').style('height', `${state.viewportHeight}px`);\n}\n\n\nexport default {\n  updateHeader, updateRows, resizeViewport\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction numericAsc(a, b) {\n  const fa = parseFloat(a);\n  const fb = parseFloat(b);\n  if (isNaN(fa) || isNaN(fb)) {\n    return String(b).localeCompare(String(a));\n  }\n  return fb - fa;\n}\n\n\nfunction numericDesc(a, b) {\n  return numericAsc(b, a);\n}\n\n\nfunction textAsc(a, b) {\n  return String(b).localeCompare(String(a));\n}\n\n\nfunction textDesc(a, b) {\n  return textAsc(b, a);\n}\n\n\nfunction setSort(selection, state) {\n  selection.select('.dg-header').selectAll('.dg-hcell')\n    .filter(d => misc.sortType(d.format) !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n      state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n      selection.call(component.updateRows, state);\n    });\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(component.updateHeader, state)\n      .call(setSort, state);\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/view */\n\nimport {default as component} from './component.js';\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.setViewportSize(window.innerHeight - viewportTop - 5);\n  selection.call(component.resizeViewport, state);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.selectAll('div').remove();\n  selection.on('resize', () => selection.call(resize, state));\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(component.updateRows, state);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(component.updateHeader, state);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    state.setScrollPosition(0);\n    selection.call(component.updateRows, state);\n    selection.select('.dg-viewport').node().scrollTop = 0;\n  };\n  state.updateContentsNotifier();\n}\n\n\nexport default {\n  resize, datagrid\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\nimport {default as misc} from './misc.js';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: misc.defaultFieldProperties([\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ]),\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.filter(e => e.key === 'structure')\n    .forEach(e => {\n      e.format = 'svg';\n    });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nexport default {\n  convertTable, convertNetwork\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, id, label, type, target) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, id, label, type) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, id, label) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, id, label, target) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, id, label, accept) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label)\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      })\n    .append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, id, label, fields, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(selectBoxItems, fields);\n    selection.call(updateSelectBox, value);\n  }\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, id, label, fields, values) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(checklistBoxItems, fields);\n    selection.call(updateChecklistBox, values);\n  }\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue\n};\n","\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n    selection.append('caption').text(caption);\n  }\n  selection.append('thead').append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter().append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter().append('tr')\n    .merge(rows)\n      .each(function (d) {\n        d3.select(this).selectAll('td').remove();\n        d3.select(this).call(rowFactory, d);\n      });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module dialog/fieldConfig */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as table} from '../component/table.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldconf', title, id);\n}\n\n\nfunction updateRowFunc(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('visible', true)\n    .append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record.visible);\n  const generalFormat = ['text', 'numeric', 'd3_format', 'raw', 'compound_id'];\n  const fs = generalFormat.includes(record.format) ? generalFormat : [record.format];\n  const items = fs.map(e => ({key: e, name: e}));\n  const format = selection.append('td')\n      .classed('format', true);\n  const formatSelect = format.append('select');\n  format.call(lbox.selectBoxItems, items);\n  formatSelect\n      .property('disabled', !generalFormat.includes(record.format))\n      .property('value', record.format);\n  selection.append('td')\n      .classed('d3format', true)\n    .append('input')\n      .attr('size', 10)\n      .property('disabled', record.format === 'd3_format' ? null : true)\n      .property('value', record.d3_format || null);\n  formatSelect\n      .on('change', function () {\n        selection.select('.d3format')\n          .select('input')\n            .property('disabled', this.value !== 'd3_format');\n      });\n}\n\n\nfunction tableRowValue(selection) {\n  const value = {};\n  value.visible = selection.select('.visible')\n    .select('input').property('checked');\n  value.format = selection.select('.format')\n    .select('select').property('value');\n  if (value.format === 'd3_format') {\n    value.d3_format = selection.select('.d3format')\n      .select('input').property('value');\n  }\n  return value;\n}\n\n\nfunction body(selection) {\n  const fields = misc.defaultFieldProperties([\n    {key: 'name', format: 'text'},\n    {key: 'visible', format: 'control'},\n    {key: 'format', format: 'control'},\n    {key: 'd3_format', format: 'control'}\n  ]);\n  selection\n      .call(modal.submitDialog, id, title)\n    .select('.modal-body')\n    .append('table')\n      .classed('field', true)\n      .call(table.render, null, null, fields);\n}\n\n\nfunction updateBody(selection, state) {\n  selection.select('.field')\n      .call(table.updateContents, state.fields, d => d.key, updateRowFunc);\n}\n\n\nfunction value(selection) {\n  const fields = [];\n  selection.select('tbody').selectAll('tr')\n    .each(function (d) {\n      const field = tableRowValue(d3.select(this));\n      field.key = d.key;\n      field.name = d.name;\n      fields.push(field);\n    });\n  return fields;\n}\n\n\nexport default {\n  menuLink, updateRowFunc, body, updateBody, value\n};\n","\n/** @module component/formBox */\n\n\nfunction textBox(selection, id, label, size, value) {  // TODO: remove size\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .attr('size', size);\n  selection.call(updateTextBox, value);\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, id, label, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .property('readonly', true);\n  selection.call(updateTextBox, value);\n}\n\n\nfunction textareaBox(selection, id, label, rows, placeholder, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .attr('id', id);\n  selection.call(updateTextareaBox, value);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, id, label, checked) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox')\n      .attr('id', id);\n  box.append('span')\n      .text(label);\n  selection.call(updateCheckBox, checked);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, id, label, min, max, step, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n  selection.call(updateNumberBox, value);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, id, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .attr('for', id)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept)\n    .attr('id', id);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberBoxValue,\n  fileInputBox, fileInputBoxValue\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, null, 'Search', 40, null);\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\n\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport DatagridState from '../datagrid/state.js';\nimport {default as component} from '../datagrid/component.js';\nimport {default as view} from '../datagrid/view.js';\nimport {default as rowf} from '../datagrid/rowfilter.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Append assays';\nlet state = null;\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldfetch', title, id);\n}\n\n\nfunction body(selection, schema, fetchedAssays) {\n  const rsrcs = schema.resources.filter(e => e.domain === 'assay');\n  const assays = _(rsrcs.map(e => e.data))\n    .flatten()\n    .uniqBy('assay_id')\n    .value();\n  const data = {\n    fields: misc.defaultFieldProperties([\n      {key: 'check', name: 'Check', format: 'checkbox', disabled: 'check_d', width: 70, height: 40},\n      {key: 'assay_id', name: 'Assay ID', format: 'assay_id', width: 100},\n      {key: 'name', name: 'Name', format: 'text', width: 100},\n      {key: 'tags', name: 'Tags', format: 'list', width: 150}\n    ]),\n    records: assays.map(e => {\n      e.check = fetchedAssays.includes(e.assay_id);\n      e.check_d = fetchedAssays.includes(e.assay_id);\n      return e;\n    })\n  };\n  const dialog = selection.call(modal.submitDialog, id, title);\n  state = new DatagridState(data);\n  const body = dialog.select('.modal-body');\n  const filter = body.append('div').classed('fetchd-filter', true);\n  const dg = body.append('div').classed('fetchd-dg', true);\n  dg.call(view.datagrid, state);\n  filter.call(rowf.setFilter, state);\n  state.fixedViewportHeight = 200;\n  dg.call(component.resizeViewport, state);\n}\n\n\nfunction updateBody(selection, fetchedAssays) {\n  state.data.records.forEach(e => {\n    e.check_d = fetchedAssays.includes(e.assay_id);\n  });\n  state.updateContentsNotifier();\n}\n\n\nfunction queries(selection, targets, compounds) {\n  return state.data.records\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: e.value_types.map(e => e.key)\n        }\n      };\n    });\n}\n\n\n\nexport default {\n  menuLink, body, updateBody, queries\n};\n","\n/** @module dialog/fieldFile */\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as table} from '../component/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Append JSON fields';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldfile', title, id);\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const fileInput = dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'fieldfile-file', 'File', '.json,.csv');\n  const preview = dialog.select('.modal-body').append('div')\n      .classed('preview', true)\n      .call(table.render);\n  fileInput\n      .on('change', () => {\n        const file = box.fileInputBoxValue(fileInput);\n        const isCsv = file.name.split('.').pop() === 'csv';\n        hfile.readFile(file)\n          .then(res => {\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            preview.call(table.updateHeader, tbl.fields, tbl.records.slice(0, 5));\n          });\n      });\n}\n\n\nfunction readFile(selection) {\n  const file = box.fileInputBoxValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, readFile\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection, id, resources) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-format`, 'Format',\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ], 'molfile');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-source`, 'Source', res, null);\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, `${id}-textquery`, 'Query', null, '');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, `${id}-areaquery`, 'Query', 6, null, '');\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, `${id}-preview`, 'Structure preview', 'primary');\n  selection.call(updateQueryMolGroup);\n}\n\nfunction updateQueryMolGroup(selection) {\n  selection.select('.format')\n    .on('change', function () {\n      const value = lbox.selectBoxValue(d3.select(this));\n      selection.select('.source')\n        .select('select')\n          .property('disabled', value !== 'dbid');\n      selection.select('.textquery')\n          .property('hidden', value !== 'dbid');\n      selection.select('.areaquery')\n          .property('hidden', value !== 'molfile');\n    })\n    .dispatch('change');\n  selection.select('.preview')\n    .on('click', function () {\n      const query = queryMolGroupValue(selection);\n      return fetcher.get('strprev', query)\n        .then(fetcher.text)\n        .then(res => d3.select('#previmg').html(res), fetcher.error);\n    });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\n\nfunction simOptionGroup(selection, id) {\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, `${id}-ignoreh`, 'Ignore explicit hydrogens', true);\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-timeout`, 'Timeout', 1, 999, 1, 2);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-diam`, 'Diameter (MCS-DR/GLS)', 4, 999, 1, 8);\n  collapse.append('div')\n      .classed('tree', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-tree`, 'Max tree size (MCS-DR/GLS)', 20, 999, 1, 40);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const tree = selection.select('.tree');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxValue(diam);\n  }\n  if (!tree.select('input').property('disabled')) {\n    query.maxTreeSize = box.numberBoxValue(tree);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue,\n  simOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldconf', title, id);\n}\n\n\nfunction body(selection, rdk) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'networkgen-measure', 'Measure', measures, 'gls');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'networkgen-thld', 'Threshold',\n            0.5, 1, 0.01, 0.5);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup, 'networkgen');\n  // Events\n  dialog.select('.measure')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        dialog.selectAll('.diam, .tree')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        dialog.select('.timeout')\n          .select('input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      })\n      .dispatch('change');\n}\n\n\nfunction queryParams(selection) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxValue(thld);\n  }\n  return params;\n}\n\n\n\nexport default {\n  menuLink, body, queryParams\n};\n","\n/** @module dialog/rename */\n\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'rename', title, id);\n}\n\n\nfunction body(selection, name) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'rename', 'New name', 40, name);\n}\n\n\nfunction updateBody(selection, state) {\n  selection.select('.rename')\n      .call(box.updateTextBox, state.data.name);\n}\n\n\nfunction value(selection) {\n  return box.textBoxValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, null, 'Search', 40, null);\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as core} from '../common/core.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as legacy} from '../common/legacySchema.js';\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as fieldConfigDialog} from '../dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from '../dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from '../dialog/fieldFile.js';\nimport {default as networkgenDialog} from '../dialog/networkgen.js';\nimport {default as renameDialog} from '../dialog/rename.js';\n\nimport {default as view} from './view.js';\nimport {default as sort} from './sort.js';\nimport {default as rowf} from './rowFilter.js';\nimport DatagridState from './state.js';\n\n\nfunction app(data, serverStatus, schema) {\n  const menubar = d3.select('#menubar');\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(legacy.convertTable(data));\n  state.serverStatus = serverStatus;\n  state.resourceSchema = schema;\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, null, 'View control', 'primary')\n      .select('.dropdown-menu');\n  menu.append('a')\n      .call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a')\n      .call(fieldFileDialog.menuLink);\n  menu.append('a')\n      .classed('networkgend', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a')\n      .call(renameDialog.menuLink);\n  menu.append('a')\n      .classed('saveview', true)\n      .call(button.dropdownMenuItem, null, 'Save');\n  menu.append('a')\n      .classed('exportjson', true)\n      .call(button.dropdownMenuItem, null, 'Download JSON');\n  menu.append('a')\n      .classed('exportexcel', true)\n      .call(button.dropdownMenuItem, null, 'Download Excel');\n  // Open control panel\n  menubar.append('a')\n      .call(button.menuButtonLink, null, 'Control panel', 'outline-secondary')\n      .attr('href', 'control.html')\n      .attr('target', '_blank');\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink, null, 'Refresh', 'outline-secondary');\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink, null, 'Abort server job', 'warning')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n  menubar.append('span').classed('progress', true)\n    .append('progress')\n      .attr('max', 100);\n  menubar.append('span').classed('title', true);\n  menubar.append('span').classed('status', true);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body, schema, state.fetchedAssays);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body, serverStatus.rdkit);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body, state.data.name);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(\n        modal.confirmDialog, 'abort-dialog',\n        'Are you sure you want to abort this calculation job?'\n      );\n\n  // Contents\n  d3.select('#datagrid')\n      .call(view.datagrid, state)\n      .call(sort.setSort, state);\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n\n  // Resize window\n  d3.select('#datagrid').dispatch('resize');\n  window.onresize = () => d3.select('#datagrid').dispatch('resize');\n\n  updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  d3.select('#loading-icon').style('display', 'none');\n\n  // Title\n  d3.select('title').text(state.data.name);\n\n  // Menubar\n  const menubar = d3.select('#menubar');\n  menubar.select('.saveview')\n      .on('click', function () {\n        if (state.data.storeID) {\n          return idb.updateItem(state.data.storeID, item => {\n            item.id = misc.uuidv4();\n            item.name = state.data.name;\n            item.fields = state.data.fields;\n            item.records = state.data.records;\n          })\n          .then(() => console.info('Datagrid saved'));\n        } else {\n          return idb.putItem(state.export())\n            .then(storeID => {\n              window.location = `datagrid.html?id=${storeID}`;\n            });\n        }\n      });\n  menubar.select('.exportjson')\n      .on('click', () => {\n        const data = state.export();\n        // Delete local store information\n        delete data.storeID;\n        hfile.downloadJSON(data, data.name);\n      });\n  menubar.select('.exportexcel')\n      .on('click', () => {\n        const data = state.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(data)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => hfile.downloadDataFile(blob, `${data.name}.xlsx`));\n      });\n\n  menubar.select('.title').text(state.data.name);\n  menubar.select('.status')\n      .text(`(${state.data.status} - ${state.data.records.length} records found in ${state.data.execTime} sec.)`);\n  menubar.select('.progress').select('progress')\n      .attr('value', state.data.progress)\n      .text(`${state.data.progress}%`);\n  menubar.select('.refresh')\n      .on('click', function () {\n        return core.fetchProgress(state.data.storeID)\n          .then(() => idb.getItemByID(state.data.storeID))\n          .then(item => {\n            state.data = item;\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n\n  // disable on-line commands\n  if (!state.serverStatus.instance) {\n    menubar.selectAll('.networkgend, .exportexcel')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  }\n\n  // hide fetch commands\n  const ongoing = ['running', 'ready'].includes(state.data.status);\n  menubar.selectAll('.progress, .refresh, .abort')\n    .style('display', ongoing ? null : 'none');\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state)\n      .on('submit', function () {\n        state.data.fields = fieldConfigDialog.value(d3.select(this));\n        state.updateContentsNotifier();\n        updateApp(state);\n      });\n  dialogs.select('.fieldfetchd')\n      .call(fieldFetchDialog.updateBody, state.fetchedAssays)\n      .on('submit', function () {\n        const targets = state.resourceSchema.resources\n          .filter(e => e.domain === 'activity').map(e => e.id);\n        const compounds = state.data.records.map(e => e.compound_id);\n        const queries = fieldFetchDialog.queries(d3.select(this), targets, compounds);\n        const futures = queries.map(q => {\n          return fetcher.get(q.workflow, q)\n            .then(fetcher.json)\n            .then(data => {\n              return mapper.tableToMapping(\n                data, 'compound_id', ['index', 'assay_id']);\n            });\n        });\n        Promise.all(futures).then(mps => {\n          mps.forEach(mp => state.joinFields(mp));\n          state.updateContentsNotifier();\n          state.fetchedAssays = queries.map(e => e.assay_id);\n          updateApp(state);\n        });\n      });\n  dialogs.select('.fieldfiled')\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n  dialogs.select('.netgend')\n      .on('submit', function () {\n        const formData = new FormData();\n        const params = networkgenDialog.queryParams(d3.select(this));\n        formData.append('params', JSON.stringify(params));\n        formData.append('contents', new Blob([JSON.stringify(state.export())]));\n        return fetcher.post(`${params.measure}net`, formData)\n          .then(fetcher.json)\n          .then(data => {\n            data.reference.nodes = state.data.storeID;\n            data.fields = misc.defaultFieldProperties(data.fields);\n            return data;\n          })\n          .then(idb.putItem)\n          .then(storeID => {\n            d3.select('#loading-icon').style('display', 'none');\n            window.open(`network.html?id=${storeID}`, '_blank');\n          });\n      });\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state)\n      .on('submit', function () {\n        state.data.name = renameDialog.value(d3.select(this));\n        updateApp(state);\n  });\n  dialogs.select('.abortd')\n      .on('submit', function () {\n        core.fetchProgress(state.data.storeID, 'abort')\n          .then(() => idb.getItemByID(state.data.storeID))\n          .then(item => {\n            state.data = item;\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n}\n\n\nexport default {\n  app, updateApp\n};\n","\n/** @module dialog/search */\n\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'search-dialog';\nconst title = 'Search by compound ID';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'search', title, id);\n}\n\n\nfunction body(selection, placeholder) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('ids', true)\n      .call(box.textareaBox, 'search-query', 'Query', 20, placeholder, '');\n}\n\n\nfunction query(selection, targets) {\n  return {\n    workflow: 'search',\n    targets: targets,\n    key: 'compound_id',\n    values: box.textareaBoxLines(selection.select('.ids'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/struct */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'struct-dialog';\nconst title = 'Search by structure';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'struct', title, id);\n}\n\n\nfunction body(selection, resources, rdk) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Query molecule\n  dialog.select('.modal-body').append('div')\n      .classed('qmol', true)\n      .call(group.queryMolGroup, 'struct', resources, null);\n  // Search type\n  const methodList = [\n    {key: 'exact', name: 'Exact match'},\n    {key: 'substr', name: 'Substructure'},\n    {key: 'supstr', name: 'Superstructure'},\n    {key: 'gls', name: 'MCS-DR/GLS'}\n  ];\n  if (rdk) {\n    methodList.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    methodList.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  dialog.select('.modal-body').append('div')\n      .classed('method', true)\n      .call(lbox.selectBox, 'struct-method', 'Method', methodList, 'exact');\n  // Measure\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'struct-measure', 'Measure',\n            [\n              {key: 'sim', name: 'Similarity'},\n              {key: 'edge', name: 'Edge count'}\n            ], 'sim');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'struct-thld', 'Threshold',\n            0.5, 1, 0.01, 0.5);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup, 'struct');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n\n  // Events\n  dialog.select('.method')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        const mcs = ['gls', 'rdfmcs'].includes(value);\n        dialog.select('.measure')\n          .select('select')\n            .property('value', mcs ? undefined : 'sim')\n            .property('disabled', !mcs);\n        dialog.selectAll('.thld')\n          .select('input')\n            .property('disabled', ['exact', 'substr', 'supstr'].includes(value));\n        dialog.selectAll('.diam, .tree')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        dialog.select('.timeout')\n          .select('input')\n            .property('disabled', !mcs);\n      })\n      .dispatch('change');\n}\n\n\nfunction query(selection) {\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxValue(thld);\n  }\n  const query = {\n    workflow: lbox.selectBoxValue(selection.select('.method')),\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    queryMol: group.queryMolGroupValue(selection.select('.qmol')),\n    params: params\n  };\n  return query;\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/filter */\n\nimport _ from 'lodash';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'filter-dialog';\nconst title = 'Search by properties';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'prop', title, id);\n}\n\n\nfunction body(selection, resources) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const fields = _(resources.map(e => e.fields))\n    .flatten()\n    .uniqBy('key')\n    .value()\n    .filter(e => e.hasOwnProperty('d3_format')\n                 || ['compound_id', 'numeric', 'text'].includes(e.format));\n  dialog.select('.modal-body').append('div')\n    .classed('key', true)\n    .call(lbox.selectBox, 'filter-field', 'Field', fields, null);\n  dialog.select('.modal-body').append('div')\n    .classed('operator', true)\n    .call(lbox.selectBox, 'filter-op', 'Operator',\n          [\n            {key: 'eq', name: '='},\n            {key: 'gt', name: '>'},\n            {key: 'lt', name: '<'},\n            {key: 'ge', name: '>='},\n            {key: 'le', name: '>='},\n            {key: 'lk', name: 'LIKE'}\n          ], 'eq');\n  dialog.select('.modal-body').append('div')\n    .classed('value', true)\n    .call(box.textBox, 'filter-value', 'Value', null, '');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n}\n\n\nfunction query(selection) {\n  return {\n    workflow: 'filter',\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    key: lbox.selectBoxValue(selection.select('.key')),\n    value: box.textBoxValue(selection.select('.value')),\n    operator: lbox.selectBoxValue(selection.select('.operator'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/sdf */\n\nimport d3 from 'd3';\n\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nfunction getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n\n\nconst id = 'sdf-dialog';\nconst title = 'Import SDFile';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'sdf', title, id);\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'sdf-file', 'File', '.mol,.sdf');\n  dialog.select('.modal-body').append('div')\n      .classed('field', true)\n      .call(lbox.checklistBox, 'sdf-fields', 'Fields', [], null);\n  dialog.select('.modal-body').append('div')\n      .classed('implh', true)\n      .call(box.checkBox, 'sdf-implh', 'Make hydrogens implicit', true);\n  dialog.select('.modal-body').append('div')\n      .classed('recalc', true)\n      .call(box.checkBox, 'sdf-recalc', 'Recalculate 2D coords', false);\n\n  dialog.select('.file')\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        // Scan only first 100mb of the file due to memory limit.\n        return hfile.readFile(file, 100 * 1024 * 1024, false)\n          .then(data => {\n            const fields = getSDFPropList(data)\n              .map(e => ({key: e, name: e}));\n            dialog.select('.field')\n              .call(lbox.checklistBoxItems, fields);\n          });\n      });\n}\n\n\nfunction queryFormData(selection) {\n  const params = {\n    fields: lbox.checklistBoxValue(selection.select('.field')),\n    implh: box.checkBoxValue(selection.select('.implh')),\n    recalc: box.checkBoxValue(selection.select('.recalc'))\n  };\n  const formData = new FormData();\n  formData.append('contents', box.fileInputBoxValue(selection.select('.file')));\n  formData.append('params', JSON.stringify(params));\n  return formData;\n}\n\n\n\nexport default {\n  menuLink, body, queryFormData\n};\n","\n/** @module datagrid/newDatagrid */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\n\nimport {default as searchDialog} from '../dialog/search.js';\nimport {default as structDialog} from '../dialog/struct.js';\nimport {default as filterDialog} from '../dialog/filter.js';\nimport {default as sdfDialog} from '../dialog/sdf.js';\n\nimport {default as datagridApp} from './datagridApp.js';\n\n\nfunction registerWorkflow(fetched) {\n  return fetcher.json(fetched)\n    .then(data => {\n      data.fields = misc.defaultFieldProperties(data.fields);\n      return data;\n    })\n    .then(idb.putItem)\n    .then(storeID => {\n      window.location = `datagrid.html?id=${storeID}`;\n    });\n  }\n\n\nfunction app(serverStatus, schema) {\n  const menubar = d3.select('#menubar');\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  // New datagrid menu\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, null, '+ New datagrid', 'primary')\n      .select('.dropdown-menu');\n  menu.append('a')\n      .classed('searchd', true)\n      .call(searchDialog.menuLink);\n  menu.append('a')\n      .classed('structd', true)\n      .call(structDialog.menuLink);\n  menu.append('a')\n      .classed('filterd', true)\n      .call(filterDialog.menuLink);\n  menu.append('a')\n      .classed('sdfd', true)\n      .call(sdfDialog.menuLink);\n  menu.append('a')\n      .classed('import', true)\n      .call(button.dropdownMenuFile, 'import', 'Import JSON', '.ndc,.ndr,.json,.gz')\n      .on('change', function () {\n        const file = button.dropdownMenuFileValue(d3.select(this));\n        hfile.loadJSON(file)\n          .then(item => datagridApp.app(item, serverStatus, schema));\n      });\n  // Control panel\n  menubar.append('a')\n      .call(button.menuButtonLink, null, 'Control panel', 'outline-secondary')\n      .attr('href', 'control.html')\n      .attr('target', '_blank');\n\n  // disable on-line commands\n  if (!serverStatus.instance) {\n    menu.selectAll('.searchd, .structd, .filterd, .sdfd')\n      .attr('data-target', null)\n      .classed('disabled', true);\n  }\n\n  // Dialogs\n  const chemrsrc = schema.resources.filter(e => e.domain === 'chemical');\n  // ID search\n  dialogs.append('div')\n      .call(searchDialog.body, schema.compoundIDPlaceholder)\n      .on('submit', function () {\n        const targets = chemrsrc.map(e => e.id);\n        const query = searchDialog.query(d3.select(this), targets);\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);  // TODO: if err -> show err img\n      });\n  // Structure search\n  dialogs.append('div')\n      .call(structDialog.body, chemrsrc, serverStatus.rdkit)\n      .on('submit', function () {\n        const query = structDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);\n      });\n  // Filter\n  dialogs.append('div')\n      .call(filterDialog.body, chemrsrc)\n      .on('submit', function () {\n        const query = filterDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);\n      });\n  // Import SDFile\n  dialogs.append('div')\n      .call(sdfDialog.body, chemrsrc)\n      .on('submit', function () {\n        const formData = sdfDialog.queryFormData(d3.select(this));\n        return fetcher.post('sdfin', formData)\n          .then(registerWorkflow);\n      });\n}\n\n\nexport default {\n  app\n};\n","\n/** @module datagrid */\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as view} from './datagrid/view.js';\nimport {default as datagridApp} from './datagrid/datagridApp.js';\nimport {default as newDatagrid} from './datagrid/newDatagrid.js';\n\n\nfunction run() {\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  const response = {};\n  return fetcher.get('server')\n    .then(fetcher.json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => fetcher.get('schema'))\n    .then(fetcher.json)\n    .then(res => {\n      response.schema = res;\n    })\n    .catch(() => {\n      console.info('Server did not respond');\n      response.server = {};\n      response.schema = {\n        resources: [], templates: [], compoundIDPlaceholder: null\n      };\n    })\n    .then(() => {\n      console.info('Off-line mode is disabled for debugging');\n      const storeID = misc.URLQuery().id || null;\n      const dataURL = misc.URLQuery().location || null;\n      if (storeID) {\n        // Load from IndexedDB store\n        core.fetchProgress(storeID, 'update')\n          .then(() => idb.getItemByID(storeID))\n          .then(item => datagridApp.app(item, response.server, response.schema));\n      } else if (dataURL) {\n        // Fetch via HTTP\n        hfile.fetchJSON(dataURL)\n          .then(item => datagridApp.app(item, response.server, response.schema));\n      } else {\n        // New datagrid\n        newDatagrid.app(response.server, response.schema);\n      }\n    });\n}\n\n\nexport default {\n  DatagridState, sort, view, run\n};\n"],"names":["defaultFieldProperties","fields","map","e","hasOwnProperty","name","key","visible","format","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","version","stores","getAllItems","orderBy","reverse","toArray","getItemsByDataType","type","where","equals","sortBy","catch","err","console","error","getItemByID","storeID","first","deleteItem","delete","putItem","data","misc","put","updateItem","updateFunc","modify","reset","then","baseURL","get","url","q","Object","keys","length","JSON","stringify","fetch","credentials","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","fetchProgress","command","id","reference","workflow","fetcher","item","progress","execTime","records","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","event","result","onerror","readAsArrayBuffer","readAsText","parseJSON","compressed","pako","inflate","to","parse","downloadDataFile","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","singleToMulti","mapping","newMapping","entries","forEach","m","created","field","mappingToTable","mp","keyField","concat","entry","rcd","f","i","tableToMapping","table","ignore","Date","filter","row","csvToMapping","csvString","lines","header","shift","now","headerIdx","h","push","line","values","k","Array","apply","fd","uniqBy","plotCell","selection","record","vega","View","initialize","node","run","plotThumbnail","vegaSpec","toImageURL","d3Format","d3_format","html","compound_id","append","attr","image","checkbox","property","disabled","on","this","checked","call","cellFunc","numeric","raw","assay_id","list","plot","img","control","svg","rowFactory","cell","classed","style","width","DatagridState","[object Object]","visibleFields","sortedRecords","filteredRecords","fetchedAssays","snp","snapshot","sortOrder","filterText","defaultColumnWidth","none","defaultColumnHeight","scrollBarSpace","keyFunc","d","index","rowHeight","contentWidth","bodyHeight","viewportHeight","numViewportRows","previousNumViewportRows","viewportTop","previousVieportTop","viewportBottom","fixedViewportHeight","updateContentsNotifier","updateFilterNotifier","factory","applyData","height","ceil","position","previousViewportTop","min","order","ki","findIndex","obj","splice","applyOrder","applyFilter","mapper","assign","reduce","b","orders","some","updateRows","state","select","rows","selectAll","recordsToShow","exit","remove","enter","merge","each","rowIndex","rowPos","updateHeader","dispatch","vp","pos","floor","scrollTop","setScrollPosition","resizeViewport","setSort","isAsc","setSortOrder","component","resize","getBoundingClientRect","top","setViewportSize","innerHeight","datagrid","setFilterText","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","columns","sort","dataType","schemaVersion","revision","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","startDate","responseDate","v10_nodes","convertTable","structure","_structure","_index","v08_nodes","$schema","convertNetwork","edges","nodes","nodeFields","fieldTransform","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","find","column","domain","range","unknown","size","nodeContent","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","message","base","footer","submitDialog","title","selectBoxItems","options","updateSelectBox","checklistBoxItems","listitems","form","updateChecklistBox","selectBox","selectBoxValue","checklistBox","checklistBoxValue","updateContents","undefined","updateRowFunc","render","caption","generalFormat","formatSelect","lbox","menuLink","button","modal","updateBody","tableRowValue","updateTextBox","updateTextareaBox","updateCheckBox","updateNumberBox","textBox","textBoxValue","readonlyBox","textareaBox","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","checkBoxValue","numberBox","max","step","numberBoxValue","fileInputBox","fileInputBoxValue","setFilter","searchBox","rsrcs","resources","assays","flatten","check","check_d","dialog","dg","rowf","queries","targets","compounds","condition","value_types","fileInput","preview","isCsv","pop","hfile","tbl","plotCols","ps","p","himg","all","updateQueryMolGroup","queryMolGroupValue","textquery","areaquery","queryMolGroup","$","popover","trigger","simOptionGroup","collapse","simOptionGroupValue","timeout","diam","tree","ignoreHs","diameter","maxTreeSize","rdk","measures","group","queryParams","measure","thld","updateApp","menubar","info","export","formData","FormData","core","serverStatus","instance","ongoing","dialogs","fieldConfigDialog","fieldFetchDialog","resourceSchema","futures","mps","joinFields","fieldFileDialog","networkgenDialog","open","renameDialog","app","legacy","menu","rdkit","onresize","methodList","mcs","queryMol","operator","re","uniqCols","Set","arr","exec","add","from","getSDFPropList","queryFormData","implh","recalc","registerWorkflow","fetched","searchDialog","structDialog","filterDialog","sdfDialog","datagridApp","chemrsrc","compoundIDPlaceholder","protocol","navigator","onLine","server","templates","dataURL","newDatagrid"],"mappings":"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"}