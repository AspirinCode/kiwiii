{"version":3,"file":"kwdatagrid.js","sources":["../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/common/file.js","../src/common/legacySchema.js","../src/common/mapper.js","../src/common/image.js","../src/datagrid/rowFactory.js","../src/datagrid/state.js","../src/datagrid/component.js","../src/datagrid/sort.js","../src/datagrid/view.js","../src/component/button.js","../src/component/modal.js","../src/component/formListBox.js","../src/component/table.js","../src/dialog/fieldConfig.js","../src/component/formBox.js","../src/datagrid/rowfilter.js","../src/dialog/fieldFetch.js","../src/dialog/fieldFile.js","../src/dialog/fieldInput.js","../src/dialog/formGroup.js","../src/dialog/networkgen.js","../src/dialog/rename.js","../src/datagrid/rowFilter.js","../src/datagrid/datagridApp.js","../src/dialog/search.js","../src/dialog/struct.js","../src/dialog/filter.js","../src/dialog/sdf.js","../src/datagrid/newDatagrid.js","../src/datagrid.js"],"sourcesContent":["\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  fetchProgress\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const c = compress ? 'c' : 'r';\n  const ext = json.hasOwnProperty('edges') ? `.gf${c}` :  `.nd${c}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\nimport {default as misc} from './misc.js';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: misc.defaultFieldProperties([\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ]),\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nexport default {\n  convertTable, convertNetwork\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\nimport {default as misc} from './misc.js';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: misc.defaultFieldProperties([keyField].concat(mp.fields)),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: misc.defaultFieldProperties(table.fields\n      .filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key))),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: misc.defaultFieldProperties(fields),\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(misc.defaultFieldProperties(mp.fields))\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n        .classed('dg-cell', true)\n        .classed('align-middle', true)\n        .classed('text-truncate', true)\n        .style('display', 'inline-block')\n        .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(data) {\n    this.data = data;\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // Snapshot\n    const snp = this.data.snapshot || {sortOrder: [], filterText: null};\n    this.sortOrder = snp.sortOrder || [];\n    this.filterText = snp.filterText || null;\n\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.contentWidth = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.previousNumViewportRows = null;\n    this.viewportTop = null;\n    this.previousVieportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n\n    // Initialize\n    this.applyData();\n  }\n\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n    this.previousNumViewportRows = this.numViewportRows;\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  joinFields(mapping) {\n    mapper.apply(this.data, mapping);\n    this.applyData();\n  }\n\n  applyData() {\n    this.visibleFields = this.data.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b).height;\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.data.records.slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.data.records.slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  export() {\n    this.data.id = misc.uuidv4();\n    return this.data;\n  }\n\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name);\n  selection\n      .style('width', '100%')\n      .dispatch('resize');\n  const vp = selection.select('.dg-viewport');\n  const pos = Math.floor(vp.node().scrollTop / state.rowHeight);\n  state.setScrollPosition(pos);\n  selection.call(updateRows, state);\n}\n\n\nfunction updateRows(selection, state) {\n  selection.select('.dg-body')\n    .style('height', `${state.bodyHeight}px`);\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0);\n        d3.select(this).selectAll('.dg-cell').remove();\n        d3.select(this).call(state.rowFactory(), d, rowIndex);\n      });\n}\n\n\nfunction resizeViewport(selection, state) {\n  selection.select('.dg-viewport').style('height', `${state.viewportHeight}px`);\n}\n\n\nexport default {\n  updateHeader, updateRows, resizeViewport\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  selection.select('.dg-header').selectAll('.dg-hcell')\n    .filter(d => misc.sortType(d.format) !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n      state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n      selection.call(component.updateRows, state);\n    });\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(component.updateHeader, state)\n      .call(setSort, state);\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/view */\n\nimport {default as component} from './component.js';\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.setViewportSize(window.innerHeight - viewportTop - 5);\n  selection.call(component.resizeViewport, state);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.selectAll('div').remove();\n  selection.on('resize', () => selection.call(resize, state));\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(component.updateRows, state);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyData();\n    selection.call(component.updateHeader, state);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    state.setScrollPosition(0);\n    selection.call(component.updateRows, state);\n    selection.select('.dg-viewport').node().scrollTop = 0;\n  };\n  state.updateContentsNotifier();\n}\n\n\nexport default {\n  resize, datagrid\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, id, label, type, target) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, id, label, type) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, id, label) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, id, label, target) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, id, label, accept) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label)\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      })\n    .append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, id, label, fields, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(selectBoxItems, fields);\n    selection.call(updateSelectBox, value);\n  }\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, id, label, fields, values) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(checklistBoxItems, fields);\n    selection.call(updateChecklistBox, values);\n  }\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue\n};\n","\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n    selection.append('caption').text(caption);\n  }\n  selection.append('thead').append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter().append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter().append('tr')\n    .merge(rows)\n      .each(function (d) {\n        d3.select(this).selectAll('td').remove();\n        d3.select(this).call(rowFactory, d);\n      });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module dialog/fieldConfig */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as table} from '../component/table.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldconf', title, id);\n}\n\n\nfunction updateRowFunc(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('visible', true)\n    .append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record.visible);\n  const generalFormat = ['text', 'numeric', 'd3_format', 'raw', 'compound_id'];\n  const fs = generalFormat.includes(record.format) ? generalFormat : [record.format];\n  const items = fs.map(e => ({key: e, name: e}));\n  const format = selection.append('td')\n      .classed('format', true);\n  const formatSelect = format.append('select');\n  format.call(lbox.selectBoxItems, items);\n  formatSelect\n      .property('disabled', !generalFormat.includes(record.format))\n      .property('value', record.format);\n  selection.append('td')\n      .classed('d3format', true)\n    .append('input')\n      .attr('size', 10)\n      .property('disabled', record.format === 'd3_format' ? null : true)\n      .property('value', record.d3_format || null);\n  formatSelect\n      .on('change', function () {\n        selection.select('.d3format')\n          .select('input')\n            .property('disabled', this.value !== 'd3_format');\n      });\n}\n\n\nfunction tableRowValue(selection) {\n  const value = {};\n  value.visible = selection.select('.visible')\n    .select('input').property('checked');\n  value.format = selection.select('.format')\n    .select('select').property('value');\n  if (value.format === 'd3_format') {\n    value.d3_format = selection.select('.d3format')\n      .select('input').property('value');\n  }\n  return value;\n}\n\n\nfunction body(selection) {\n  const fields = misc.defaultFieldProperties([\n    {key: 'name', format: 'text'},\n    {key: 'visible', format: 'control'},\n    {key: 'format', format: 'control'},\n    {key: 'd3_format', format: 'control'}\n  ]);\n  selection\n      .call(modal.submitDialog, id, title)\n    .select('.modal-body')\n    .append('table')\n      .classed('field', true)\n      .call(table.render, null, null, fields);\n}\n\n\nfunction updateBody(selection, state) {\n  selection.select('.field')\n      .call(table.updateContents, state.data.fields.slice(), d => d.key, updateRowFunc);\n}\n\n\nfunction value(selection) {\n  const fields = [];\n  selection.select('tbody').selectAll('tr')\n    .each(function (d) {\n      const field = tableRowValue(d3.select(this));\n      field.key = d.key;\n      field.name = d.name;\n      fields.push(field);\n    });\n  return fields;\n}\n\n\nexport default {\n  menuLink, updateRowFunc, body, updateBody, value\n};\n","\n/** @module component/formBox */\n\n\nfunction textBox(selection, id, label, size, value) {  // TODO: remove size\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .attr('size', size);\n  selection.call(updateTextBox, value);\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, id, label, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .property('readonly', true);\n  selection.call(updateTextBox, value);\n}\n\n\nfunction textareaBox(selection, id, label, rows, placeholder, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .attr('id', id);\n  selection.call(updateTextareaBox, value);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, id, label, checked) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox')\n      .attr('id', id);\n  box.append('span')\n      .text(label);\n  selection.call(updateCheckBox, checked);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, id, label, min, max, step, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n  selection.call(updateNumberBox, value);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, id, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .attr('for', id)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept)\n    .attr('id', id);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberBoxValue,\n  fileInputBox, fileInputBoxValue\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, null, 'Search', 40, null);\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\n\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport DatagridState from '../datagrid/state.js';\nimport {default as component} from '../datagrid/component.js';\nimport {default as view} from '../datagrid/view.js';\nimport {default as rowf} from '../datagrid/rowfilter.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Append assays';\nlet state = null;\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldfetch', title, id);\n}\n\n\nfunction body(selection, schema) {\n  const rsrcs = schema.resources.filter(e => e.domain === 'assay');\n  const assays = _(rsrcs.map(e => e.data)).flatten().value();\n  const data = {\n    fields: misc.defaultFieldProperties([\n      {key: 'check', name: 'Check', format: 'checkbox', widthf: 0.5, height: 40},\n      {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n      {key: 'name', name: 'Name', format: 'text'},\n      {key: 'tags', name: 'Tags', format: 'list', widthf: 2}\n    ]),\n    records: assays.map(e => {\n      e.check = false;\n      return e;\n    })\n  };\n  const dialog = selection.call(modal.submitDialog, id, title);\n  state = new DatagridState(data);\n  const body = dialog.select('.modal-body');\n  const filter = body.append('div').classed('fetchd-filter', true);\n  const dg = body.append('div').classed('fetchd-dg', true);\n  dg.call(view.datagrid, state);\n  filter.call(rowf.setFilter, state);\n  state.fixedViewportHeight = 200;\n  dg.call(component.resizeViewport, state);\n  const vtypes = _(assays.map(e => e.value_types))\n    .flatten()\n    .uniqBy('key')\n    .value();\n  body.append('div')\n      .classed('my-3', true)\n      .classed('vtype', true)\n      .call(lbox.checklistBox, null, 'Value type', vtypes, ['IC50']);\n}\n\n\nfunction updateBody(selection) {\n  state.data.records.forEach(e => {\n    e.check = false;\n  });\n  state.updateContentsNotifier();\n}\n\n\nfunction queries(selection, targets, compounds) {\n  return state.data.records\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: lbox.checklistBoxValue(selection.select('.vtype'))\n        }\n      };\n    });\n}\n\n\n\nexport default {\n  menuLink, body, updateBody, queries\n};\n","\n/** @module dialog/fieldFile */\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as table} from '../component/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Append JSON fields';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldfile', title, id);\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const fileInput = dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'fieldfile-file', 'File', '.json,.csv');\n  const preview = dialog.select('.modal-body').append('div')\n      .classed('preview', true)\n      .call(table.render);\n  fileInput\n      .on('change', () => {\n        const file = box.fileInputBoxValue(fileInput);\n        const isCsv = file.name.split('.').pop() === 'csv';\n        hfile.readFile(file)\n          .then(res => {\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            preview.call(table.updateHeader, tbl.fields, tbl.records.slice(0, 5));\n          });\n      });\n}\n\n\nfunction readFile(selection) {\n  const file = box.fileInputBoxValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, readFile\n};\n","\n/** @module dialog/fieldInput */\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'fieldinput-dialog';\nconst title = 'Append input field';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldinput', title, id);\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const body = dialog.select('.modal-body');\n  body.append('div')\n      .classed('key', true)\n      .call(box.textBox, null, 'Field key', 40, null);\n  const options = [\n    {key: 'checkbox', name: 'Checkbox'},\n    {key: 'text_field', name: 'Text field'}\n  ];\n  body.append('div')\n      .classed('type', true)\n      .call(lbox.selectBox, null, 'Type', options, 'checkbox');\n\n}\n\n\nfunction updateBody(selection) {\n  selection.select('.key')\n      .call(box.updateTextBox, null);\n  selection.select('.type')\n      .call(lbox.updateSelectBox, 'checkbox');\n}\n\n\nconst defaultValues = {\n  checkbox: false,\n  text_field: ''\n};\n\n\nfunction value(selection) {\n  const key = box.textBoxValue(selection.select('.key'));\n  const type = lbox.selectBoxValue(selection.select('.type'));\n  return {\n    field: {key: key, name: key, format:type},\n    default: defaultValues[type]\n  };\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection, id, resources) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-format`, 'Format',\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ], 'molfile');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-source`, 'Source', res, null);\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, `${id}-textquery`, 'Query', null, '');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, `${id}-areaquery`, 'Query', 6, null, '');\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, `${id}-preview`, 'Structure preview', 'primary');\n  selection.call(updateQueryMolGroup);\n}\n\nfunction updateQueryMolGroup(selection) {\n  selection.select('.format')\n    .on('change', function () {\n      const value = lbox.selectBoxValue(d3.select(this));\n      selection.select('.source')\n        .select('select')\n          .property('disabled', value !== 'dbid');\n      selection.select('.textquery')\n          .property('hidden', value !== 'dbid');\n      selection.select('.areaquery')\n          .property('hidden', value !== 'molfile');\n    })\n    .dispatch('change');\n  selection.select('.preview')\n    .on('click', function () {\n      const query = queryMolGroupValue(selection);\n      return fetcher.get('strprev', query)\n        .then(fetcher.text)\n        .then(res => d3.select('#previmg').html(res), fetcher.error);\n    });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\n\nfunction simOptionGroup(selection, id) {\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, `${id}-ignoreh`, 'Ignore explicit hydrogens', true);\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-timeout`, 'Timeout', 1, 999, 1, 2);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-diam`, 'Diameter (MCS-DR/GLS)', 4, 999, 1, 8);\n  collapse.append('div')\n      .classed('tree', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-tree`, 'Max tree size (MCS-DR/GLS)', 20, 999, 1, 40);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const tree = selection.select('.tree');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxValue(diam);\n  }\n  if (!tree.select('input').property('disabled')) {\n    query.maxTreeSize = box.numberBoxValue(tree);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue,\n  simOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'fieldconf', title, id);\n}\n\n\nfunction body(selection, rdk) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'networkgen-measure', 'Measure', measures, 'gls');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'networkgen-thld', 'Threshold',\n            0.5, 1, 0.01, 0.5);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup, 'networkgen');\n  // Events\n  dialog.select('.measure')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        dialog.selectAll('.diam, .tree')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        dialog.select('.timeout')\n          .select('input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      })\n      .dispatch('change');\n}\n\n\nfunction queryParams(selection) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxValue(thld);\n  }\n  return params;\n}\n\n\n\nexport default {\n  menuLink, body, queryParams\n};\n","\n/** @module dialog/rename */\n\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'rename', title, id);\n}\n\n\nfunction body(selection, name) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'rename', 'New name', 40, name);\n}\n\n\nfunction updateBody(selection, state) {\n  selection.select('.rename')\n      .call(box.updateTextBox, state.data.name);\n}\n\n\nfunction value(selection) {\n  return box.textBoxValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, null, 'Search', 40, null);\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as core} from '../common/core.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as legacy} from '../common/legacySchema.js';\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as fieldConfigDialog} from '../dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from '../dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from '../dialog/fieldFile.js';\nimport {default as fieldInputDialog} from '../dialog/fieldInput.js';\nimport {default as networkgenDialog} from '../dialog/networkgen.js';\nimport {default as renameDialog} from '../dialog/rename.js';\n\nimport {default as view} from './view.js';\nimport {default as sort} from './sort.js';\nimport {default as rowf} from './rowFilter.js';\nimport DatagridState from './state.js';\n\n\nfunction app(data, serverStatus, schema) {\n  const menubar = d3.select('#menubar');\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(legacy.convertTable(data));\n  state.serverStatus = serverStatus;\n  state.resourceSchema = schema;\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, null, 'View control', 'primary')\n      .select('.dropdown-menu');\n  menu.append('a')\n      .call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a')\n      .call(fieldFileDialog.menuLink);\n  menu.append('a')\n      .call(fieldInputDialog.menuLink);\n  menu.append('a')\n      .classed('networkgend', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a')\n      .call(renameDialog.menuLink);\n  menu.append('a')\n      .classed('saveview', true)\n      .call(button.dropdownMenuItem, null, 'Save');\n  menu.append('a')\n      .classed('exportjson', true)\n      .call(button.dropdownMenuItem, null, 'Download JSON');\n  menu.append('a')\n      .classed('exportexcel', true)\n      .call(button.dropdownMenuItem, null, 'Download Excel');\n  // Open control panel\n  menubar.append('a')\n      .call(button.menuButtonLink, null, 'Control panel', 'outline-secondary')\n      .attr('href', 'control.html')\n      .attr('target', '_blank');\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink, null, 'Refresh', 'outline-secondary');\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink, null, 'Abort server job', 'warning')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n  menubar.append('span').classed('progress', true)\n    .append('progress')\n      .attr('max', 100);\n  menubar.append('span').classed('title', true);\n  menubar.append('span').classed('status', true);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body, schema, state.fetchedAssays);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('fieldinputd', true)\n      .call(fieldInputDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body, serverStatus.rdkit);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body, state.data.name);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(\n        modal.confirmDialog, 'abort-dialog',\n        'Are you sure you want to abort this calculation job?'\n      );\n\n  // Contents\n  d3.select('#datagrid')\n      .call(view.datagrid, state)\n      .call(sort.setSort, state);\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n\n  // Resize window\n  d3.select('#datagrid').dispatch('resize');\n  window.onresize = () => d3.select('#datagrid').dispatch('resize');\n\n  updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  d3.select('#loading-icon').style('display', 'none');\n\n  // Title\n  d3.select('title').text(state.data.name);\n\n  // Menubar\n  const menubar = d3.select('#menubar');\n  menubar.select('.saveview')\n      .on('click', function () {\n        if (state.data.storeID) {\n          return idb.updateItem(state.data.storeID, item => {\n            item.id = misc.uuidv4();\n            item.name = state.data.name;\n            item.fields = state.data.fields;\n            item.records = state.data.records;\n          })\n          .then(() => console.info('Datagrid saved'));\n        } else {\n          return idb.putItem(state.export())\n            .then(storeID => {\n              window.location = `datagrid.html?id=${storeID}`;\n            });\n        }\n      });\n  menubar.select('.exportjson')\n      .on('click', () => {\n        const data = state.export();\n        // Delete local store information\n        delete data.storeID;\n        hfile.downloadJSON(data, data.name);\n      });\n  menubar.select('.exportexcel')\n      .on('click', () => {\n        const data = state.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(data)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => hfile.downloadDataFile(blob, `${data.name}.xlsx`));\n      });\n\n  menubar.select('.title').text(state.data.name);\n  menubar.select('.status')\n      .text(`(${state.data.status} - ${state.data.records.length} records found in ${state.data.execTime} sec.)`);\n  menubar.select('.progress').select('progress')\n      .attr('value', state.data.progress)\n      .text(`${state.data.progress}%`);\n  menubar.select('.refresh')\n      .on('click', function () {\n        return core.fetchProgress(state.data.storeID)\n          .then(() => idb.getItemByID(state.data.storeID))\n          .then(item => {\n            state.data = item;\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n\n  // disable on-line commands\n  if (!state.serverStatus.instance) {\n    menubar.selectAll('.networkgend, .exportexcel')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  }\n\n  // hide fetch commands\n  const ongoing = ['running', 'ready'].includes(state.data.status);\n  menubar.selectAll('.progress, .refresh, .abort')\n    .style('display', ongoing ? null : 'none');\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state)\n      .on('submit', function () {\n        state.data.fields = fieldConfigDialog.value(d3.select(this));\n        state.updateContentsNotifier();\n        updateApp(state);\n      });\n  dialogs.select('.fieldfetchd')\n      .call(fieldFetchDialog.updateBody)\n      .on('submit', function () {\n        const targets = state.resourceSchema.resources\n          .filter(e => e.domain === 'activity').map(e => e.id);\n        const compounds = state.data.records.map(e => e.compound_id);\n        const queries = fieldFetchDialog.queries(d3.select(this), targets, compounds);\n        const futures = queries.map(q => {\n          return fetcher.get(q.workflow, q)\n            .then(fetcher.json)\n            .then(data => {\n              return mapper.tableToMapping(\n                data, 'compound_id', ['index', 'assay_id']);\n            });\n        });\n        Promise.all(futures).then(mps => {\n          mps.forEach(mp => state.joinFields(mp));\n          state.updateContentsNotifier();\n          updateApp(state);\n        });\n      });\n  dialogs.select('.fieldfiled')\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n  dialogs.select('.fieldinputd')\n      .on('submit', function () {\n        const value = fieldInputDialog.value(d3.select(this));\n        const field = misc.defaultFieldProperties([value.field])[0];\n        state.data.fields.push(field);\n        state.data.records.forEach(e => {\n          e[field.key] = value.default;\n        });\n        state.applyData();\n        state.updateContentsNotifier();\n        updateApp(state);\n      });\n  dialogs.select('.netgend')\n      .on('submit', function () {\n        const formData = new FormData();\n        const params = networkgenDialog.queryParams(d3.select(this));\n        formData.append('params', JSON.stringify(params));\n        formData.append('contents', new Blob([JSON.stringify(state.export())]));\n        return fetcher.post(`${params.measure}net`, formData)\n          .then(fetcher.json)\n          .then(data => {\n            data.reference.nodes = state.data.storeID;\n            data.fields = misc.defaultFieldProperties(data.fields);\n            return data;\n          })\n          .then(idb.putItem)\n          .then(storeID => {\n            d3.select('#loading-icon').style('display', 'none');\n            window.open(`network.html?id=${storeID}`, '_blank');\n          });\n      });\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state)\n      .on('submit', function () {\n        state.data.name = renameDialog.value(d3.select(this));\n        updateApp(state);\n  });\n  dialogs.select('.abortd')\n      .on('submit', function () {\n        core.fetchProgress(state.data.storeID, 'abort')\n          .then(() => idb.getItemByID(state.data.storeID))\n          .then(item => {\n            state.data = item;\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n}\n\n\nexport default {\n  app, updateApp\n};\n","\n/** @module dialog/search */\n\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'search-dialog';\nconst title = 'Search by compound ID';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'search', title, id);\n}\n\n\nfunction body(selection, placeholder) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('ids', true)\n      .call(box.textareaBox, 'search-query', 'Query', 20, placeholder, '');\n}\n\n\nfunction query(selection, targets) {\n  return {\n    workflow: 'search',\n    targets: targets,\n    key: 'compound_id',\n    values: box.textareaBoxLines(selection.select('.ids'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/struct */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'struct-dialog';\nconst title = 'Search by structure';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'struct', title, id);\n}\n\n\nfunction body(selection, resources, rdk) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Query molecule\n  dialog.select('.modal-body').append('div')\n      .classed('qmol', true)\n      .call(group.queryMolGroup, 'struct', resources, null);\n  // Search type\n  const methodList = [\n    {key: 'exact', name: 'Exact match'},\n    {key: 'substr', name: 'Substructure'},\n    {key: 'supstr', name: 'Superstructure'},\n    {key: 'gls', name: 'MCS-DR/GLS'}\n  ];\n  if (rdk) {\n    methodList.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    methodList.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  dialog.select('.modal-body').append('div')\n      .classed('method', true)\n      .call(lbox.selectBox, 'struct-method', 'Method', methodList, 'exact');\n  // Measure\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'struct-measure', 'Measure',\n            [\n              {key: 'sim', name: 'Similarity'},\n              {key: 'edge', name: 'Edge count'}\n            ], 'sim');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'struct-thld', 'Threshold',\n            0.5, 1, 0.01, 0.5);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup, 'struct');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n\n  // Events\n  dialog.select('.method')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        const mcs = ['gls', 'rdfmcs'].includes(value);\n        dialog.select('.measure')\n          .select('select')\n            .property('value', mcs ? undefined : 'sim')\n            .property('disabled', !mcs);\n        dialog.selectAll('.thld')\n          .select('input')\n            .property('disabled', ['exact', 'substr', 'supstr'].includes(value));\n        dialog.selectAll('.diam, .tree')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        dialog.select('.timeout')\n          .select('input')\n            .property('disabled', !mcs);\n      })\n      .dispatch('change');\n}\n\n\nfunction query(selection) {\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxValue(thld);\n  }\n  const query = {\n    workflow: lbox.selectBoxValue(selection.select('.method')),\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    queryMol: group.queryMolGroupValue(selection.select('.qmol')),\n    params: params\n  };\n  return query;\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/filter */\n\nimport _ from 'lodash';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'filter-dialog';\nconst title = 'Search by properties';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'prop', title, id);\n}\n\n\nfunction body(selection, resources) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const fields = _(resources.map(e => e.fields))\n    .flatten()\n    .uniqBy('key')\n    .value()\n    .filter(e => e.hasOwnProperty('d3_format')\n                 || ['compound_id', 'numeric', 'text'].includes(e.format));\n  dialog.select('.modal-body').append('div')\n    .classed('key', true)\n    .call(lbox.selectBox, 'filter-field', 'Field', fields, null);\n  dialog.select('.modal-body').append('div')\n    .classed('operator', true)\n    .call(lbox.selectBox, 'filter-op', 'Operator',\n          [\n            {key: 'eq', name: '='},\n            {key: 'gt', name: '>'},\n            {key: 'lt', name: '<'},\n            {key: 'ge', name: '>='},\n            {key: 'le', name: '>='},\n            {key: 'lk', name: 'LIKE'}\n          ], 'eq');\n  dialog.select('.modal-body').append('div')\n    .classed('value', true)\n    .call(box.textBox, 'filter-value', 'Value', null, '');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n}\n\n\nfunction query(selection) {\n  return {\n    workflow: 'filter',\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    key: lbox.selectBoxValue(selection.select('.key')),\n    value: box.textBoxValue(selection.select('.value')),\n    operator: lbox.selectBoxValue(selection.select('.operator'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/sdf */\n\nimport d3 from 'd3';\n\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nfunction getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n\n\nconst id = 'sdf-dialog';\nconst title = 'Import SDFile';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, 'sdf', title, id);\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'sdf-file', 'File', '.mol,.sdf');\n  dialog.select('.modal-body').append('div')\n      .classed('field', true)\n      .call(lbox.checklistBox, 'sdf-fields', 'Fields', [], null);\n  dialog.select('.modal-body').append('div')\n      .classed('implh', true)\n      .call(box.checkBox, 'sdf-implh', 'Make hydrogens implicit', true);\n  dialog.select('.modal-body').append('div')\n      .classed('recalc', true)\n      .call(box.checkBox, 'sdf-recalc', 'Recalculate 2D coords', false);\n\n  dialog.select('.file')\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        // Scan only first 100mb of the file due to memory limit.\n        return hfile.readFile(file, 100 * 1024 * 1024, false)\n          .then(data => {\n            const fields = getSDFPropList(data)\n              .map(e => ({key: e, name: e}));\n            dialog.select('.field')\n              .call(lbox.checklistBoxItems, fields);\n          });\n      });\n}\n\n\nfunction queryFormData(selection) {\n  const params = {\n    fields: lbox.checklistBoxValue(selection.select('.field')),\n    implh: box.checkBoxValue(selection.select('.implh')),\n    recalc: box.checkBoxValue(selection.select('.recalc'))\n  };\n  const formData = new FormData();\n  formData.append('contents', box.fileInputBoxValue(selection.select('.file')));\n  formData.append('params', JSON.stringify(params));\n  return formData;\n}\n\n\n\nexport default {\n  menuLink, body, queryFormData\n};\n","\n/** @module datagrid/newDatagrid */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\n\nimport {default as searchDialog} from '../dialog/search.js';\nimport {default as structDialog} from '../dialog/struct.js';\nimport {default as filterDialog} from '../dialog/filter.js';\nimport {default as sdfDialog} from '../dialog/sdf.js';\n\nimport {default as datagridApp} from './datagridApp.js';\n\n\nfunction registerWorkflow(fetched) {\n  return fetcher.json(fetched)\n    .then(data => {\n      data.fields = misc.defaultFieldProperties(data.fields);\n      return data;\n    })\n    .then(idb.putItem)\n    .then(storeID => {\n      window.location = `datagrid.html?id=${storeID}`;\n    });\n  }\n\n\nfunction app(serverStatus, schema) {\n  const menubar = d3.select('#menubar');\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  // New datagrid menu\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, null, '+ New datagrid', 'primary')\n      .select('.dropdown-menu');\n  menu.append('a')\n      .classed('searchd', true)\n      .call(searchDialog.menuLink);\n  menu.append('a')\n      .classed('structd', true)\n      .call(structDialog.menuLink);\n  menu.append('a')\n      .classed('filterd', true)\n      .call(filterDialog.menuLink);\n  menu.append('a')\n      .classed('sdfd', true)\n      .call(sdfDialog.menuLink);\n  menu.append('a')\n      .classed('import', true)\n      .call(button.dropdownMenuFile, 'import', 'Import JSON', '.ndc,.ndr,.json,.gz')\n      .on('change', function () {\n        const file = button.dropdownMenuFileValue(d3.select(this));\n        hfile.loadJSON(file)\n          .then(item => datagridApp.app(item, serverStatus, schema));\n      });\n  // Control panel\n  menubar.append('a')\n      .call(button.menuButtonLink, null, 'Control panel', 'outline-secondary')\n      .attr('href', 'control.html')\n      .attr('target', '_blank');\n\n  // disable on-line commands\n  if (!serverStatus.instance) {\n    menu.selectAll('.searchd, .structd, .filterd, .sdfd')\n      .attr('data-target', null)\n      .classed('disabled', true);\n  }\n\n  // Dialogs\n  const chemrsrc = schema.resources.filter(e => e.domain === 'chemical');\n  // ID search\n  dialogs.append('div')\n      .call(searchDialog.body, schema.compoundIDPlaceholder)\n      .on('submit', function () {\n        const targets = chemrsrc.map(e => e.id);\n        const query = searchDialog.query(d3.select(this), targets);\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);  // TODO: if err -> show err img\n      });\n  // Structure search\n  dialogs.append('div')\n      .call(structDialog.body, chemrsrc, serverStatus.rdkit)\n      .on('submit', function () {\n        const query = structDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);\n      });\n  // Filter\n  dialogs.append('div')\n      .call(filterDialog.body, chemrsrc)\n      .on('submit', function () {\n        const query = filterDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(registerWorkflow);\n      });\n  // Import SDFile\n  dialogs.append('div')\n      .call(sdfDialog.body, chemrsrc)\n      .on('submit', function () {\n        const formData = sdfDialog.queryFormData(d3.select(this));\n        return fetcher.post('sdfin', formData)\n          .then(registerWorkflow);\n      });\n}\n\n\nexport default {\n  app\n};\n","\n/** @module datagrid */\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as legacy} from './common/legacySchema.js';\nimport {default as misc} from './common/misc.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as view} from './datagrid/view.js';\nimport {default as datagridApp} from './datagrid/datagridApp.js';\nimport {default as newDatagrid} from './datagrid/newDatagrid.js';\n\n\nfunction run() {\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  const response = {};\n  return fetcher.get('server')\n    .then(fetcher.json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => fetcher.get('schema'))\n    .then(fetcher.json)\n    .then(res => {\n      response.schema = res;\n    })\n    .catch(() => {\n      console.info('Server did not respond');\n      response.server = {};\n      response.schema = {\n        resources: [], templates: [], compoundIDPlaceholder: null\n      };\n    })\n    .then(() => {\n      console.info('Off-line mode is disabled for debugging');\n      const storeID = misc.URLQuery().id || null;\n      const dataURL = misc.URLQuery().location || null;\n      if (storeID) {\n        // Load from IndexedDB store\n        core.fetchProgress(storeID, 'update')\n          .then(() => idb.getItemByID(storeID))\n          .then(item => datagridApp.app(item, response.server, response.schema));\n      } else if (dataURL) {\n        // Fetch via HTTP\n        hfile.fetchJSON(dataURL)\n          .then(item => datagridApp.app(item, response.server, response.schema));\n      } else {\n        // New datagrid\n        newDatagrid.app(response.server, response.schema);\n      }\n    });\n}\n\n\nexport default {\n  DatagridState, sort, view, run, legacy\n};\n"],"names":["defaultFieldProperties","fields","map","e","hasOwnProperty","name","key","visible","format","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","version","stores","getAllItems","orderBy","reverse","toArray","getItemsByDataType","type","where","equals","sortBy","catch","err","console","error","getItemByID","storeID","first","deleteItem","delete","putItem","data","misc","put","updateItem","updateFunc","modify","reset","then","baseURL","get","url","q","Object","keys","length","JSON","stringify","fetch","credentials","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","fetchProgress","command","id","reference","workflow","fetcher","item","progress","execTime","records","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","event","result","onerror","readAsArrayBuffer","readAsText","parseJSON","compressed","pako","inflate","to","parse","downloadDataFile","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","columns","sort","dataType","schemaVersion","revision","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","created","startDate","responseDate","v10_nodes","convertTable","forEach","i","index","structure","_structure","_index","v08_nodes","$schema","width","height","convertNetwork","edges","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","column","domain","range","unknown","size","nodeContent","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","singleToMulti","mapping","newMapping","entries","m","mappingToTable","mp","keyField","concat","entry","rcd","f","tableToMapping","table","ignore","Date","filter","row","csvToMapping","csvString","lines","header","shift","now","headerIdx","h","push","line","values","k","Array","apply","fd","uniqBy","plotCell","selection","record","vega","View","initialize","node","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","d3Format","d3_format","html","compound_id","append","attr","image","checkbox","property","disabled","on","this","checked","textField","style","call","cellFunc","numeric","raw","assay_id","list","plot","img","text_field","control","svg","rowFactory","cell","classed","DatagridState","[object Object]","visibleFields","sortedRecords","filteredRecords","sortOrder","filterText","defaultColumnHeight","none","scrollBarSpace","keyFunc","d","rowHeight","contentWidth","bodyHeight","viewportHeight","numViewportRows","previousNumViewportRows","viewportTop","previousVieportTop","viewportBottom","fixedViewportHeight","updateContentsNotifier","updateFilterNotifier","factory","applyData","ceil","position","previousViewportTop","min","order","ki","findIndex","obj","splice","applyOrder","applyFilter","mapper","widthfSum","reduce","widthf","assign","b","orders","some","updateRows","state","select","rows","selectAll","recordsToShow","exit","remove","enter","merge","each","rowIndex","rowPos","updateHeader","dispatch","vp","pos","floor","scrollTop","setScrollPosition","resizeViewport","setSort","isAsc","setSortOrder","component","resize","getBoundingClientRect","top","setViewportSize","innerHeight","datagrid","setFilterText","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","message","base","footer","submitDialog","title","selectBoxItems","options","updateSelectBox","checklistBoxItems","listitems","form","updateChecklistBox","selectBox","selectBoxValue","checklistBox","checklistBoxValue","updateContents","undefined","updateRowFunc","render","caption","generalFormat","formatSelect","lbox","menuLink","button","modal","updateBody","tableRowValue","updateTextBox","updateTextareaBox","updateCheckBox","updateNumberBox","textBox","textBoxValue","readonlyBox","textareaBox","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","checkBoxValue","numberBox","max","step","numberBoxValue","fileInputBox","fileInputBoxValue","setFilter","searchBox","rsrcs","resources","assays","flatten","check","dialog","dg","rowf","vtypes","value_types","queries","targets","compounds","check_d","condition","fileInput","preview","isCsv","pop","hfile","tbl","plotCols","ps","p","himg","all","defaultValues","default","updateQueryMolGroup","queryMolGroupValue","textquery","areaquery","queryMolGroup","$","popover","trigger","simOptionGroup","collapse","simOptionGroupValue","timeout","diam","tree","ignoreHs","diameter","maxTreeSize","rdk","measures","group","queryParams","measure","thld","updateApp","menubar","info","export","formData","FormData","core","serverStatus","instance","ongoing","dialogs","fieldConfigDialog","fieldFetchDialog","resourceSchema","futures","mps","joinFields","fieldFileDialog","fieldInputDialog","networkgenDialog","open","renameDialog","app","legacy","menu","fetchedAssays","rdkit","onresize","methodList","mcs","queryMol","operator","re","uniqCols","Set","arr","exec","add","from","getSDFPropList","queryFormData","implh","recalc","registerWorkflow","fetched","searchDialog","structDialog","filterDialog","sdfDialog","datagridApp","chemrsrc","compoundIDPlaceholder","protocol","navigator","onLine","server","templates","dataURL","newDatagrid"],"mappings":"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"}