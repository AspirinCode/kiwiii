// https://github.com/mojaie/kiwiii Version 0.14.0. Copyright 2018 Seiji Matsuoka.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("lodash"),require("jLouvain")):"function"==typeof define&&define.amd?define(["d3","lodash","jLouvain"],t):e["kw-network"]=t(e.d3,e._,e.jLouvain)}(this,function(e,t,o){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var l={defaultFieldProperties:function(e){return e.map(e=>(e.hasOwnProperty("name")||(e.name=e.key),e.hasOwnProperty("visible")||(e.visible=!0),e.hasOwnProperty("d3_format")&&(e.format="d3_format"),e.hasOwnProperty("format")||(e.format="raw"),e))},sortType:function(e){return["numeric","d3_format"].includes(e)?"numeric":["text","compound_id","assay_id","list"].includes(e)?"text":"none"},formatNum:function(t,o){return null==t||Number.isNaN(t)?"":t==parseFloat(t)?e.format(o)(t):t},partialMatch:function(e,t){return null!=t&&""!==t&&-1!==t.toString().toUpperCase().indexOf(e.toString().toUpperCase())},URLQuery:function(){const e=window.location.search.substring(1).split("&").map(e=>e.split("="));return t.fromPairs(e)},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};const a={Queued:"ready","In progress":"running",Aborting:"running",Aborted:"aborted",Completed:"done",Failure:"failure"},s={datatable:"nodes",connection:"edges"};function n(e){const t=e.columns.map(e=>("numeric"===e.sort?e.format="numeric":"text"===e.sort?e.format="text":"none"===e.sort&&(e.format="raw"),e));return{id:e.id,name:e.name,dataType:s[e.format],schemaVersion:.8,revision:0,status:a[e.status],fields:t,records:e.records,query:e.query,taskCount:e.searchCount,doneCount:e.searchDoneCount|e.searchCount,resultCount:e.recordCount,progress:100|e.progress,execTime:e.execTime,created:e.startDate|e.responseDate}}function r(e){return{id:e.id,name:e.name,dataType:e.dataType,schemaVersion:"0.10",revision:e.revision,status:e.status,fields:e.fields,records:e.records,query:e.query,progress:e.progress,execTime:e.execTime,created:e.created,reference:{}}}var c={convertTable:function(e){let t=e;return t.hasOwnProperty("schemaVersion")||t.hasOwnProperty("$schema")||(t=n(t)),"0.8"==t.schemaVersion&&(t=r(t=function(e){return e.records.forEach((e,t)=>{e.index=t,e.structure=e._structure,delete e._index,delete e._structure}),e.fields.forEach(e=>{"_index"===e.key&&(e.key="index"),"_structure"===e.key&&(e.key="structure"),"numeric"===e.sort&&(e.format="numeric"),"text"===e.sort&&(e.format="text"),"none"===e.sort&&(e.format="raw")}),e}(t))),t.hasOwnProperty("$schema")||(delete t.schemaVersion,delete t.revision,t.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json"),t.fields.forEach(e=>{"structure"===e.key&&(e.format="svg"),delete e.width,delete e.height}),t},convertNetwork:function(t){let o=t;return o.edges.hasOwnProperty("schemaVersion")||o.edges.hasOwnProperty("$schema")||(o.nodes=n(o.nodes),o.edges=function(e,t){const o={fieldTransform:e.snapshot.fieldTransform,nodePositions:e.snapshot.nodePositions,nodeColor:{},nodeSize:{},nodeLabel:{},edge:{}};return e.snapshot.hasOwnProperty("nodeColor")?(o.nodeColor.id=e.snapshot.nodeColor.id,o.nodeColor.scale=e.snapshot.nodeColor.scale,o.nodeColor.field=t.find(t=>t.key===e.snapshot.nodeColor.column)):o.nodeColor={id:"color",field:t[0],scale:{scale:"linear",domain:[0,1],range:["black","white"],unknown:"gray"}},e.snapshot.hasOwnProperty("nodeSize")?(o.nodeSize.id=e.snapshot.nodeSize.id,o.nodeSize.scale=e.snapshot.nodeSize.scale,o.nodeSize.field=t.find(t=>t.key===e.snapshot.nodeSize.column)):o.nodeSize={id:"size",field:t[0],scale:{scale:"linear",domain:[0,1],range:[20,20],unknown:20}},e.snapshot.hasOwnProperty("nodeLabel")?(o.nodeLabel.id=e.snapshot.nodeLabel.id,o.nodeLabel.size=e.snapshot.nodeLabel.size,o.nodeLabel.text=e.snapshot.nodeLabel.text,o.nodeLabel.visible=e.snapshot.nodeLabel.visible,o.nodeLabel.scale=e.snapshot.nodeLabel.scale,o.nodeLabel.field=t.find(t=>t.key===e.snapshot.nodeLabel.column)):o.nodeLabel={id:"label",size:12,text:"index",visible:!1,field:t[0],scale:{scale:"linear",domain:[0,1],range:["black","white"],unknown:"gray"}},e.snapshot.hasOwnProperty("nodeContent")?o.nodeContent=e.snapshot.nodeContent:o.nodeContent={structure:{visible:!1}},e.snapshot.hasOwnProperty("edge")?o.edge=e.snapshot.edge:o.edge={id:"label",label:{size:10,visible:!1},visible:!0,scale:{scale:"linear",domain:[0,1],range:[5,5],unknown:5}},{id:e.id,name:e.name,dataType:s[e.format],schemaVersion:.8,revision:0,reference:{nodes:e.nodeTableId},status:a[e.status],fields:l.defaultFieldProperties([{key:"source"},{key:"target"},{key:"weight"}]),records:e.records,query:e.query,networkThreshold:e.networkThreshold,taskCount:e.searchCount,doneCount:e.searchDoneCount|e.searchCount,resultCount:e.recordCount,progress:100|e.progress,execTime:e.execTime,created:e.startDate|e.responseDate,snapshot:o}}(o.edges,o.nodes.fields)),"0.8"!=o.edges.schemaVersion&&.1!==o.edges.schemaVersion||((o=function(e){if(e.edges.hasOwnProperty("reference")||(e.edges.reference={nodes:e.edges.nodesID}),e.nodes.fields.find(e=>"_index"===e.key)){const t={};e.nodes.records.forEach((e,o)=>{e.index=o,e.structure=e._structure,t[e._index]=e.index,delete e._index,delete e._structure}),e.edges.records.forEach(e=>{e.source=t[e.source],e.target=t[e.target]}),e.nodes.fields.forEach(e=>{"_index"===e.key&&(e.key="index"),"_structure"===e.key&&(e.key="structure"),"numeric"===e.sort&&(e.format="numeric"),"text"===e.sort&&(e.format="text"),"none"===e.sort&&(e.format="raw")})}return e}(o)).nodes=r(o.nodes),o.edges=function(t){const o={networkThreshold:t.networkThreshold};return o.nodeContentVisible=t.snapshot.nodeContent.structure.visible,o.nodeColor=t.snapshot.nodeColor.scale||{},o.nodeColor.field&&(o.nodeColor.field=t.snapshot.nodeColor.field.key,"_index"===o.nodeColor.field&&(o.nodeColor.field="index")),"ordinal"===o.nodeColor.scale&&(o.nodeColor.range=e.schemeCategory20),o.nodeSize=t.snapshot.nodeSize.scale||{},t.snapshot.nodeSize.field&&(o.nodeSize.field=t.snapshot.nodeSize.field.key,"_index"===o.nodeSize.field&&(o.nodeSize.field="index")),o.nodeLabel={},t.snapshot.nodeLabel.text&&(o.nodeLabel.text=t.snapshot.nodeLabel.text.key,"_index"===o.nodeLabel.text&&(o.nodeLabel.text="index")),o.nodeLabel.size=t.snapshot.nodeLabel.size,o.nodeLabel.visible=t.snapshot.nodeLabel.visible,o.nodeLabelColor=t.snapshot.nodeLabel.scale||{},t.snapshot.nodeLabel.field&&(o.nodeLabelColor.field=t.snapshot.nodeLabel.field.key,"_index"===o.nodeLabelColor.field&&(o.nodeLabelColor.field="index")),"ordinal"===o.nodeLabelColor.scale&&(o.nodeLabelColor.range=e.schemeCategory20),o.edgeVisible=t.snapshot.edge.visible,o.edgeWidth=t.snapshot.edge.scale||{},o.edgeLabel={},o.edgeLabel.size=t.snapshot.edge.label.size,o.edgeLabel.visible=t.snapshot.edge.label.visible,o.networkThreshold=t.networkThreshold||t.query.threshold,o.coords=t.snapshot.nodePositions,{id:t.id,name:t.name,dataType:t.dataType,schemaVersion:"0.10",revision:t.revision,status:t.status,fields:t.fields,records:t.records,query:{params:t.query},progress:t.progress,execTime:t.execTime,created:t.created,snapshot:o,reference:t.reference}}(o.edges)),o.edges.hasOwnProperty("$schema")||(delete o.nodes.schemaVersion,delete o.edges.schemaVersion,delete o.nodes.revision,delete o.edges.revision,o.nodes.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json",o.edges.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json"),o}};var d={communityDetection:function(e,t,l){if(!t.length){const t={};return e.forEach(e=>{t[e]=l.nulliso?null:e}),t}const a={},s=o().nodes(e).edges(t)();return Object.entries(s).forEach(e=>{a.hasOwnProperty(e[1])||(a[e[1]]=[]),a[e[1]].push(e[0])}),Object.entries(a).sort((e,t)=>e[1].length<t[1].length).forEach((e,t)=>{1===e[1].length?s[e[1][0]]=l.nulliso?null:t:e[1].forEach(e=>{s[e]=t})}),s}};const i=[{key:"linear",name:"Linear",func:e.scaleLinear()},{key:"log",name:"Log",func:e.scaleLog()},{key:"quantize",name:"Quantize",func:e.scaleQuantize()},{key:"ordinal",name:"Ordinal",func:e.scaleOrdinal()}],p=[{key:"continuous",name:"Continuous",size:2},{key:"two-piece",name:"Two-piece",size:3},{key:"category10",name:"Category 10",size:10,range:e.schemeCategory10,unknown:"#f0f0f0"},{key:"category20",name:"Category 20",size:20,range:e.schemePaired.concat(e.schemeSet2),unknown:"#f0f0f0"},{key:"category40",name:"Category 40",size:40,range:e.schemePaired.concat(e.schemePastel2,e.schemeSet2,e.schemeSet3),unknown:"#f0f0f0"}];var u={presets:[{key:"activity",name:"Activity",scale:"log",domain:[1e-4,1e-6]},{key:"percent",name:"Percent",scale:"linear",domain:[0,100]},{key:"tf",name:"True/False",scale:"quantize",domain:[1,0]},{key:"mw",name:"MW",scale:"linear",domain:[200,600]},{key:"logp",name:"LogP",scale:"linear",domain:[-2,8]}],types:i,colorPalettes:[{key:"aquamarine",name:"Aquamarine",range:["#778899","#7fffd4"],unknown:"#f0f0f0"},{key:"chartreuse",name:"Chartreuse",range:["#778899","#7fff00"],unknown:"#f0f0f0"},{key:"salmon",name:"Salmon",range:["#778899","#fa8072"],unknown:"#f0f0f0"},{key:"violet",name:"Violet",range:["#778899","#ee82ee"],unknown:"#f0f0f0"},{key:"temperature",name:"Temperature",range:["#87ceeb","#fff5ee","#fa8072"],unknown:"#f0f0f0"},{key:"spectrum",name:"Spectrum",range:["#6495ed","#ccff66","#ffa500"],unknown:"#f0f0f0"}],colorRangeTypes:p,scaleFunction:function(e){let t=i.find(t=>t.key==e.scale).func,o=e.domain;if(3==e.range.length){const t=(parseFloat(e.domain[0])+parseFloat(e.domain[1]))/2;o=[e.domain[0],t,e.domain[1]]}return"ordinal"!==e.scale&&(t=t.domain(o)),t=t.range(e.range),["linear","log"].includes(e.scale)&&(t=t.clamp(!0)),o=>{if(""===o||null==o)return e.unknown;if("ordinal"!==e.scale&&parseFloat(o)!=o)return e.unknown;if("log"===e.scale&&o<=0)return e.unknown;const l=t(o);return void 0===l?e.unknown:l}}};function f(e,t){e.select("input").property("value",t)}function h(e,t){e.select("textarea").property("value",t)}function m(e,t){e.select("input").property("checked",t)}function g(e,t){e.select("input").property("value",t)}var b={textBox:function(e,t,o,l,a){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("id",t).attr("type","text").attr("size",l),e.call(f,a)},updateTextBox:f,textBoxValue:function(e){return e.select("input").property("value")},readonlyBox:function(e,t,o,l){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("input").classed("form-control-plaintext",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("id",t).attr("type","text").property("readonly",!0),e.call(f,l)},textareaBox:function(e,t,o,l,a,s){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("textarea").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("rows",l).attr("placeholder",a).attr("id",t),e.call(h,s)},updateTextareaBox:h,textareaBoxValue:function(e){const t=e.select("textarea").property("value");if(t)return t;const o=e.select("textarea").attr("placeholder");return o||""},textareaBoxLines:function(e){const t=e.select("textarea").property("value");if(t)return t.split("\n").filter(e=>e.length>0);const o=e.select("textarea").attr("placeholder");return o?o.split("\n").filter(e=>e.length>0):[]},checkBox:function(e,t,o,l){const a=e.classed("form-group",!0).classed("form-row",!0).classed("form-check",!0).append("label").classed("form-check-label",!0).classed("col-form-label-sm",!0);a.append("input").classed("form-check-input",!0).attr("type","checkbox").attr("id",t),a.append("span").text(o),e.call(m,l)},updateCheckBox:m,checkBoxValue:function(e){return e.select("input").property("checked")},numberBox:function(e,t,o,l,a,s,n){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("id",t).attr("type","number").attr("min",l).attr("max",a).attr("step",s),e.call(g,n)},updateNumberBox:g,numberBoxValue:function(e){return e.select("input").property("value")},fileInputBox:function(e,t,o,l){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("form-control-file",!0).classed("col-8",!0).attr("type","file").attr("accept",l).attr("id",t)},fileInputBoxValue:function(e){return e.select("input").property("files")[0]}};function x(e,t){const o=e.select("select").selectAll("option").data(t,e=>e.key);o.exit().remove(),o.enter().append("option").attr("value",e=>e.key).text(e=>e.name)}function y(e,t){e.select("select").property("value",t)}function v(e,t){const o=e.select("ul").selectAll("li").data(t,e=>e.key);o.exit().remove();const l=o.enter().append("li").attr("class","form-check").append("label").attr("class","form-check-label");l.append("input").attr("type","checkbox").attr("class","form-check-input").property("value",e=>e.key),l.append("span").text(e=>e.name)}function k(t,o){o&&t.selectAll("input").each(function(t){e.select(this).property("checked",o.includes(t.key))})}var w={selectBox:function(e,t,o,l,a){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).attr("for",t).text(o),e.append("select").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("id",t),l&&(e.call(x,l),e.call(y,a))},selectBoxItems:x,updateSelectBox:y,selectBoxValue:function(e){return e.select("select").property("value")},checklistBox:function(e,t,o,l,a){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(o),e.append("ul").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("id",t),l&&(e.call(v,l),e.call(k,a))},checklistBoxItems:v,updateChecklistBox:k,checklistBoxValue:function(e){return e.selectAll("input:checked").data().map(e=>e.key)}};function C(e,t){e.select(".min").property("value",t[0]),e.select(".max").property("value",t[1])}function B(e,t){let o;o=2==t.length?[t[0],null,t[1]]:3==t.length?[t[0],t[1],t[2]]:[null,null,null],e.select(".min").property("value",o[0]).property("disabled",null===o[0]).style("opacity",null===o[0]?.3:null),e.select(".mid").attr("value",o[1]).property("disabled",null===o[1]).style("opacity",null===o[1]?.3:null),e.select(".max").property("value",o[2]).property("disabled",null===o[2]).style("opacity",null===o[2]?.3:null)}var L={rangeBox:function(e,t,o,l){e.classed("form-row",!0).classed("align-items-center",!0).attr("id",t),e.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).classed("mb-1",!0).text(o);const a=e.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).classed("mb-1",!0);a.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0).attr("for",`${t}-from`).text("min"),a.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("min",!0).attr("type","text").attr("id",`${t}-from`);const s=e.append("div").classed("form-group",!0).classed("col-4",!0).classed("mb-1",!0);s.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0).attr("for",`${t}-to`).text("max"),s.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("max",!0).attr("type","text").attr("id",`${t}-to`),e.call(C,l)},updateRangeBox:C,rangeBoxValue:function(e){return[parseFloat(e.select(".min").property("value")),parseFloat(e.select(".max").property("value"))]},colorScaleBox:function(t,o,l,a){t.classed("form-row",!0).classed("align-items-center",!0).attr("id",o),t.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-3",!0).classed("mb-1",!0).text(l);const s=t.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-3",!0).classed("mb-1",!0);s.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0).attr("for",`${o}-from`).text("min"),s.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("min",!0).attr("type","color").attr("id",`${o}-from`);const n=t.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-3",!0).classed("mb-1",!0);n.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0).attr("for",`${o}-mid`).text("mid"),n.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("mid",!0).attr("type","color").attr("id",`${o}-mid`);const r=t.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-3",!0).classed("mb-1",!0);r.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0).attr("for",`${o}-to`).text("max"),r.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("max",!0).attr("type","color").attr("id",`${o}-to`),t.call(B,a).on("change",()=>{e.event.stopPropagation()})},updateColorScaleBox:B,colorScaleBoxValue:function(e){const t=[];return e.select(".min").property("disabled")||t.push(e.select(".min").property("value")),e.select(".mid").property("disabled")||t.push(e.select(".mid").property("value")),e.select(".max").property("disabled")||t.push(e.select(".max").property("value")),t}};var z={buttonBox:function(e,t,o,l){e.classed("form-group",!0).classed("mb-1",!0).append("button").classed("btn",!0).classed(`btn-${l}`,!0).classed("btn-sm",!0).attr("id",t).text(o)},menuButton:function(e,t,o,l){e.classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("id",l).text(t)},menuButtonLink:function(e,t,o,l,a){e.classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("role","button").attr("href","#").attr("id",a),e.append("img").attr("src",l?`./assets/icon/${l}.svg`:null).style("width","1.25rem").style("height","1.25rem"),e.append("span").style("vertical-align","middle").text(t)},menuModalLink:function(e,t,o,l,a,s){e.classed("btn",!0).classed(`btn-${l}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("id",s).attr("href","#").attr("role","button").attr("data-toggle","modal").attr("data-target",`#${t}`),e.append("img").attr("src",a?`./assets/icon/${a}.svg`:null).style("width","1.25rem").style("height","1.25rem"),e.append("span").classed("label",!0).style("vertical-align","middle").text(o)},dropdownMenuButton:function(e,t,o,l,a){e.classed("btn-group",!0).classed("mr-1",!0).attr("id",a);const s=e.append("button").classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("dropdown-toggle",!0).attr("data-toggle","dropdown");s.append("img").attr("src",l?`./assets/icon/${l}.svg`:null).style("width","1.25rem").style("height","1.25rem"),s.append("span").style("vertical-align","middle").text(t),e.append("div").classed("dropdown-menu",!0)},dropdownMenuItem:function(e,t,o,l){e.classed("dropdown-item",!0).attr("id",l).attr("href","#"),e.append("img").attr("src",o?`./assets/icon/${o}.svg`:null).classed("mr-1",!0).style("width","2rem").style("height","2rem"),e.append("span").text(t)},dropdownMenuModal:function(e,t,o,l,a){e.classed("dropdown-item",!0).attr("id",a).attr("href","#").attr("data-toggle","modal").attr("data-target",`#${o}`),e.append("img").attr("src",`./assets/icon/${l}.svg`).classed("mr-1",!0).style("width","2rem").style("height","2rem"),e.append("span").text(t)},dropdownMenuFile:function(t,o,l,a,s){t.classed("dropdown-item",!0).attr("id",s).attr("href","#").on("click",function(){e.select(this).select("input").node().click()}),t.append("form").style("display","none").append("input").attr("type","file").attr("accept",l),t.append("img").attr("src",`./assets/icon/${a}.svg`).classed("mr-1",!0).style("width","2rem").style("height","2rem"),t.append("span").text(o)},dropdownMenuFileValue:function(e){return e.select("input").node().files[0]}};function N(t,o){t.select(".palette").call(w.updateSelectBox,u.colorRangeTypes.find(e=>e.size===o.length).key).on("change",function(){const o=w.selectBoxValue(e.select(this)),l=u.colorPalettes.find(e=>e.key===o),a=u.colorRangeTypes.find(e=>e.size===l.range.length);t.select(".rangetype").call(w.updateSelectBox,a.key),t.select(".range").call(L.updateColorScaleBox,l.range)}),t.select(".rangetype").on("change",function(){const o=w.selectBoxValue(e.select(this)),l=u.colorRangeTypes.find(e=>e.key===o).size;t.select(".range").select(".min").property("disabled",l>3).style("opacity",l<=3?null:.3),t.select(".range").select(".mid").property("disabled",3!==l).style("opacity",3===l?null:.3),t.select(".range").select(".max").property("disabled",l>3).style("opacity",l<=3?null:.3)}),t.select(".range").call(L.updateColorScaleBox,o).on("focusin",()=>{t.dispatch("change")})}function S(t,o,l){t.select(".preset").on("change",function(){const o=w.selectBoxValue(e.select(this)),l=u.presets.find(e=>e.key==o);t.select(".scale").call(w.updateSelectBox,l.scale),t.select(".domain").call(L.updateRangeBox,l.domain)}),t.select(".scale").call(w.updateSelectBox,o).on("change",()=>{t.select(".domain").dispatch("change")}),t.select(".domain").call(L.updateRangeBox,l).on("change",function(){const o="log"===w.selectBoxValue(t.select(".scale")),l=L.rangeBoxValue(e.select(this)),a=e=>isNaN(e)||o&&e<=0;e.select(this).select(".min").style("background-color",a(l[0])?"#ffcccc":"#ffffff"),e.select(this).select(".max").style("background-color",a(l[1])?"#ffcccc":"#ffffff")})}var V={colorRangeGroup:function(e,t,o,l,a){e.classed("mb-3",!0),e.append("div").classed("palette",!0).classed("mb-1",!0).call(w.selectBox,`${t}-palette`,"Color palette",o,"hoge"),e.append("div").classed("rangetype",!0).classed("mb-1",!0).call(w.selectBox,`${t}-rangetype`,"Range type",l,u.colorRangeTypes.find(e=>e.size===a.length).key),e.append("div").classed("range",!0).classed("mb-1",!0).call(L.colorScaleBox,`${t}-range`,"Range",a),e.call(N,a)},updateColorRangeGroup:N,colorRangeGroupValue:function(e){const t=w.selectBoxValue(e.select(".rangetype")),o=L.colorScaleBoxValue(e.select(".range"));return o.length?o:u.colorRangeTypes.find(e=>e.key===t).range},scaleBoxGroup:function(e,t,o,l,a,s){e.classed("mb-3",!0),e.append("div").classed("preset",!0).classed("mb-1",!0).call(w.selectBox,`${t}-preset`,"Scale preset",o,""),e.append("div").classed("scale",!0).classed("mb-1",!0).call(w.selectBox,`${t}-scale`,"Scale type",l,a),e.append("div").classed("domain",!0).classed("mb-1",!0).call(L.rangeBox,`${t}-domain`,"Domain",s),e.call(S,a,s)},updateScaleBoxGroup:S,scaleBoxGroupValue:function(e){return{scale:w.selectBoxValue(e.select(".scale")),domain:L.rangeBoxValue(e.select(".domain"))}}};function T(e,t){e.append("div").classed("mb-3",!0).append("div").classed("fit",!0).call(z.buttonBox,"fit-to-screen","Fit to screen","primary");const o=e.append("div").classed("mb-3",!0);o.append("div").classed("focused",!0).classed("mb-1",!0).call(b.checkBox,"focused","Enable focused view",t.enableFocusedView),o.append("div").classed("overlook",!0).classed("mb-1",!0).call(b.checkBox,"overlook","Enable overlook view",t.enableOverlookView);const l=e.append("div").classed("mb-3",!0);l.append("div").classed("thld",!0).classed("mb-1",!0).call(b.numberBox,"thld","Network threshold",t.networkThresholdCutoff,1,.01,t.networkThreshold),l.append("div").classed("logd",!0).classed("mb-1",!0).call(b.readonlyBox,"logd","logD",null);const a=e.append("div").classed("form-group",!0).classed("form-row",!0);a.append("div").classed("col-6",!0).append("span").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("mb-1",!0).text("Temperature"),a.append("div").classed("col-12",!0).append("div").classed("temperature",!0).classed("progress",!0).append("div").classed("progress-bar",!0).classed("w-30",!0).attr("id","temperature").attr("role","progressbar").attr("aria-valuemin",0).attr("aria-valuemax",100),a.append("div").classed("col-12",!0).append("div").classed("stick",!0).classed("mb-1",!0).call(b.checkBox,"stick-nodes","Stick nodes",!t.simulationOnLoad),a.append("div").classed("col-12",!0).append("div").classed("restart",!0).classed("mb-1",!0).call(z.buttonBox,"restart-force","Activate","warning"),e.call(A,t)}function A(t,o){t.select(".snapshot").on("click",function(){o.snapshotNotifier()}),t.select(".fit").on("click",function(){o.fitNotifier()}),t.select(".focused").call(b.updateCheckBox,o.enableFocusedView).on("change",function(){o.enableFocusedView=b.checkBoxValue(e.select(this)),o.focusedView=b.checkBoxValue(e.select(this)),o.updateComponentNotifier()}),t.select(".overlook").call(b.updateCheckBox,o.enableOverlookView).on("change",function(){o.enableOverlookView=b.checkBoxValue(e.select(this)),o.overlookView=b.checkBoxValue(e.select(this)),o.updateComponentNotifier()}),t.select(".thld").call(b.updateNumberBox,o.networkThreshold).on("change",function(){const l=b.numberBoxValue(e.select(this));o.networkThreshold=l,o.updateComponentNotifier(),o.setForceNotifier();const a=o.edges.filter(e=>e.weight>=l).length,s=o.nodes.length,n=s*(s-1)/2,r=e.format(".2f")(Math.log10(a/n));t.select(".logd").call(b.updateTextBox,r)}).dispatch("change"),o.tickCallback=(e=>{const o=e.alpha(),l=o<=e.alphaMin(),a=parseInt(l?0:100*o);t.select(".temperature").select(".progress-bar").classed("bg-success",l).classed("bg-warning",!l).style("width",`${a}%`).attr("aria-valuenow",a)}),t.select(".stick").call(b.updateCheckBox,!o.simulationOnLoad).on("change",function(){const l=b.checkBoxValue(e.select(this));t.select(".temperature").style("background-color",l?"#a3e4d7":"#e9ecef").select(".progress-bar").style("width","0%").attr("aria-valuenow",0),l?o.stickNotifier():o.relaxNotifier()}),t.select(".restart").on("click",function(){t.select(".stick").call(b.updateCheckBox,!1).dispatch("change"),o.restartNotifier()})}function $(e,t){e.append("div").classed("field",!0).call(w.selectBox,"color-field","Field",t.data.nodes.fields.filter(e=>"none"!==l.sortType(e.format)),t.nodeColor.field||""),e.append("div").classed("range",!0).call(V.colorRangeGroup,"color",u.colorPalettes,u.colorRangeTypes,t.nodeColor.range),e.append("div").classed("scale",!0).call(V.scaleBoxGroup,"color",u.presets,u.types.filter(e=>"ordinal"!==e.key),t.nodeColor.scale,t.nodeColor.domain),e.call(O,t)}function O(t,o){t.select(".field").call(w.updateSelectBox,o.nodeColor.field).on("change",function(){o.nodeColor.field=w.selectBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".range").call(V.updateColorRangeGroup,o.nodeColor.range).on("change",function(){const l=V.colorRangeGroupValue(e.select(this));o.nodeColor.range=l,l.length>3?(o.nodeColor.scale="ordinal",t.select(".scale").selectAll("select,input").property("disabled",!0).style("opacity",.3)):t.select(".scale").selectAll("select,input").property("disabled",!1).style("opacity",null),o.updateNodeAttrNotifier()}),t.select(".scale").call(V.updateScaleBoxGroup,o.nodeColor.scale,o.nodeColor.domain).on("change",function(){const t=V.scaleBoxGroupValue(e.select(this));o.nodeColor.scale=t.scale,o.nodeColor.domain=t.domain,o.updateNodeAttrNotifier()})}function F(e,t){e.append("div").classed("field",!0).call(w.selectBox,"size-field","Field",t.data.nodes.fields.filter(e=>"numeric"===l.sortType(e.format)),t.nodeSize.field||""),e.append("div").classed("range",!0).classed("mb-3",!0).call(L.rangeBox,"size-range","Range",t.nodeSize.range),e.append("div").classed("scale",!0).call(V.scaleBoxGroup,"size",u.presets.filter(e=>"ordinal"!==e.scale),u.types.filter(e=>"ordinal"!==e.key),t.nodeSize.scale,t.nodeSize.domain),e.call(P,t)}function P(t,o){t.select(".field").call(w.updateSelectBox,o.nodeSize.field).on("change",function(){o.nodeSize.field=w.selectBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".range").call(L.updateRangeBox,o.nodeSize.range).on("change",function(){o.nodeSize.range=L.rangeBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".scale").call(V.updateScaleBoxGroup,o.nodeSize.scale,o.nodeSize.domain).on("change",function(){const t=V.scaleBoxGroupValue(e.select(this));o.nodeSize.scale=t.scale,o.nodeSize.domain=t.domain,o.updateNodeAttrNotifier()})}function R(e,t){e.append("div").append("div").classed("visible",!0).call(b.checkBox,"label-visible","Show node labels",t.nodeLabel.visible);const o=e.append("div").classed("mb-3",!0);o.append("div").classed("text",!0).classed("mb-1",!0).call(w.selectBox,"label-text","Text field",t.data.nodes.fields.filter(e=>"none"!==l.sortType(e.format)),t.nodeLabel.text||""),o.append("div").classed("size",!0).classed("mb-1",!0).call(b.numberBox,"label-size","Font size",6,100,1,t.nodeLabel.size),e.append("div").classed("field",!0).call(w.selectBox,"label-field","Color field",t.data.nodes.fields.filter(e=>"none"!==l.sortType(e.format)),t.nodeLabelColor.field||""),e.append("div").classed("range",!0).call(V.colorRangeGroup,"label",u.colorPalettes,u.colorRangeTypes,t.nodeLabelColor.range),e.append("div").classed("scale",!0).call(V.scaleBoxGroup,"label",u.presets,u.types.filter(e=>"ordinal"!==e.key),t.nodeLabelColor.scale,t.nodeLabelColor.domain),e.call(_,t)}function _(t,o){t.select(".visible").call(b.updateCheckBox,o.nodeLabel.visible).on("change",function(){o.nodeLabel.visible=b.checkBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".text").call(w.updateSelectBox,o.nodeLabel.text).on("change",function(){o.nodeLabel.text=w.selectBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".size").call(b.updateNumberBox,o.nodeLabel.size).on("change",function(){o.nodeLabel.size=b.numberBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".field").call(w.updateSelectBox,o.nodeLabelColor.field).on("change",function(){o.nodeLabelColor.field=w.selectBoxValue(e.select(this)),o.updateNodeAttrNotifier()}),t.select(".range").call(V.updateColorRangeGroup,o.nodeLabelColor.range).on("change",function(){const l=V.colorRangeGroupValue(e.select(this));o.nodeLabelColor.range=l,l.length>3?(o.nodeLabelColor.scale="ordinal",t.select(".scale").selectAll("select,input").property("disabled",!0).style("opacity",.3)):(o.nodeLabelColor.scale=w.selectBoxValue(t.select(".range")),t.select(".scale").selectAll("select,input").property("disabled",!1).style("opacity",null)),o.updateNodeAttrNotifier()}),t.select(".scale").call(V.updateScaleBoxGroup,o.nodeLabelColor.scale,o.nodeLabelColor.domain).on("change",function(){const t=V.scaleBoxGroupValue(e.select(this));o.nodeLabelColor.scale=t.scale,o.nodeLabelColor.domain=t.domain,o.updateNodeAttrNotifier()})}function E(e,t){const o=e.append("div").classed("mb-3",!0);o.append("div").classed("label",!0).classed("mb-1",!0).call(b.checkBox,"edge-label-visible","Show edge weight label",t.edgeLabel.visible),o.append("div").classed("size",!0).classed("mb-1",!0).call(b.numberBox,"edge-label-size","Weight label font size",6,100,1,t.edgeLabel.size);const l=e.append("div").classed("mb-3",!0);l.append("div").classed("range",!0).classed("mb-3",!0).call(L.rangeBox,"edge-width-range","Range",t.edgeWidth.range),l.append("div").classed("scale",!0).classed("mb-1",!0).call(w.selectBox,"edge-width-scale","Scale type",u.types.filter(e=>"ordinal"!==e.key),t.edgeWidth.scale),l.append("div").classed("domain",!0).classed("mb-1",!0).call(L.rangeBox,"edge-width-domain","Domain",t.edgeWidth.domain)}function W(t,o){t.select(".label").call(b.updateCheckBox,o.edgeLabel.visible).on("change",function(){o.edgeLabel.visible=b.checkBoxValue(e.select(this)),o.updateEdgeAttrNotifier()}),t.select(".size").call(b.updateNumberBox,o.edgeLabel.size).on("change",function(){o.edgeLabel.size=b.numberBoxValue(e.select(this)),o.updateEdgeAttrNotifier()}),t.select(".range").call(L.updateRangeBox,o.edgeWidth.range).on("change",function(){o.edgeWidth.range=L.rangeBoxValue(e.select(this)),o.updateEdgeAttrNotifier()}),t.select(".scale").call(w.updateSelectBox,o.edgeWidth.scale).on("change",function(){o.edgeWidth.scale=w.selectBoxValue(e.select(this)),o.updateEdgeAttrNotifier()}),t.select(".domain").call(L.updateRangeBox,o.edgeWidth.domain).on("change",function(){o.edgeWidth.domain=L.rangeBoxValue(e.select(this)),o.updateEdgeAttrNotifier()})}function M(e,t,o){e.append("nav").append("div").classed("nav",!0).classed("nav-tabs",!0).attr("id",t).attr("role","tablist"),e.append("div").classed("tab-content",!0).classed("p-2",!0).attr("id",o)}function j(e,t,o){e.classed("nav-item",!0).classed("nav-link",!0).classed("py-1",!0).attr("id",`${t}-tab`).attr("data-toggle","tab").attr("href",`#${t}`).attr("role","tab").attr("aria-controls",t).attr("aria-selected","false").text(o)}function G(e,t){e.classed("tab-pane",!0).classed("fade",!0).classed("container",!0).classed("px-0",!0).attr("id",t).attr("role","tabpanel").attr("aria-labelledby",`${t}-tab`)}function q(e,t){e.select(".control-main").call(A,t),e.select(".control-color").call(O,t),e.select(".control-size").call(P,t),e.select(".control-label").call(_,t),e.select(".control-edge").call(W,t)}const I=180,D=180;function J(e,t,o){const l=e.selectAll(".node").data(t,e=>e.index);l.exit().remove();const a=l.enter().append("g").attr("class","node").call(Y);a.append("circle").attr("class","node-symbol"),a.append("g").attr("class","node-content").attr("transform",`translate(${-I/2},${-D/2})`),a.append("text").attr("class","node-label").attr("x",0).attr("text-anchor","middle");const s=a.merge(l);o?s.select(".node-content").html(e=>e.structure):s.select(".node-content").select("svg").remove()}function Q(e,t){const o=e.selectAll(".link").data(t,e=>`${e.source}_${e.target}`);o.exit().remove();const l=o.enter().append("g").attr("class","link");l.append("line").attr("class","edge-line").style("stroke","#999").style("stroke-opacity",.6),l.append("text").attr("class","edge-label").attr("text-anchor","middle").text(e=>e.weight),l.call(X)}function U(t,o){t.selectAll(".node").each(function(t){const a=u.scaleFunction(o.nodeColor)(t[o.nodeColor.field]),s=u.scaleFunction(o.nodeSize)(t[o.nodeSize.field]),n=u.scaleFunction(o.nodeLabelColor)(t[o.nodeLabelColor.field]);e.select(this).select(".node-symbol").attr("r",s).style("fill",a),e.select(this).select(".node-label").text(e=>{if(null===o.nodeLabel.text)return"";const t=o.data.nodes.fields.find(e=>e.key===o.nodeLabel.text);return"d3_format"===t.format?l.formatNum(e[o.nodeLabel.text],t.d3_format):e[o.nodeLabel.text]}).attr("font-size",o.nodeLabel.size).attr("y",parseFloat(s)+parseInt(o.nodeLabel.size)).attr("visibility",o.nodeLabel.visible?"inherit":"hidden").style("fill",n)})}function H(e,t){e.selectAll(".link").select(".edge-line").style("stroke-width",e=>u.scaleFunction(t.edgeWidth)(e.weight)),e.selectAll(".link").select(".edge-label").attr("visibility",t.edgeLabel.visible?"inherit":"hidden").attr("font-size",t.edgeLabel.size)}function Y(e){e.attr("transform",e=>`translate(${e.x}, ${e.y})`)}function X(e){e.attr("transform",e=>`translate(${e.sx}, ${e.sy})`),e.select(".edge-line").attr("x1",0).attr("y1",0).attr("x2",e=>e.tx-e.sx).attr("y2",e=>e.ty-e.sy),e.select(".edge-label").attr("x",e=>(e.tx-e.sx)/2).attr("y",e=>(e.ty-e.sy)/2)}function K(e,t){e.select(".nw-nodes").call(U,t),e.select(".nw-edges").call(H,t)}function Z(e,t,o){e.attr("transform",`translate(${t}, ${o})`)}function ee(e,t,o,l,a){e.attr("transform",`translate(${t}, ${o})`),e.select(".edge-line").attr("x1",0).attr("y1",0).attr("x2",l-t).attr("y2",a-o),e.select(".edge-label").attr("x",(l-t)/2).attr("y",(a-o)/2)}var te={updateNodes:J,updateEdges:Q,updateNodeCoords:Y,updateEdgeCoords:X,updateNodeAttrs:U,updateEdgeAttrs:H,updateAttrs:K,updateComponents:function(e,t){const o=t.nodesToRender(),l=o.length;t.enableFocusedView&&(t.focusedView=l<t.focusedViewThreshold),t.enableOverlookView&&(t.overlookView=l>t.overlookViewThreshold);const a=t.overlookView?[]:t.edgesToRender();e.select(".nw-nodes").call(J,o,t.focusedView),e.select(".nw-edges").call(Q,a),e.call(K,t),t.zoomListener&&e.call(t.zoomListener),t.dragListener&&e.select(".nw-nodes").selectAll(".node").call(t.dragListener)},move:function(t,o,l,a){const s=e.select(o).call(Z,l,a).datum();t.select(".nw-edges").selectAll(".link").filter(e=>s.adjacency.map(e=>e[1]).includes(e.num)).each(function(t){s.index===t.source.index||s.index===t.source?e.select(this).call(ee,l,a,t.tx,t.ty):s.index!==t.target.index&&s.index!==t.target||e.select(this).call(ee,t.sx,t.sy,l,a)})},transform:function(e,t,o,l){e.select(".nw-field").attr("transform",`translate(${t}, ${o}) scale(${l})`)},resizeViewBox:function(e,t,o){e.attr("viewBox",`0 0 ${t} ${o}`),e.select(".nw-view-boundary").attr("width",t).attr("height",o)}};function oe(e,t){const o=e.node();t.setViewBox(o.offsetWidth,o.offsetHeight),e.select(".nw-view").call(te.resizeViewBox,o.offsetWidth,o.offsetHeight)}function le(t,o){return e.drag().on("drag",function(){t.call(te.move,this,e.event.x,e.event.y)}).on("end",function(t){o.setCoords(t.index,e.event.x,e.event.y)})}function ae(t,o){return e.zoom().on("zoom",function(){const l=e.event.transform;if(t.call(te.transform,l.x,l.y,l.k),!o.focusedView){const e=o.prevTransform,a=l.x>e.x+20||l.x<e.x-20,s=l.y>e.y+20||l.y<e.y-20,n=l.k>e.k;(a||s&&!n)&&(o.setTransform(l.x,l.y,l.k),o.prevTransform={x:l.x,y:l.y,k:l.k},t.call(te.updateComponents,o))}}).on("end",function(){const l=e.event.transform;o.setTransform(l.x,l.y,l.k),o.prevTransform={x:l.x,y:l.y,k:l.k},t.call(te.updateComponents,o)})}function se(t,o){const l=t.select(".nw-view-boundary").node().getBBox(),a=l.width/l.height,s=o.boundary.bottom-o.boundary.top,n=o.boundary.right-o.boundary.left,r=a>=n/s?l.height/s:l.width/n,c=-o.boundary.left*r,d=-o.boundary.top*r;o.setTransform(c,d,r),t.call(te.updateComponents,o).call(te.transform,c,d,r).call(e.zoom().transform,e.zoomIdentity.translate(c,d).scale(r))}var ne={dragListener:le,zoomListener:ae,setInteraction:function(t,o){o.zoomListener=ae(t,o),o.dragListener=le(t,o),t.call(o.zoomListener),t.select(".nw-nodes").selectAll(".node").call(o.dragListener),o.fitNotifier=(()=>{t.call(se,o)});const l=o.transform;t.call(te.transform,l.x,l.y,l.k).call(e.zoom().transform,e.zoomIdentity.translate(l.x,l.y).scale(l.k))},fit:se};function re(e,t,o){const l=o.nodes.map(e=>({x:e.x,y:e.y}));o.setAllCoords(l),e.call(te.updateComponents,o)}function ce(e,t,o){t.alpha(0).stop(),e.select(".nw-nodes").selectAll(".node").each(e=>{e.fx=e.x,e.fy=e.y}),o.dragListener=ne.dragListener(e,o),e.call(re,t,o)}function de(t,o,l){t.select(".nw-nodes").selectAll(".node").each(e=>{e.fx=null,e.fy=null}),l.dragListener=function(t,o,l){return e.drag().on("start",()=>{e.event.active||t.call(ie,o,l)}).on("drag",t=>{t.fx=e.event.x,t.fy=e.event.y}).on("end",t=>{e.event.active||o.alphaTarget(0),t.fx=null,t.fy=null})}(t,o,l);const a=l.nodes.map(e=>({x:e.x,y:e.y}));l.setAllCoords(a),t.call(te.updateComponents,l)}function ie(e,t,o){e.call(de,t,o),t.alpha(.1).restart()}function pe(e,t,o){e.call(de,t,o),t.alpha(1).restart()}function ue(e,t,o){const l=o.edges.filter(e=>e.weight>=o.networkThreshold);t.nodes(o.nodes).force("link").links(l)}return{NetworkState:class{constructor(e,t,o){this.focusedViewThreshold=100,this.enableFocusedView=!0,this.focusedView=!1,this.overlookViewThreshold=500,this.enableOverlookView=!0,this.overlookView=!1,this.data=c.convertNetwork(e),this.nodes=JSON.parse(JSON.stringify(this.data.nodes.records)),this.edges=JSON.parse(JSON.stringify(this.data.edges.records)),this.nodes.forEach(e=>{e.adjacency=[]}),this.edges.forEach((e,t)=>{e.num=t,this.nodes[e.source].adjacency.push([e.target,t]),this.nodes[e.target].adjacency.push([e.source,t])});const l=this.data.edges.snapshot||{nodeColor:{},nodeSize:{},nodeLabel:{},nodeLabelColor:{},edgeWidth:{},edgeLabel:{}};this.nodeColor={},this.nodeColor.field=l.nodeColor.field||null,this.nodeColor.scale=l.nodeColor.scale||"linear",this.nodeColor.domain=l.nodeColor.domain||[0,1],this.nodeColor.range=l.nodeColor.range||["#7fffd4","#7fffd4"],this.nodeColor.unknown=l.nodeColor.unknown||["#7fffd4"],this.nodeSize={},this.nodeSize.field=l.nodeSize.field||null,this.nodeSize.scale=l.nodeSize.scale||"linear",this.nodeSize.domain=l.nodeSize.domain||[1,1],this.nodeSize.range=l.nodeSize.range||[40,40],this.nodeSize.unknown=l.nodeSize.unknown||40,this.nodeLabel={},this.nodeLabel.text=l.nodeLabel.text||null,this.nodeLabel.size=l.nodeLabel.size||12,this.nodeLabel.visible=l.nodeLabel.visible||!1,this.nodeLabelColor={},this.nodeLabelColor.field=l.nodeLabelColor.field||null,this.nodeLabelColor.scale=l.nodeLabelColor.scale||"linear",this.nodeLabelColor.domain=l.nodeLabelColor.domain||[1,1],this.nodeLabelColor.range=l.nodeLabelColor.range||["#7fffd4","#7fffd4"],this.nodeLabelColor.unknown=l.nodeLabelColor.unknown||["#333333"],this.networkThresholdCutoff=e.edges.query.params.threshold,this.networkThreshold=l.networkThreshold||e.edges.query.params.threshold,this.edgeWidth={},this.edgeWidth.scale=l.edgeWidth.scale||"linear",this.edgeWidth.domain=l.edgeWidth.domain||[.5,1],this.edgeWidth.range=l.edgeWidth.range||[1,5],this.edgeWidth.unknown=l.edgeWidth.unknown||1,this.edgeLabel={},this.edgeLabel.size=l.edgeLabel.size||12,this.edgeLabel.visible=l.edgeLabel.visible||!1,this.transform=l.fieldTransform||{x:0,y:0,k:1},this.zoomListener=null,this.dragListener=null,this.updateComponentNotifier=null,this.updateNodeNotifier=null,this.updateEdgeNotifier=null,this.updateNodeAttrNotifier=null,this.updateEdgeAttrNotifier=null,this.snapShotNotifier=null,this.fitNotifier=null,this.setForceNotifier=null,this.stickNotifier=null,this.relaxNotifier=null,this.restartNotifier=null,this.tickCallback=(()=>{}),this.forceField={top:0,right:t,bottom:o,left:0},this.viewBox={top:0,right:t,bottom:o,left:0},this.focusArea={},this.boundary={},this.prevTransform={x:this.transform.x,y:this.transform.y,k:this.transform.k},l.coords?(this.simulationOnLoad=!1,this.setAllCoords(l.coords),this.setFocusArea(),this.setBoundary()):this.simulationOnLoad=!0}setBoundary(){const e=this.nodes.map(e=>e.x),t=this.nodes.map(e=>e.y);this.boundary.top=Math.min.apply(null,t),this.boundary.left=Math.min.apply(null,e),this.boundary.bottom=Math.max.apply(null,t),this.boundary.right=Math.max.apply(null,e)}setFocusArea(){const e=this.transform.x,t=this.transform.y,o=this.transform.k;this.focusArea.top=(this.viewBox.top-t)/o-50,this.focusArea.left=(this.viewBox.left-e)/o-50,this.focusArea.bottom=(this.viewBox.bottom-t)/o+50,this.focusArea.right=(this.viewBox.right-e)/o+50}setTransform(e,t,o){this.transform.x=e,this.transform.y=t,this.transform.k=o,this.setFocusArea()}setViewBox(e,t){this.viewBox.right=e,this.viewBox.bottom=t,this.setFocusArea()}setAllCoords(e){this.nodes.forEach(t=>{t.x=e[t.index].x,t.y=e[t.index].y,t.adjacency.forEach(o=>{const l=o[0],a=o[1];t.index<l?(this.edges[a].sx=e[t.index].x,this.edges[a].sy=e[t.index].y):(this.edges[a].tx=e[t.index].x,this.edges[a].ty=e[t.index].y)})}),this.setBoundary()}setCoords(e,t,o){this.nodes[e].x=t,this.nodes[e].y=o,this.nodes[e].adjacency.forEach(l=>{const a=l[0],s=l[1];e<a?(this.edges[s].sx=t,this.edges[s].sy=o):(this.edges[s].tx=t,this.edges[s].ty=o)}),this.setBoundary()}nodesToRender(){return this.nodes.filter(e=>e.y>this.focusArea.top&&e.x>this.focusArea.left&&e.y<this.focusArea.bottom&&e.x<this.focusArea.right)}edgesToRender(){return this.edges.filter(e=>e.weight>=this.networkThreshold&&this.focusArea.top<Math.max(e.sy,e.ty)&&this.focusArea.left<Math.max(e.sx,e.tx)&&this.focusArea.bottom>Math.min(e.sy,e.ty)&&this.focusArea.right>Math.min(e.sx,e.tx))}snapshot(){return{nodeColor:this.nodeColor,nodeSize:this.nodeSize,nodeLabel:this.nodeLabel,nodeLabelColor:this.nodeLabelColor,edgeWidth:this.edgeWidth,edgeLabel:this.edgeLabel,networkThreshold:this.networkThreshold,networkThresholdCutoff:this.networkThresholdCutoff,fieldTransform:this.transform,coords:this.nodes.map(e=>({x:e.x,y:e.y}))}}export(){return this.data.edges.id=l.uuidv4(),this.data.edges.snapshot=this.snapshot(),JSON.parse(JSON.stringify(this.data))}showTransform(){e.select("#debug-transform").text(JSON.stringify(this.transform))}showBoundary(){e.select("#debug-boundary").text(JSON.stringify(this.boundary))}showFocusArea(){e.select("#debug-focusarea").text(JSON.stringify(this.focusArea))}showViewBox(){e.select("#debug-viewbox").text(JSON.stringify(this.viewBox))}},community:d,control:{controlBox:function(e,t){e.select("nav").remove(),e.select(".tab-content").remove(),e.call(M,"control-frame-nav","control-frame-content");const o=e.select(".nav-tabs"),l=e.select(".tab-content");o.append("a").classed("active",!0).attr("aria-selected","true").call(j,"control-main","Main"),l.append("div").classed("show",!0).classed("active",!0).classed("control-main",!0).call(G,"control-main").call(T,t),o.append("a").call(j,"control-color","Color"),l.append("div").classed("control-color",!0).call(G,"control-color").call($,t),o.append("a").call(j,"control-size","Size"),l.append("div").classed("control-size",!0).call(G,"control-size").call(F,t),o.append("a").call(j,"control-label","Label"),l.append("div").classed("control-label",!0).call(G,"control-label").call(R,t),o.append("a").call(j,"control-edge","Edge"),l.append("div").classed("control-edge",!0).call(G,"control-edge").call(E,t),e.call(q,t)},updateControlBox:q},view:{networkViewFrame:function(e,t){e.style("width","100%").style("height","100%"),e.select(".nw-view").remove(),e.append("svg").classed("nw-view",!0),e.call(oe,t)},resize:oe,networkView:function(e,t){e.attr("preserveAspectRatio","xMinYMin meet").attr("pointer-events","all").attr("viewBox",`0 0 ${t.viewBox.right} ${t.viewBox.bottom}`).style("width","100%").style("height","100%"),e.select(".nw-view-boundary").remove(),e.select(".nw-field").remove(),e.append("rect").classed("nw-view-boundary",!0).attr("x",0).attr("y",0).attr("width",t.viewBox.right).attr("height",t.viewBox.bottom).attr("fill","#ffffff").attr("stroke-width",1).attr("stroke","#cccccc");const o=e.append("g").classed("nw-field",!0).style("opacity",1e-6);o.transition().duration(1e3).style("opacity",1);const l=o.append("g").classed("nw-edges",!0),a=o.append("g").classed("nw-nodes",!0);t.updateComponentNotifier=(()=>{e.call(te.updateComponents,t)}),t.updateNodeNotifier=(()=>{a.call(te.updateNodes,t.nodesToRender())}),t.updateEdgeNotifier=(()=>{l.call(te.updateEdges,t.edgesToRender())}),t.updateNodeAttrNotifier=(()=>{a.call(te.updateNodeAttrs,t)}),t.updateEdgeAttrNotifier=(()=>{l.call(te.updateEdgeAttrs,t)}),e.call(te.updateComponents,t)}},force:{forceSimulation:function(t,o){return e.forceSimulation().force("link",e.forceLink().id(e=>e.index).distance(60).strength(1)).force("charge",e.forceManyBody().strength(-600).distanceMin(15).distanceMax(720)).force("collide",e.forceCollide().radius(90)).force("center",e.forceCenter(t/2,o/2)).force("x",e.forceX().strength(.002)).force("y",e.forceY().strength(.002)).stop()},activate:function(e,t,o){t.on("tick",()=>{e.select(".nw-nodes").selectAll(".node").call(te.updateNodeCoords);const l=o.nodes.map(e=>({x:e.x,y:e.y}));o.setAllCoords(l),e.select(".nw-edges").selectAll(".link").call(te.updateEdgeCoords),o.tickCallback(t)}).on("end",()=>{e.call(re,t,o),o.tickCallback(t)}),o.setForceNotifier=(()=>{e.call(ue,t,o)}),o.stickNotifier=(()=>{e.call(ce,t,o)}),o.relaxNotifier=(()=>{e.call(ie,t,o)}),o.restartNotifier=(()=>{e.call(pe,t,o)}),o.setForceNotifier(),o.simulationOnLoad?e.call(pe,t,o):e.call(ce,t,o)},stick:ce,relax:ie,restart:pe},interaction:ne}});
//# sourceMappingURL=kw-network.js.map
