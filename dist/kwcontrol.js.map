{"version":3,"file":"kwcontrol.js","sources":["../src/component/table.js","../src/component/modal.js","../src/control.js","../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/component/button.js"],"sourcesContent":["\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n    selection.append('caption').text(caption);\n  }\n  selection.append('thead').append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter().append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter().append('tr')\n    .merge(rows)\n      .each(function (d) {\n        d3.select(this).selectAll('td').remove();\n        d3.select(this).call(rowFactory, d);\n      });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module control */\n\nimport d3 from 'd3';\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as button} from './component/button.js';\nimport {default as table} from './component/table.js';\nimport {default as modal} from './component/modal.js';\n\n\nfunction updateStoreRow(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('status', true)\n      .text(record.status);\n  selection.append('td')\n      .classed('size', true)\n      .text(record.records.length);\n  const action = selection.append('td')\n      .classed('action', true);\n  const app = {nodes: 'datagrid', edges: 'network'};\n  action.append('a')\n      .call(button.menuButtonLink, null, 'Open', 'primary')\n      .attr('href', `${app[record.dataType]}.html?id=${record.storeID}`)\n      .attr('target', '_blank');\n  const ongoing = ['running', 'ready'].includes(record.status);\n  action.append('a')\n      .call(button.menuModalLink, null, 'Delete', 'warning', 'delete-dialog')\n      .property('disabled', ongoing)\n      .text(ongoing ? 'Running' : 'Delete')\n      .on('click', () =>{\n        d3.select('#delete-dialog')\n          .select('.message')\n            .text(`Are you sure you want to delete ${record.name} ?`);\n        d3.select('#delete-dialog')\n          .select('.ok')\n          .on('click', () => idb.deleteItem(record.storeID).then(update));\n      });\n}\n\n\nfunction update() {\n  // Server status\n  fetcher.get('server')\n    .then(fetcher.json)\n    .catch(() => {\n      console.info('Server did not respond');\n      return {calc: []};\n    })\n    .then(res => {\n      // Server calculation jobs\n      const calcFields = misc.defaultFieldProperties([\n        {key: 'id', name: 'Workflow ID', format: 'text'},\n        {key: 'size', name: 'File size', d3_format: '.3s'},\n        {key: 'status', name: 'Status', format: 'text'},\n        {key: 'created', name: 'Created', format: 'date'},\n        {key: 'expires', name: 'Expires', format: 'date'}\n      ]);\n      d3.select('#contents').select('.calc')\n        .call(table.updateHeader, calcFields, res.calc.records);\n      // Server status\n      const serverFields = misc.defaultFieldProperties([\n        {key: 'key', name: 'Key', format: 'text'},\n        {key: 'value', name: 'Value', format: 'text'}\n      ]);\n      const serverRecords = Object.entries(res)\n        .filter(e => e[0] !== 'calc')\n        .map(e => ({key: e[0], value: e[1]}));\n      d3.select('#contents').select('.server')\n        .call(table.updateHeader, serverFields, serverRecords);\n    });\n  // Datagrid store\n  idb.getItemsByDataType('nodes')\n    .then(items => {\n      d3.select('#contents').select('.dg')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n  // Network store\n  idb.getItemsByDataType('edges')\n    .then(items => {\n      d3.select('#contents').select('.nw')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n}\n\n\nfunction run() {\n  // Menubar\n  const menu = d3.select('#menubar');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New datagrid', 'primary')\n      .attr('href', 'datagrid.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New network', 'primary')\n      .attr('href', 'network.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, 'Refresh all', 'outline-secondary')\n      .on('click', () => {\n        return idb.getAllItems()\n          .then(items => {\n            return Promise.all(\n              items.map(item => core.fetchProgress(item.storeID))\n            );\n          })\n          .then(update);\n      });\n  menu.append('a')\n      .call(button.menuModalLink, null, 'Reset local datastore', 'warning', 'reset-dialog');\n\n  // Tables\n  const storeFields = misc.defaultFieldProperties([\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'size', name: 'Records', d3_format: 'd'},\n    {key: 'action', name: 'Action', format: 'control'}\n  ]);\n  const dg = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  dg.append('h5')\n      .text('Datagrids on local storage');\n  dg.append('table')\n      .classed('dg', true)\n      .call(table.render, null, null, storeFields);\n  const nw = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  nw.append('h5')\n      .text('Networks on local storage');\n  nw.append('table')\n      .classed('nw', true)\n      .call(table.render, null, null, storeFields);\n  const calc = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  calc.append('h5')\n      .text('Server calculation job');\n  calc.append('table')\n      .classed('calc', true)\n      .call(table.render);\n  const server = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  server.append('h5')\n      .text('Server status');\n  server.append('table')\n      .classed('server', true)\n      .call(table.render);\n\n  // Dialogs\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'reset-dialog',\n            'Are you sure you want to delete all local tables and reset the datastore ?')\n    .select('.ok')\n      .on('click', () => idb.reset().then(update));\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'delete-dialog', null);\n  // TODO: show browser status\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  console.info('Off-line mode is disabled for debugging');\n  return update();\n}\n\n\nexport default {\n  run\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  fetchProgress\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, id, label, type, target) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, id, label, type) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, id, label) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, id, label, target) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, id, label, accept) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label)\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      })\n    .append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n"],"names":["updateHeader","selection","fields","records","header","select","selectAll","data","exit","remove","enter","append","text","d","name","call","updateContents","key","record","forEach","field","value","cell","classed","undefined","format","misc","formatNum","d3_format","updateRowFunc","keyFunc","rowFactory","rows","merge","each","d3","this","dialogBase","id","attr","updateStoreRow","status","length","action","button","menuButtonLink","nodes","edges","dataType","storeID","ongoing","includes","menuModalLink","property","on","idb","deleteItem","then","update","fetcher","get","json","catch","console","info","calc","res","calcFields","defaultFieldProperties","table","serverFields","serverRecords","Object","entries","filter","e","map","getItemsByDataType","items","hasOwnProperty","visible","sortType","fmt","d3format","Number","isNaN","parseFloat","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","Dexie","version","stores","getAllItems","orderBy","reverse","toArray","type","where","equals","sortBy","err","error","getItemByID","first","delete","putItem","put","updateItem","updateFunc","modify","reset","baseURL","url","q","keys","JSON","stringify","fetch","credentials","Promise","reject","Error","statusText","resolve","response","blob","post","formdata","method","body","fetchProgress","command","reference","workflow","item","progress","execTime","buttonBox","label","menuButton","dropdownMenuButton","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","node","click","style","dropdownMenuFileValue","files","render","caption","confirmDialog","message","base","footer","dispatch","submitDialog","title","html","run","menu","all","core","storeFields","dg","nw","server","modal","document","protocol","navigator","onLine"],"mappings":"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"}