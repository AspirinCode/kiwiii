{"version":3,"file":"kwcontrol.js","sources":["../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/component/button.js","../src/component/table.js","../src/component/modal.js","../src/control.js"],"sourcesContent":["\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  fetchProgress\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, id, label, type, target) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, id, label, type) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, id, label) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, id, label, target) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, id, label, accept) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .text(label)\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      })\n    .append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n    selection.append('caption').text(caption);\n  }\n  selection.append('thead').append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter().append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter().append('tr')\n    .merge(rows)\n      .each(function (d) {\n        d3.select(this).selectAll('td').remove();\n        d3.select(this).call(rowFactory, d);\n      });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module control */\n\nimport d3 from 'd3';\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as button} from './component/button.js';\nimport {default as table} from './component/table.js';\nimport {default as modal} from './component/modal.js';\n\n\nfunction updateStoreRow(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('status', true)\n      .text(record.status);\n  selection.append('td')\n      .classed('size', true)\n      .text(record.records.length);\n  const action = selection.append('td')\n      .classed('action', true);\n  const app = {nodes: 'datagrid', edges: 'network'};\n  action.append('a')\n      .call(button.menuButtonLink, null, 'Open', 'primary')\n      .attr('href', `${app[record.dataType]}.html?id=${record.storeID}`)\n      .attr('target', '_blank');\n  const ongoing = ['running', 'ready'].includes(record.status);\n  action.append('a')\n      .call(button.menuModalLink, null, 'Delete', 'warning', 'delete-dialog')\n      .property('disabled', ongoing)\n      .text(ongoing ? 'Running' : 'Delete')\n      .on('click', () =>{\n        d3.select('#delete-dialog')\n          .select('.message')\n            .text(`Are you sure you want to delete ${record.name} ?`);\n        d3.select('#delete-dialog')\n          .select('.ok')\n          .on('click', () => idb.deleteItem(record.storeID).then(update));\n      });\n}\n\n\nfunction update() {\n  // Server status\n  fetcher.get('server')\n    .then(fetcher.json)\n    .catch(() => {\n      console.info('Server did not respond');\n      return {calc: []};\n    })\n    .then(res => {\n      // Server calculation jobs\n      const calcFields = misc.defaultFieldProperties([\n        {key: 'id', name: 'Workflow ID', format: 'text'},\n        {key: 'size', name: 'File size', d3_format: '.3s'},\n        {key: 'status', name: 'Status', format: 'text'},\n        {key: 'created', name: 'Created', format: 'date'},\n        {key: 'expires', name: 'Expires', format: 'date'}\n      ]);\n      d3.select('#contents').select('.calc')\n        .call(table.updateHeader, calcFields, res.calc.records);\n      // Server status\n      const serverFields = misc.defaultFieldProperties([\n        {key: 'key', name: 'Key', format: 'text'},\n        {key: 'value', name: 'Value', format: 'text'}\n      ]);\n      const serverRecords = Object.entries(res)\n        .filter(e => e[0] !== 'calc')\n        .map(e => ({key: e[0], value: e[1]}));\n      d3.select('#contents').select('.server')\n        .call(table.updateHeader, serverFields, serverRecords);\n    });\n  // Datagrid store\n  idb.getItemsByDataType('nodes')\n    .then(items => {\n      d3.select('#contents').select('.dg')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n  // Network store\n  idb.getItemsByDataType('edges')\n    .then(items => {\n      d3.select('#contents').select('.nw')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n}\n\n\nfunction run() {\n  // Menubar\n  const menu = d3.select('#menubar');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New datagrid', 'primary')\n      .attr('href', 'datagrid.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New network', 'primary')\n      .attr('href', 'network.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, 'Refresh all', 'outline-secondary')\n      .on('click', () => {\n        return idb.getAllItems()\n          .then(items => {\n            return Promise.all(\n              items.map(item => core.fetchProgress(item.storeID))\n            );\n          })\n          .then(update);\n      });\n  menu.append('a')\n      .call(button.menuModalLink, null, 'Reset local datastore', 'warning', 'reset-dialog');\n\n  // Tables\n  const storeFields = misc.defaultFieldProperties([\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'size', name: 'Records', d3_format: 'd'},\n    {key: 'action', name: 'Action', format: 'control'}\n  ]);\n  const dg = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  dg.append('h5')\n      .text('Datagrids on local storage');\n  dg.append('table')\n      .classed('dg', true)\n      .call(table.render, null, null, storeFields);\n  const nw = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  nw.append('h5')\n      .text('Networks on local storage');\n  nw.append('table')\n      .classed('nw', true)\n      .call(table.render, null, null, storeFields);\n  const calc = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  calc.append('h5')\n      .text('Server calculation job');\n  calc.append('table')\n      .classed('calc', true)\n      .call(table.render);\n  const server = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  server.append('h5')\n      .text('Server status');\n  server.append('table')\n      .classed('server', true)\n      .call(table.render);\n\n  // Dialogs\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'reset-dialog',\n            'Are you sure you want to delete all local tables and reset the datastore ?')\n    .select('.ok')\n      .on('click', () => idb.reset().then(update));\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'delete-dialog', null);\n  // TODO: show browser status\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  console.info('Off-line mode is disabled for debugging');\n  return update();\n}\n\n\nexport default {\n  run\n};\n"],"names":["defaultFieldProperties","fields","map","e","hasOwnProperty","name","key","visible","format","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","version","stores","getAllItems","orderBy","reverse","toArray","getItemsByDataType","type","where","equals","sortBy","catch","err","console","error","getItemByID","storeID","first","deleteItem","delete","putItem","data","misc","put","updateItem","updateFunc","modify","reset","then","baseURL","get","url","q","Object","keys","length","JSON","stringify","fetch","credentials","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","fetchProgress","command","id","reference","workflow","fetcher","item","progress","execTime","records","buttonBox","selection","label","classed","append","attr","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","select","this","node","click","style","dropdownMenuFileValue","files","updateHeader","header","selectAll","exit","remove","enter","d","call","updateContents","record","forEach","field","cell","undefined","d3_format","updateRowFunc","keyFunc","rowFactory","rows","merge","each","render","caption","dialogBase","confirmDialog","message","base","footer","dispatch","submitDialog","title","html","updateStoreRow","action","button","nodes","edges","dataType","ongoing","property","update","info","calc","calcFields","table","serverFields","serverRecords","entries","filter","run","menu","all","core","storeFields","dg","nw","server","modal","document","protocol","navigator","onLine"],"mappings":"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"}