{"version":3,"file":"kwcontrol.js","sources":["../src/component/table.js","../src/component/modal.js","../src/control.js","../src/common/KArray.js","../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/component/button.js"],"sourcesContent":["\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n  selection.append('caption')\n      .text(caption);\n  }\n  selection.append('thead')\n    .append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter()\n    .append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter()\n    .append('tr')\n    .merge(rows)\n    .each(function (d) {\n      d3.select(this)\n        .selectAll('td').remove();\n      d3.select(this)\n        .call(rowFactory, d);\n    });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module control */\n\nimport d3 from 'd3';\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as button} from './component/button.js';\nimport {default as table} from './component/table.js';\nimport {default as modal} from './component/modal.js';\n\n\nfunction updateStoreRow(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('status', true)\n      .text(record.status);\n  selection.append('td')\n      .classed('size', true)\n      .text(record.records.length);\n  const action = selection.append('td')\n      .classed('action', true);\n  const app = {nodes: 'datagrid', edges: 'network'};\n  action.append('a')\n      .call(button.menuButtonLink, null, 'Open', 'primary')\n      .attr('href', `${app[record.dataType]}.html?id=${record.storeID}`)\n      .attr('target', '_blank');\n  const ongoing = ['running', 'ready'].includes(record.status);\n  action.append('a')\n      .call(button.menuModalLink, null, 'Delete', 'warning', 'delete-dialog')\n      .property('disabled', ongoing)\n      .text(ongoing ? 'Running' : 'Delete')\n      .on('click', () =>{\n        d3.select('#delete-dialog')\n          .select('.message')\n            .text(`Are you sure you want to delete ${record.name} ?`);\n        d3.select('#delete-dialog')\n          .select('.ok')\n          .on('click', () => idb.deleteItem(record.storeID).then(update));\n      });\n}\n\n\nfunction update() {\n  // Server status\n  fetcher.get('server')\n    .then(fetcher.json)\n    .catch()\n    .then(res => {\n      if (!res) return;\n      // Server calculation jobs\n      const calcFields = misc.defaultFieldProperties([\n        {key: 'id', name: 'Workflow ID', format: 'text'},\n        {key: 'size', name: 'File size', d3_format: '.3s'},\n        {key: 'status', name: 'Status', format: 'text'},\n        {key: 'created', name: 'Created', format: 'date'},\n        {key: 'expires', name: 'Expires', format: 'date'}\n      ]);\n      d3.select('#contents').select('.calc')\n        .call(table.updateHeader, calcFields, res.calc.records);\n      // Server status\n      const serverFields = misc.defaultFieldProperties([\n        {key: 'key', name: 'Key', format: 'text'},\n        {key: 'value', name: 'Value', format: 'text'}\n      ]);\n      const serverRecords = Object.entries(res)\n        .filter(e => e[0] !== 'calc')\n        .map(e => ({key: e[0], value: e[1]}));\n      d3.select('#contents').select('.server')\n        .call(table.updateHeader, serverFields, serverRecords);\n    });\n  // Datagrid store\n  idb.getItemsByDataType('nodes')\n    .then(items => {\n      d3.select('#contents').select('.dg')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n  // Network store\n  idb.getItemsByDataType('edges')\n    .then(items => {\n      d3.select('#contents').select('.nw')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n}\n\n\nfunction run() {\n  // Menubar\n  const menu = d3.select('#menubar');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New datagrid', 'primary')\n      .attr('href', 'datagrid.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, '+ New network', 'primary')\n      .attr('href', 'network.html')\n      .attr('target', '_blank');\n  menu.append('a')\n      .call(button.menuButtonLink, null, 'Refresh all', 'outline-secondary')\n      .on('click', () => {\n        return idb.getAllItems()\n          .then(items => {\n            return Promise.all(\n              items.map(item => core.fetchProgress(item.storeID))\n            );\n          })\n          .then(update);\n      });\n  menu.append('a')\n      .call(button.menuModalLink, null, 'Reset local datastore', 'warning', 'reset-dialog');\n\n  // Tables\n  const storeFields = misc.defaultFieldProperties([\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'size', name: 'Records', d3_format: 'd'},\n    {key: 'action', name: 'Action', format: 'control'}\n  ]);\n  const dg = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  dg.append('h5')\n      .text('Datagrids on local storage');\n  dg.append('table')\n      .classed('dg', true)\n      .call(table.render, null, null, storeFields);\n  const nw = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  nw.append('h5')\n      .text('Networks on local storage');\n  nw.append('table')\n      .classed('nw', true)\n      .call(table.render, null, null, storeFields);\n  const calc = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  calc.append('h5')\n      .text('Server calculation job');\n  calc.append('table')\n      .classed('calc', true)\n      .call(table.render);\n  const server = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  server.append('h5')\n      .text('Server status');\n  server.append('table')\n      .classed('server', true)\n      .call(table.render);\n\n  // Dialogs\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'reset-dialog',\n            'Are you sure you want to delete all local tables and reset the datastore ?')\n    .select('.ok')\n      .on('click', () => idb.reset().then(update));\n  d3.select('#dialogs').append('div')\n      .call(modal.confirmDialog, 'delete-dialog', null);\n  // TODO: show browser status\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  console.info('Off-line mode is disabled for debugging');\n  return update();\n}\n\n\nexport default {\n  run\n};\n","\n/** @module common/KArray */\n\n\nclass KArray extends Array {\n  /**\n   * Return array of object filtered by given unique key\n   */\n  unique(key) {\n    return this.reduce((a, b) => {\n      if (a.find(e => e[key] === b[key]) === undefined) a.push(b);\n      return a;\n    }, new KArray());\n  }\n\n\n  /**\n   * Merge arrays\n   */\n  extend() {\n    return this.reduce((a, b) => {\n      Array.prototype.push.apply(a, b);\n      return a;\n    }, new KArray());\n  }\n\n\n  // Merge arrays(Asynchronous)\n  extendAsync() {\n    return Promise.all(this).then(res => {\n      return res.reduce((a, b) => {\n        Array.prototype.push.apply(a, b);\n        return a;\n      }, new KArray());\n    });\n  }\n\n  toArray() {\n    return Array.from(this);\n  }\n\n  toObject() {\n    const obj = {};\n    this.forEach(kv => {\n      obj[kv[0]] = kv[1];\n    });\n    return obj;\n  }\n}\n\nexport default KArray;\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\nimport KArray from './KArray.js';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  return KArray.from(window.location.search.substring(1).split(\"&\"))\n    .map(e => e.split('=')).toObject();\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  fetchProgress\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, id, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, id, label, type, target) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, id, label, type) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, id, label) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, id, label, target) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`)\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, id, label, accept) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .text(label)\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      })\n    .append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n"],"names":["updateHeader","selection","fields","records","header","select","selectAll","data","exit","remove","enter","append","text","d","name","call","updateContents","key","record","forEach","field","value","cell","classed","undefined","format","misc","formatNum","d3_format","updateRowFunc","keyFunc","rowFactory","rows","merge","each","d3","this","dialogBase","id","attr","updateStoreRow","status","length","action","button","menuButtonLink","nodes","edges","dataType","storeID","ongoing","includes","menuModalLink","property","on","idb","deleteItem","then","update","fetcher","get","json","catch","res","calcFields","defaultFieldProperties","table","calc","serverFields","serverRecords","Object","entries","filter","e","map","getItemsByDataType","items","KArray","Array","[object Object]","reduce","a","b","find","push","prototype","apply","Promise","all","from","obj","kv","hasOwnProperty","visible","sortType","fmt","d3format","Number","isNaN","parseFloat","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","window","location","search","substring","split","toObject","uuidv4","replace","c","r","Math","random","schema","version","stores","getAllItems","orderBy","reverse","toArray","type","where","equals","sortBy","err","console","error","getItemByID","first","delete","putItem","put","updateItem","updateFunc","modify","reset","Dexie","baseURL","url","q","keys","JSON","stringify","fetch","credentials","reject","Error","statusText","resolve","response","blob","post","formdata","method","body","fetchProgress","command","reference","workflow","item","progress","execTime","buttonBox","label","menuButton","dropdownMenuButton","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","node","click","style","dropdownMenuFileValue","files","render","caption","confirmDialog","message","base","footer","dispatch","submitDialog","title","html","run","menu","core","storeFields","dg","nw","server","modal","document","protocol","navigator","onLine","info"],"mappings":"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"}