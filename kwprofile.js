// https://github.com/mojaie/kiwiii Version 0.10.0. Copyright 2018 Seiji Matsuoka.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):e.kwprofile=t(e.d3)}(this,function(e){"use strict";function t(e,t,r){const a=e.select("thead tr").selectAll("th").data(t);a.exit().remove(),a.enter().append("th").text(e=>e.name),r&&e.call(n,r,e=>e.key,function(e){return(t,n)=>{e.forEach(e=>{const r=n[e.key],a=t.append("td").classed("align-middle",!0);void 0!==r&&("d3_format"===e.format?a.text(o.formatNum(r,e.d3_format)):"plot"===e.format?a.text("[plot]"):"image"===e.format?a.text("[image]"):"control"===e.format?a.call(r):a.text(r))})}}(t))}function n(t,n,r,o){const a=t.select("tbody").selectAll("tr").data(n,r);a.exit().remove(),a.enter().append("tr").merge(a).each(function(t){e.select(this).selectAll("td").remove(),e.select(this).call(o,t)})}e=e&&e.hasOwnProperty("default")?e.default:e;class r extends Array{unique(e){return this.reduce((t,n)=>(void 0===t.find(t=>t[e]===n[e])&&t.push(n),t),new r)}extend(){return this.reduce((e,t)=>(Array.prototype.push.apply(e,t),e),new r)}extendAsync(){return Promise.all(this).then(e=>e.reduce((e,t)=>(Array.prototype.push.apply(e,t),e),new r))}toArray(){return Array.from(this)}toObject(){const e={};return this.forEach(t=>{e[t[0]]=t[1]}),e}}var o={defaultFieldProperties:function(e){return e.map(e=>(e.hasOwnProperty("name")||(e.name=e.key),e.hasOwnProperty("visible")||(e.visible=!0),e.hasOwnProperty("d3_format")&&(e.format="d3_format"),e.hasOwnProperty("format")||(e.format="raw"),e))},sortType:function(e){return["numeric","d3_format"].includes(e)?"numeric":["text","compound_id"].includes(e)?"text":"none"},formatNum:function(t,n){return void 0===t||null===t||Number.isNaN(t)?"":t==parseFloat(t)?e.format(n)(t):t},partialMatch:function(e,t){return void 0!==t&&null!==t&&""!==t&&-1!==t.toString().toUpperCase().indexOf(e.toString().toUpperCase())},URLQuery:function(){return r.from(window.location.search.substring(1).split("&")).map(e=>e.split("=")).toObject()},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};const a="";var s={get:function(e,t={}){const n=Object.keys(t).length?`?query=${JSON.stringify(t)}`:"";return fetch(`${a}${e}${n}`,{credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))},json:function(e){return e.json()},text:function(e){return e.text()},blob:function(e){return e.blob()},post:function(e,t){return fetch(`${a}${e}`,{method:"POST",body:t,credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))},error:function(e){return console.error(e),null}},d={buttonBox:function(e,t,n,r){e.classed("form-group",!0).classed("mb-1",!0).append("button").classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).attr("id",t).text(n)},menuButton:function(e,t,n,r){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("id",t).text(n)},menuButtonLink:function(e,t,n,r){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("role","button").attr("href","#").attr("id",t).text(n)},menuModalLink:function(e,t,n,r,o){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("role","button").attr("data-toggle","modal").attr("data-target",`#${o}`).attr("id",t).text(n)},dropdownMenuButton:function(e,t,n,r){e.classed("btn-group",!0).classed("mr-1",!0).attr("id",t),e.append("button").classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("dropdown-toggle",!0).attr("data-toggle","dropdown").text(n),e.append("div").classed("dropdown-menu",!0)},dropdownMenuItem:function(e,t,n){e.classed("dropdown-item",!0).attr("id",t).text(n)},dropdownMenuModal:function(e,t,n,r){e.classed("dropdown-item",!0).attr("id",t).attr("data-toggle","modal").attr("data-target",`#${r}`).text(n)},dropdownMenuFile:function(t,n,r,o){t.classed("dropdown-item",!0).attr("id",n).text(r).on("click",function(){e.select(this).select("input").node().click()}).append("form").style("display","none").append("input").attr("type","file").attr("accept",o)},dropdownMenuFileValue:function(e){return e.select("input").node().files[0]}},l={render:function(e,n,r,o,a){e.classed("table",!0).classed("table-striped",!0).classed("table-hover",!0).attr("id",n),r&&e.append("caption").text(r),e.append("thead").append("tr"),e.append("tbody"),o&&e.call(t,o,a)},updateHeader:t,updateContents:n};return{run:function(){e.select("#menubar").append("a").call(d.menuButton,null,"Control panel","outline-secondary").attr("href","control.html").attr("target","_blank");const t=e.select("#contents").append("div").classed("row",!0),n=t.append("div").classed("col-sm-4",!0);n.append("h5").text("Compound ID"),n.append("div").attr("id","compoundid").classed("mb-2"),n.append("h5").text("Database"),n.append("div").attr("id","compounddb").classed("mb-2"),n.append("h5").text("Structure"),n.append("div").attr("id","structure").classed("mb-2");const r=t.append("div").classed("col-sm-4",!0);r.append("h5").text("Compound properties"),r.append("table").attr("id","properties").style("display","inline-block");const a=t.append("div").classed("col-sm-4",!0);a.append("h5").text("Compound structure aliases"),a.append("table").attr("id","aliases").style("display","inline-block");const c=o.URLQuery().compound||null,i=e.select("#contents").append("div").classed("row",!0).append("div").classed("col-sm-12",!0);if(i.append("h5").text("Assay results and annotations"),i.append("input").classed("form-control",!0).attr("type","text").attr("placeholder","Search").attr("id","search"),i.append("table").attr("id","results"),!c)return;return document.location.protocol,"onLine"in navigator&&navigator.onLine,s.get("schema").then(s.json).catch(()=>{}).then(t=>(console.info("Off-line mode is disabled for debugging"),Promise.all([function(t,n){e.select("title").text(t);const r={workflow:"search",targets:n.filter(e=>"chemical"===e.domain).map(e=>e.id),key:"compound_id",values:[t]};return s.get(r.workflow,r).then(s.json).then(t=>{const r=t.records[0];e.select("#compoundid").html(r.compound_id),e.select("#compounddb").html(n.find(e=>e.id===r.__source).name),e.select("#structure").html(r.structure);const a=o.defaultFieldProperties([{key:"key"},{key:"value"}]),s=t.fields.filter(e=>!["structure","index","compound_id"].includes(e.key)).map(e=>({key:e.name,value:r[e.key]}));return e.select("#properties").call(l.render,null,null,a,s),r},s.error)}(c,t.resources).then(n=>(function(t,n){const r={workflow:"exact",targets:t.filter(e=>"chemical"===e.domain).map(e=>e.id),queryMol:{format:"dbid",source:n.__source,value:n.compound_id},params:{ignoreHs:!0}};return s.get(r.workflow,r).then(s.json).then(r=>{const a=o.defaultFieldProperties([{key:"compound_id"},{key:"database"}]),s=r.records.filter(e=>e.compound_id!==n.compound_id||e.__source!==n.__source).map(e=>({compound_id:`<a href="profile.html?compound=${e.compound_id}" target="_blank">${e.compound_id}</a>`,database:t.find(t=>t.id===e.__source).name}));e.select("#aliases").call(l.render,a,s)},s.error)})(t.resources,n)),function(t,n){const r={workflow:"profile",compound_id:t,targets:n.filter(e=>"activity"===e.domain).map(e=>e.id)};return s.get(r.workflow,r).then(s.json).then(t=>{const n=o.defaultFieldProperties([{key:"assay_id",name:"Assay ID",format:"text"},{key:"value_type",name:"Value type",format:"text"},{key:"value",name:"Value",format:"numeric"}]);e.select("#results").call(l.render,null,null,n,t.records)},s.error)}(c,t.resources)])))}}});
//# sourceMappingURL=kwprofile.js.map
