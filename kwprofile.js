// https://github.com/mojaie/kiwiii Version 0.13.1. Copyright 2018 Seiji Matsuoka.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("lodash")):"function"==typeof define&&define.amd?define(["d3","lodash"],t):e.kwprofile=t(e.d3,e._)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var n={defaultFieldProperties:function(e){return e.map(e=>(e.hasOwnProperty("name")||(e.name=e.key),e.hasOwnProperty("visible")||(e.visible=!0),e.hasOwnProperty("d3_format")&&(e.format="d3_format"),e.hasOwnProperty("format")||(e.format="raw"),e))},sortType:function(e){return["numeric","d3_format"].includes(e)?"numeric":["text","compound_id","assay_id","list"].includes(e)?"text":"none"},formatNum:function(t,n){return null==t||Number.isNaN(t)?"":t==parseFloat(t)?e.format(n)(t):t},partialMatch:function(e,t){return null!=t&&""!==t&&-1!==t.toString().toUpperCase().indexOf(e.toString().toUpperCase())},URLQuery:function(){const e=window.location.search.substring(1).split("&").map(e=>e.split("="));return t.fromPairs(e)},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};const r="";var o={get:function(e,t={}){const n=Object.keys(t).length?`?query=${JSON.stringify(t)}`:"";return fetch(`${r}${e}${n}`,{credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))},json:function(e){return e.json()},text:function(e){return e.text()},blob:function(e){return e.blob()},post:function(e,t){return fetch(`${r}${e}`,{method:"POST",body:t,credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))},error:function(e){return console.error(e),null}};var a={buttonBox:function(e,t,n,r){e.classed("form-group",!0).classed("mb-1",!0).append("button").classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).attr("id",t).text(n)},menuButton:function(e,t,n,r){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("id",t).text(n)},menuButtonLink:function(e,t,n,r){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("role","button").attr("href","#").attr("id",t).text(n)},menuModalLink:function(e,t,n,r,o){e.classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("id",t).attr("href","#").attr("role","button").attr("data-toggle","modal").attr("data-target",`#${o}`).text(n)},dropdownMenuButton:function(e,t,n,r){e.classed("btn-group",!0).classed("mr-1",!0).attr("id",t),e.append("button").classed("btn",!0).classed(`btn-${r}`,!0).classed("btn-sm",!0).classed("dropdown-toggle",!0).attr("data-toggle","dropdown").text(n),e.append("div").classed("dropdown-menu",!0)},dropdownMenuItem:function(e,t,n){e.classed("dropdown-item",!0).attr("id",t).attr("href","#").text(n)},dropdownMenuModal:function(e,t,n,r){e.classed("dropdown-item",!0).attr("id",t).attr("href","#").attr("data-toggle","modal").attr("data-target",`#${r}`).text(n)},dropdownMenuFile:function(t,n,r,o){t.classed("dropdown-item",!0).attr("id",n).attr("href","#").text(r).on("click",function(){e.select(this).select("input").node().click()}).append("form").style("display","none").append("input").attr("type","file").attr("accept",o)},dropdownMenuFileValue:function(e){return e.select("input").node().files[0]}};function d(e,t,r){const o=e.select("thead tr").selectAll("th").data(t);o.exit().remove(),o.enter().append("th").text(e=>e.name),r&&e.call(s,r,e=>e.key,function(e){return(t,r)=>{e.forEach(e=>{const o=r[e.key],a=t.append("td").classed("align-middle",!0);void 0!==o&&("d3_format"===e.format?a.text(n.formatNum(o,e.d3_format)):"plot"===e.format?a.text("[plot]"):"image"===e.format?a.text("[image]"):"control"===e.format?a.call(o):a.text(o))})}}(t))}function s(t,n,r,o){const a=t.select("tbody").selectAll("tr").data(n,r);a.exit().remove(),a.enter().append("tr").merge(a).each(function(t){e.select(this).selectAll("td").remove(),e.select(this).call(o,t)})}var l={render:function(e,t,n,r,o){e.classed("table",!0).classed("table-striped",!0).classed("table-hover",!0).attr("id",t),n&&e.append("caption").text(n),e.append("thead").append("tr"),e.append("tbody"),r&&e.call(d,r,o)},updateHeader:d,updateContents:s};return{run:function(){e.select("#menubar").append("a").call(a.menuButton,null,"Control panel","outline-secondary").attr("href","control.html").attr("target","_blank");const t=e.select("#contents").append("div").classed("row",!0),r=t.append("div").classed("col-sm-4",!0);r.append("h5").text("Compound ID"),r.append("div").attr("id","compoundid").classed("mb-2"),r.append("h5").text("Database"),r.append("div").attr("id","compounddb").classed("mb-2"),r.append("h5").text("Structure"),r.append("div").attr("id","structure").classed("mb-2");const d=t.append("div").classed("col-sm-4",!0);d.append("h5").text("Compound properties"),d.append("table").attr("id","properties").style("display","inline-block");const s=t.append("div").classed("col-sm-4",!0);s.append("h5").text("Compound structure aliases"),s.append("table").attr("id","aliases").style("display","inline-block");const c=n.URLQuery().compound||null,i=e.select("#contents").append("div").classed("row",!0).append("div").classed("col-sm-12",!0);if(i.append("h5").text("Assay results and annotations"),i.append("input").classed("form-control",!0).attr("type","text").attr("placeholder","Search").attr("id","search"),i.append("table").attr("id","results"),!c)return;return document.location.protocol,"onLine"in navigator&&navigator.onLine,o.get("schema").then(o.json).then(t=>(console.info("Off-line mode is disabled for debugging"),Promise.all([function(t,r){e.select("title").text(t);const a={workflow:"search",targets:r.filter(e=>"chemical"===e.domain).map(e=>e.id),key:"compound_id",values:[t]};return o.get(a.workflow,a).then(o.json).then(t=>{const o=t.records[0];e.select("#compoundid").html(o.compound_id),e.select("#compounddb").html(r.find(e=>e.id===o.__source).name),e.select("#structure").html(o.structure);const a=n.defaultFieldProperties([{key:"key"},{key:"value"}]),d=t.fields.filter(e=>!["structure","index","compound_id"].includes(e.key)).map(e=>({key:e.name,value:o[e.key]}));return e.select("#properties").call(l.render,null,null,a,d),o},o.error)}(c,t.resources).then(r=>(function(t,r){const a={workflow:"exact",targets:t.filter(e=>"chemical"===e.domain).map(e=>e.id),queryMol:{format:"dbid",source:r.__source,value:r.compound_id},params:{ignoreHs:!0}};return o.get(a.workflow,a).then(o.json).then(o=>{const a=n.defaultFieldProperties([{key:"compound_id"},{key:"database"}]),d=o.records.filter(e=>e.compound_id!==r.compound_id||e.__source!==r.__source).map(e=>({compound_id:`<a href="profile.html?compound=${e.compound_id}" target="_blank">${e.compound_id}</a>`,database:t.find(t=>t.id===e.__source).name}));e.select("#aliases").call(l.render,a,d)},o.error)})(t.resources,r)),function(t,r){const a={workflow:"profile",compound_id:t,targets:r.filter(e=>"activity"===e.domain).map(e=>e.id)};return o.get(a.workflow,a).then(o.json).then(t=>{const r=n.defaultFieldProperties([{key:"assay_id",name:"Assay ID",format:"text"},{key:"value_type",name:"Value type",format:"text"},{key:"value",name:"Value",format:"numeric"}]);e.select("#results").call(l.render,null,null,r,t.records)},o.error)}(c,t.resources)])),()=>{console.info("Server did not respond")})}}});
//# sourceMappingURL=kwprofile.js.map
