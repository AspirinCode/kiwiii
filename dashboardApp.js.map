{"version":3,"file":"dashboardApp.js","sources":["../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/core.js","../src/common/file.js","../src/common/sw.js","../src/component/button.js","../src/component/table.js","../src/component/modal.js","../src/component/formBox.js","../src/dialog/search.js","../src/component/formListBox.js","../src/dialog/formGroup.js","../src/dialog/struct.js","../src/dialog/filter.js","../src/dialog/sdf.js","../src/dashboardApp.js"],"sourcesContent":["\n/** @module common/misc */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, formatNum, partialMatch, URLQuery, uuidv4\n};\n","\n/** @module common/idb */\n\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\n\n\nconst schema = {\n  items: 'storeID, dataType, created'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('created')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by data type\n * @param {string} type - 'nodes' or 'edges'\n * @return {array} data store objects\n */\nfunction getItemsByDataType(type) {\n  return idb.items\n    .where('dataType')\n    .equals(type)\n    .reverse()\n    .sortBy('created')\n    .catch(err => {\n      console.error(`IDBError: Unexpected dataType: ${type}`, err);\n    });\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItemByID(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction putItem(data) {\n  if (!data.storeID) {\n    data.storeID = misc.uuidv4();\n  }\n  return idb.items.put(data);\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\nexport default {\n  getAllItems, getItemsByDataType, getItemByID,\n  deleteItem, putItem, updateItem, reset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module common/core */\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as misc} from './misc.js';\n\n\nfunction serverStatus() {\n  const response = {};\n  return fetcher.get('server')\n    .then(fetcher.json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => fetcher.get('schema'))\n    .then(fetcher.json)\n    .then(res => {\n      response.schema = res;\n    })\n    .catch(() => {\n      console.info('Server did not respond');\n      response.server = {};\n      response.schema = {\n        resources: [], templates: [], compoundIDPlaceholder: null\n      };\n    })\n    .then(() => response);\n}\n\n\nfunction fetchProgress(storeID, command='update') {\n  return idb.getItemByID(storeID)\n    .then(data => {\n      if (!data) return Promise.reject(`Store: ${storeID} is not available`);\n      if (!['ready', 'running'].includes(data.status)) return;\n      const query = {id: data.reference.workflow, command: command};\n      return fetcher.get('progress', query)\n        .then(fetcher.json)\n        .then(data => {\n          if (data.status === 'failure') {  // No data found on server\n            return idb.updateItem(storeID, item => {\n              item.status = 'failure';\n            });\n          }\n          return idb.updateItem(storeID, item => {\n            item.status = data.status;\n            item.progress = data.progress;\n            item.execTime = data.execTime;\n            item.fields = misc.defaultFieldProperties(data.fields);\n            item.records = data.records;\n          });\n        });\n    });\n}\n\n\nexport default {\n  serverStatus, fetchProgress\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const c = compress ? 'c' : 'r';\n  const ext = json.hasOwnProperty('edges') ? `.gf${c}` :  `.nd${c}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/sw */\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker\n      .register('sw.js')\n      .then(reg => {\n        console.info('ServiceWorker registration successful with scope: ', reg.scope);\n      }).catch(err => {\n        console.info('ServiceWorker registration failed: ', err);\n      });\n  } else {\n    console.info('Off-line mode is not supported');\n  }\n}\n\n\nexport default {\n  registerServiceWorker\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\n\nfunction buttonBox(selection, id, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type, id) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon, id) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#')\n      .attr('id', id);\n  selection.append('img')\n      .attr('src', icon ? `./assets/icon/${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon, id) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `./assets/icon/${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon, id) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true)\n      .attr('id', id);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `./assets/icon/${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon, id) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `./assets/icon/${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon, id) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `./assets/icon/${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon, id) {\n  selection.classed('dropdown-item', true)\n      .attr('id', id)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `./assets/icon/${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/table */\n\n// Simple tables\n// use dataGrid.js for interactive and smooth datatable\n\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction render(selection, id, caption, fields, records) {\n  selection\n      .classed('table', true)\n      .classed('table-striped', true)\n      .classed('table-hover', true)\n      .attr('id', id);\n  if (caption) {\n    selection.append('caption').text(caption);\n  }\n  selection.append('thead').append('tr');\n  selection.append('tbody');\n  if (fields) {\n    selection.call(updateHeader, fields, records);\n  }\n}\n\n\nfunction updateHeader(selection, fields, records) {\n  const header = selection.select('thead tr')\n    .selectAll('th')\n      .data(fields);\n  header.exit().remove();\n  header.enter().append('th')\n      .text(d => d.name);\n  if (records) {\n    selection.call(updateContents, records, d => d.key, updateRowFunc(fields));\n  }\n}\n\n\nfunction updateContents(selection, records, keyFunc, rowFactory) {  // TODO: specify key\n  const rows = selection.select('tbody')\n    .selectAll('tr')\n      .data(records, keyFunc);\n  rows.exit().remove();\n  rows.enter().append('tr')\n    .merge(rows)\n      .each(function (d) {\n        d3.select(this).selectAll('td').remove();\n        d3.select(this).call(rowFactory, d);\n      });\n}\n\n\nfunction updateRowFunc(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const value = record[field.key];\n      const cell = selection.append('td')\n        .classed('align-middle', true);\n      if (value === undefined) return;\n      if (field.format === 'd3_format') {\n        cell.text(misc.formatNum(value, field.d3_format));\n      }\n      else if (field.format === 'plot') {\n        cell.text('[plot]');\n      }\n      else if (field.format === 'image') {\n        cell.text('[image]');\n      }\n      else if (field.format === 'control') {\n        cell.call(value);\n      } else {\n        cell.text(value);\n      }\n    });\n  };\n}\n\n\nexport default {\n  render, updateHeader, updateContents\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.select('.modal-dialog').remove();  // Clean up\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id, message) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true)\n      .text(message);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, submitDialog\n};\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, id, label, size, value) {  // TODO: remove size\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .attr('size', size);\n  selection.call(updateTextBox, value);\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, id, label, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'text')\n      .property('readonly', true);\n  selection.call(updateTextBox, value);\n}\n\n\nfunction textareaBox(selection, id, label, rows, placeholder, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .attr('id', id);\n  selection.call(updateTextareaBox, value);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, id, label, checked) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox')\n      .attr('id', id);\n  box.append('span')\n      .text(label);\n  selection.call(updateCheckBox, checked);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, id, label, min, max, step, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n  selection.call(updateNumberBox, value);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label, value) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n  selection\n      .call(updateColorBox, value)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, id, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .attr('for', id)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept)\n    .attr('id', id);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberBoxValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, fileInputBoxValue\n};\n","\n/** @module dialog/search */\n\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'search-dialog';\nconst title = 'Search by compound ID';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'searchtext');\n}\n\n\nfunction body(selection, placeholder) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('ids', true)\n      .call(box.textareaBox, 'search-query', 'Query', 20, placeholder, '');\n}\n\n\nfunction query(selection, targets) {\n  return {\n    workflow: 'search',\n    targets: targets,\n    key: 'compound_id',\n    values: box.textareaBoxLines(selection.select('.ids'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, id, label, fields, value) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .attr('for', id)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(selectBoxItems, fields);\n    selection.call(updateSelectBox, value);\n  }\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, id, label, fields, values) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('id', id);\n  if (fields) {\n    selection.call(checklistBoxItems, fields);\n    selection.call(updateChecklistBox, values);\n  }\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection, id, resources) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-format`, 'Format',\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ], 'molfile');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, `${id}-source`, 'Source', res, null);\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, `${id}-textquery`, 'Query', null, '');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, `${id}-areaquery`, 'Query', 6, null, '');\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary');\n  selection.call(updateQueryMolGroup);\n}\n\nfunction updateQueryMolGroup(selection) {\n  selection.select('.format')\n    .on('change', function () {\n      const value = lbox.selectBoxValue(d3.select(this));\n      selection.select('.source')\n        .select('select')\n          .property('disabled', value !== 'dbid');\n      selection.select('.textquery')\n          .property('hidden', value !== 'dbid');\n      selection.select('.areaquery')\n          .property('hidden', value !== 'molfile');\n    })\n    .dispatch('change');\n  selection.select('.preview')\n    .on('click', function () {\n      const query = queryMolGroupValue(selection);\n      return fetcher.get('strprev', query)\n        .then(fetcher.text)\n        .then(res => d3.select('#previmg').html(res), fetcher.error);\n    });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\n\nfunction simOptionGroup(selection, id) {\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, `${id}-ignoreh`, 'Ignore explicit hydrogens', true);\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-timeout`, 'Timeout', 1, 999, 1, 2);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-diam`, 'Diameter (MCS-DR/GLS)', 4, 999, 1, 8);\n  collapse.append('div')\n      .classed('tree', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, `${id}-tree`, 'Max tree size (MCS-DR/GLS)', 20, 999, 1, 40);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const tree = selection.select('.tree');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxValue(diam);\n  }\n  if (!tree.select('input').property('disabled')) {\n    query.maxTreeSize = box.numberBoxValue(tree);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue,\n  simOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/struct */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'struct-dialog';\nconst title = 'Search by structure';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'searchchem');\n}\n\n\nfunction body(selection, resources, rdk) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Query molecule\n  dialog.select('.modal-body').append('div')\n      .classed('qmol', true)\n      .call(group.queryMolGroup, 'struct', resources, null);\n  // Search type\n  const methodList = [\n    {key: 'exact', name: 'Exact match'},\n    {key: 'substr', name: 'Substructure'},\n    {key: 'supstr', name: 'Superstructure'},\n    {key: 'gls', name: 'MCS-DR/GLS'}\n  ];\n  if (rdk) {\n    methodList.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    methodList.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  dialog.select('.modal-body').append('div')\n      .classed('method', true)\n      .call(lbox.selectBox, 'struct-method', 'Method', methodList, 'exact');\n  // Measure\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'struct-measure', 'Measure',\n            [\n              {key: 'sim', name: 'Similarity'},\n              {key: 'edge', name: 'Edge count'}\n            ], 'sim');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'struct-thld', 'Threshold',\n            0.5, 1, 0.01, 0.5);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup, 'struct');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n\n  // Events\n  dialog.select('.method')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        const mcs = ['gls', 'rdfmcs'].includes(value);\n        dialog.select('.measure')\n          .select('select')\n            .property('value', mcs ? undefined : 'sim')\n            .property('disabled', !mcs);\n        dialog.selectAll('.thld')\n          .select('input')\n            .property('disabled', ['exact', 'substr', 'supstr'].includes(value));\n        dialog.selectAll('.diam, .tree')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        dialog.select('.timeout')\n          .select('input')\n            .property('disabled', !mcs);\n      })\n      .dispatch('change');\n}\n\n\nfunction query(selection) {\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxValue(thld);\n  }\n  const query = {\n    workflow: lbox.selectBoxValue(selection.select('.method')),\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    queryMol: group.queryMolGroupValue(selection.select('.qmol')),\n    params: params\n  };\n  return query;\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/filter */\n\nimport _ from 'lodash';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'filter-dialog';\nconst title = 'Search by properties';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'searchprop');\n}\n\n\nfunction body(selection, resources) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const fields = _(resources.map(e => e.fields))\n    .flatten()\n    .uniqBy('key')\n    .value()\n    .filter(e => e.hasOwnProperty('d3_format')\n                 || ['compound_id', 'numeric', 'text'].includes(e.format));\n  dialog.select('.modal-body').append('div')\n    .classed('key', true)\n    .call(lbox.selectBox, 'filter-field', 'Field', fields, null);\n  dialog.select('.modal-body').append('div')\n    .classed('operator', true)\n    .call(lbox.selectBox, 'filter-op', 'Operator',\n          [\n            {key: 'eq', name: '='},\n            {key: 'gt', name: '>'},\n            {key: 'lt', name: '<'},\n            {key: 'ge', name: '>='},\n            {key: 'le', name: '>='},\n            {key: 'lk', name: 'LIKE'}\n          ], 'eq');\n  dialog.select('.modal-body').append('div')\n    .classed('value', true)\n    .call(box.textBox, 'filter-value', 'Value', null, '');\n  // Targets\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'struct-target', 'Target databases', res, null);\n}\n\n\nfunction query(selection) {\n  return {\n    workflow: 'filter',\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    key: lbox.selectBoxValue(selection.select('.key')),\n    value: box.textBoxValue(selection.select('.value')),\n    operator: lbox.selectBoxValue(selection.select('.operator'))\n  };\n}\n\n\nexport default {\n  menuLink, body, query\n};\n","\n/** @module dialog/sdf */\n\nimport d3 from 'd3';\n\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nfunction getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n\n\nconst id = 'sdf-dialog';\nconst title = 'Import SDFile';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'importsdf');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'sdf-file', 'File', '.mol,.sdf');\n  dialog.select('.modal-body').append('div')\n      .classed('field', true)\n      .call(lbox.checklistBox, 'sdf-fields', 'Fields', [], null);\n  dialog.select('.modal-body').append('div')\n      .classed('implh', true)\n      .call(box.checkBox, 'sdf-implh', 'Make hydrogens implicit', true);\n  dialog.select('.modal-body').append('div')\n      .classed('recalc', true)\n      .call(box.checkBox, 'sdf-recalc', 'Recalculate 2D coords', false);\n\n  dialog.select('.file')\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        // Scan only first 100mb of the file due to memory limit.\n        return hfile.readFile(file, 100 * 1024 * 1024, false)\n          .then(data => {\n            const fields = getSDFPropList(data)\n              .map(e => ({key: e, name: e}));\n            dialog.select('.field')\n              .call(lbox.checklistBoxItems, fields);\n          });\n      });\n}\n\n\nfunction queryFormData(selection) {\n  const params = {\n    fields: lbox.checklistBoxValue(selection.select('.field')),\n    implh: box.checkBoxValue(selection.select('.implh')),\n    recalc: box.checkBoxValue(selection.select('.recalc'))\n  };\n  const formData = new FormData();\n  formData.append('contents', box.fileInputBoxValue(selection.select('.file')));\n  formData.append('params', JSON.stringify(params));\n  return formData;\n}\n\n\n\nexport default {\n  menuLink, body, queryFormData\n};\n","\n/** @module dashboardApp */\n\nimport d3 from 'd3';\n\nimport {default as core} from './common/core.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\nimport {default as sw} from './common/sw.js';\n\nimport {default as button} from './component/button.js';\nimport {default as table} from './component/table.js';\nimport {default as modal} from './component/modal.js';\n\nimport {default as searchDialog} from './dialog/search.js';\nimport {default as structDialog} from './dialog/struct.js';\nimport {default as filterDialog} from './dialog/filter.js';\nimport {default as sdfDialog} from './dialog/sdf.js';\n\n\nfunction registerDatagrid(data) {\n  data.fields = misc.defaultFieldProperties(data.fields);\n  idb.putItem(data)\n    .then(storeID => {\n      window.open(`datagrid.html?id=${storeID}`, '_blank');\n    });\n}\n\n\nfunction registerNetwork(data) {\n  return idb.putItem(data.nodes)\n    .then(storeID => {\n      data.edges.reference.nodes = storeID;\n      return idb.putItem(data.edges);\n    })\n    .then(storeID => {\n      window.open(`network.html?id=${storeID}`, '_blank');\n    });\n}\n\n\nfunction updateStoreRow(selection, record) {\n  selection.append('td')\n      .classed('name', true)\n      .text(record.name);\n  selection.append('td')\n      .classed('status', true)\n      .text(record.status);\n  selection.append('td')\n      .classed('size', true)\n      .text(record.records.length);\n  const action = selection.append('td')\n      .classed('action', true);\n  const app = {nodes: 'datagrid', edges: 'network'};\n  action.append('a')\n      .call(button.menuButtonLink, 'Open', 'primary', 'open-white')\n      .attr('href', `${app[record.dataType]}.html?id=${record.storeID}`)\n      .attr('target', '_blank');\n  const ongoing = ['running', 'ready'].includes(record.status);\n  action.append('a')\n      .call(button.menuModalLink, 'delete-dialog', 'Delete', 'warning', 'delete-gray')\n      .property('disabled', ongoing)\n      .on('click', () =>{\n        d3.select('#delete-dialog')\n          .select('.message')\n            .text(`Are you sure you want to delete ${record.name} ?`);\n        d3.select('#delete-dialog')\n          .select('.ok')\n          .on('click', () => idb.deleteItem(record.storeID).then(updateStoredData));\n      })\n    .select('.label')\n      .text(ongoing ? 'Running' : 'Delete');\n}\n\n\nfunction updateStoredData() {\n  // Stored datagrid\n  idb.getItemsByDataType('nodes')\n    .then(items => {\n      d3.select('#contents').select('.dg')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n  // Stored network\n  idb.getItemsByDataType('edges')\n    .then(items => {\n      d3.select('#contents').select('.nw')\n        .call(table.updateContents, items, d => d.storeID, updateStoreRow);\n    });\n}\n\n\nfunction updateServerStatus(status) {\n  // Server calculation jobs\n  const calcFields = misc.defaultFieldProperties([\n    {key: 'id', name: 'Workflow ID', format: 'text'},\n    {key: 'size', name: 'File size', d3_format: '.3s'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'created', name: 'Created', format: 'date'},\n    {key: 'expires', name: 'Expires', format: 'date'}\n  ]);\n  d3.select('#contents').select('.calc')\n    .call(table.updateHeader, calcFields, status.server.calc.records);\n  // Server status\n  const serverFields = misc.defaultFieldProperties([\n    {key: 'key', name: 'Key', format: 'text'},\n    {key: 'value', name: 'Value', format: 'text'}\n  ]);\n  const serverRecords = Object.entries(status.server)\n    .filter(e => e[0] !== 'calc')\n    .map(e => ({key: e[0], value: e[1]}));\n  d3.select('#contents').select('.server')\n    .call(table.updateHeader, serverFields, serverRecords);\n}\n\n\nfunction app(status) {\n  // menubar\n  const menubar = d3.select('#menubar');\n  // Datagrid\n  const dgmenu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Datagrid', 'primary', 'plus-white')\n      .select('.dropdown-menu');\n  dgmenu.append('a').classed('online-command', true)\n      .call(searchDialog.menuLink);\n  dgmenu.append('a').classed('online-command', true)\n      .call(structDialog.menuLink);\n  dgmenu.append('a').classed('online-command', true)\n      .call(filterDialog.menuLink);\n  dgmenu.append('a').classed('online-command', true)\n      .call(sdfDialog.menuLink);\n  dgmenu.append('a')\n      .call(button.dropdownMenuFile, 'Import JSON', '.ndc,.ndr,.json,.gz', 'import')\n      .on('change', function () {\n        const file = button.dropdownMenuFileValue(d3.select(this));\n        hfile.loadJSON(file).then(registerDatagrid);\n      });\n\n  // disable on-line commands\n  if (!status.server.instance) {\n    menubar.selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true);\n  }\n  // Network\n  const nwmenu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Network', 'primary', 'plus-white')\n      .select('.dropdown-menu');\n  nwmenu.append('a')\n      .call(button.dropdownMenuFile, 'Import JSON', '.gfc,.gfr,.json,.gz', 'import')\n      .on('change', function () {\n        const file = button.dropdownMenuFileValue(d3.select(this));\n        hfile.loadJSON(file).then(registerNetwork);\n      });\n  // Refresh\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Refresh all', 'outline-secondary', 'refresh-gray')\n      .on('click', () => {\n        idb.getAllItems()\n          .then(items => Promise.all(items.map(item => core.fetchProgress(item.storeID))))\n          .then(updateStoredData);\n        core.serverStatus()\n          .then(updateServerStatus);\n      });\n  // Delete all\n  menubar.append('a')\n      .call(button.menuModalLink, 'reset-dialog',\n            'Reset local datastore', 'warning', 'delete-gray');\n  // Stored data\n  const storeFields = misc.defaultFieldProperties([\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'size', name: 'Records', d3_format: 'd'},\n    {key: 'action', name: 'Action', format: 'control'}\n  ]);\n  // Stored datagrids\n  d3.select('#contents')\n      .style('padding-left', '10%')\n      .style('padding-right', '10%');\n  const dg = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  dg.append('h5')\n      .text('Datagrids on local storage');\n  dg.append('table')\n      .classed('dg', true)\n      .call(table.render, null, null, storeFields);\n  // Stored networks\n  const nw = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  nw.append('h5')\n      .text('Networks on local storage');\n  nw.append('table')\n      .classed('nw', true)\n      .call(table.render, null, null, storeFields);\n  updateStoredData();\n  // Server calc jobs\n  const calc = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  calc.append('h5')\n      .text('Server calculation job');\n  calc.append('table')\n      .classed('calc', true)\n      .call(table.render);\n  // Server status\n  const server = d3.select('#contents')\n    .append('div')\n      .classed('py-4', true);\n  server.append('h5')\n      .text('Server status');\n  server.append('table')\n      .classed('server', true)\n      .call(table.render);\n  updateServerStatus(status);\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n  const chemrsrc = status.schema.resources.filter(e => e.domain === 'chemical');\n  dialogs.append('div')\n      .call(modal.confirmDialog, 'reset-dialog',\n            'Are you sure you want to delete all local tables and reset the datastore ?')\n    .select('.ok')\n      .on('click', () => idb.reset().then(updateStoredData));\n  dialogs.append('div')\n      .call(modal.confirmDialog, 'delete-dialog', null);\n  dialogs.append('div')\n      .call(searchDialog.body, status.schema.compoundIDPlaceholder)\n      .on('submit', function () {\n        const targets = chemrsrc.map(e => e.id);\n        const query = searchDialog.query(d3.select(this), targets);\n        return fetcher.get(query.workflow, query)\n          .then(fetcher.json)\n          .then(registerDatagrid);\n      });\n  dialogs.append('div')\n      .call(structDialog.body, chemrsrc, status.server.rdkit)\n      .on('submit', function () {\n        const query = structDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(fetcher.json)\n          .then(registerDatagrid);\n      });\n  dialogs.append('div')\n      .call(filterDialog.body, chemrsrc)\n      .on('submit', function () {\n        const query = filterDialog.query(d3.select(this));\n        return fetcher.get(query.workflow, query)\n          .then(fetcher.json)\n          .then(registerDatagrid);\n      });\n  dialogs.append('div')\n      .call(sdfDialog.body, chemrsrc)\n      .on('submit', function () {\n        const formData = sdfDialog.queryFormData(d3.select(this));\n        return fetcher.post('sdfin', formData)\n          .then(fetcher.json)\n          .then(registerDatagrid);\n      });\n}\n\n\nfunction run() {\n  // TODO: show browser status\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  if (debug) {\n    console.info('Off-line mode is disabled for debugging');\n  } else {\n    sw.registerServiceWorker();\n  }\n  return core.serverStatus()\n    .then(app);\n}\n\n\nexport default {\n  run\n};\n"],"names":["defaultFieldProperties","fields","map","e","hasOwnProperty","name","key","visible","format","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","partialMatch","query","target","toString","toUpperCase","indexOf","URLQuery","pairs","window","location","search","substring","split","_","fromPairs","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","version","stores","getAllItems","orderBy","reverse","toArray","getItemsByDataType","type","where","equals","sortBy","catch","err","console","error","getItemByID","storeID","first","deleteItem","delete","putItem","data","misc","put","updateItem","updateFunc","modify","reset","then","baseURL","get","url","q","Object","keys","length","JSON","stringify","fetch","credentials","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","serverStatus","fetcher","server","info","resources","templates","compoundIDPlaceholder","fetchProgress","command","id","reference","workflow","item","progress","execTime","records","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","event","result","onerror","readAsArrayBuffer","readAsText","parseJSON","compressed","pako","inflate","to","parse","downloadDataFile","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","registerServiceWorker","navigator","serviceWorker","register","reg","scope","buttonBox","selection","label","classed","append","attr","menuButton","menuButtonLink","icon","style","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","select","this","node","click","dropdownMenuFileValue","files","updateHeader","header","selectAll","exit","remove","enter","d","call","updateContents","record","forEach","field","cell","undefined","d3_format","updateRowFunc","keyFunc","rowFactory","rows","merge","each","render","caption","dialogBase","confirmDialog","message","base","footer","dispatch","submitDialog","title","html","updateTextBox","property","updateTextareaBox","updateCheckBox","checked","updateNumberBox","updateColorBox","textBox","size","textBoxValue","readonlyBox","textareaBox","placeholder","textareaBoxValue","textareaBoxLines","filter","checkBox","box","checkBoxValue","numberBox","min","max","step","numberBoxValue","colorBox","stopPropagation","colorBoxValue","fileInputBox","fileInputBoxValue","menuLink","modal","targets","values","selectBoxItems","options","updateSelectBox","checklistBoxItems","listitems","form","updateChecklistBox","selectBox","selectBoxValue","checklistBox","checklistBoxValue","updateQueryMolGroup","lbox","queryMolGroupValue","source","textquery","areaquery","queryMolGroup","$","popover","trigger","simOptionGroup","collapse","simOptionGroupValue","timeout","diam","tree","ignoreHs","diameter","maxTreeSize","rdk","dialog","group","methodList","push","mcs","params","measure","thld","threshold","queryMol","flatten","uniqBy","operator","hfile","re","uniqCols","Set","arr","exec","add","Array","from","getSDFPropList","queryFormData","implh","recalc","formData","FormData","registerDatagrid","open","registerNetwork","nodes","edges","updateStoreRow","action","dataType","ongoing","updateStoredData","table","updateServerStatus","calcFields","calc","serverFields","serverRecords","entries","app","menubar","dgmenu","searchDialog","structDialog","filterDialog","sdfDialog","instance","all","core","storeFields","dg","nw","dialogs","chemrsrc","domain","rdkit","run","protocol","onLine","debug","sw"],"mappings":"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"}