<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: datagrid/newDatagrid.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: datagrid/newDatagrid.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/** @module datagrid/newDatagrid */

import d3 from 'd3';

import {default as misc} from '../common/misc.js';
import {default as idb} from '../common/idb.js';
import {default as fetcher} from '../common/fetcher.js';
import {default as hfile} from '../common/file.js';

import {default as button} from '../component/button.js';

import {default as searchDialog} from '../dialog/search.js';
import {default as structDialog} from '../dialog/struct.js';
import {default as filterDialog} from '../dialog/filter.js';
import {default as sdfDialog} from '../dialog/sdf.js';

import {default as datagridApp} from './datagridApp.js';


function registerWorkflow(fetched) {
  return fetcher.json(fetched)
    .then(data => {
      data.fields = misc.defaultFieldProperties(data.fields);
      return data;
    })
    .then(idb.putItem)
    .then(storeID => {
      window.location = `datagrid.html?id=${storeID}`;
    });
  }


function app(serverStatus, schema) {
  // Menubar
  const menubar = d3.select('#menubar');
  menubar.selectAll('div,span,a').remove();  // Clean up
  // New datagrid menu
  const menu = menubar.append('div')
      .call(button.dropdownMenuButton, null, '+ New datagrid', 'primary')
      .select('.dropdown-menu');
  menu.append('a')
      .classed('searchd', true)
      .call(searchDialog.menuLink);
  menu.append('a')
      .classed('structd', true)
      .call(structDialog.menuLink);
  menu.append('a')
      .classed('filterd', true)
      .call(filterDialog.menuLink);
  menu.append('a')
      .classed('sdfd', true)
      .call(sdfDialog.menuLink);
  menu.append('a')
      .classed('import', true)
      .call(button.dropdownMenuFile, 'import', 'Import view', '.ndc,.ndr,.json,.gz')
      .on('change', function () {
        const file = button.dropdownMenuFileValue(d3.select(this));
        hfile.loadJSON(file)
          .then(item => datagridApp.app(item, serverStatus, schema));
      });
  // Control panel
  menubar.append('a')
      .call(button.menuButtonLink, null, 'Control panel', 'outline-secondary')
      .attr('href', 'control.html')
      .attr('target', '_blank');

  // Dialogs
  const dialogs = d3.select('#dialogs');
  dialogs.selectAll('div').remove();  // Clean up
  if (!schema) {
    menu.selectAll('.searchd, .structd, .filterd, .sdfd')
      .property('disabled', true);
    return;
  }
  const chemrsrc = schema.resources.filter(e => e.domain === 'chemical');
  // ID search
  dialogs.append('div')
      .call(searchDialog.body, schema.compoundIDPlaceholder)
      .on('submit', function () {
        const targets = chemrsrc.map(e => e.id);
        const query = searchDialog.query(d3.select(this), targets);
        return fetcher.get(query.workflow, query)
          .then(registerWorkflow);  // TODO: if err -> show err img
      });
  // Structure search
  dialogs.append('div')
      .call(structDialog.body, chemrsrc, serverStatus.rdkit)
      .on('submit', function () {
        const query = structDialog.query(d3.select(this));
        return fetcher.get(query.workflow, query)
          .then(registerWorkflow);
      });
  // Filter
  dialogs.append('div')
      .call(filterDialog.body, chemrsrc)
      .on('submit', function () {
        const query = filterDialog.query(d3.select(this));
        return fetcher.get(query.workflow, query)
          .then(registerWorkflow);
      });
  // Import SDFile
  dialogs.append('div')
      .call(sdfDialog.body, chemrsrc)
      .on('submit', function () {
        const formData = sdfDialog.queryFormData(d3.select(this));
        return fetcher.post('sdfin', formData)
          .then(registerWorkflow);
      });
}


export default {
  app
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-common_core.html">common/core</a></li><li><a href="module-common_fetcher.html">common/fetcher</a></li><li><a href="module-common_file.html">common/file</a></li><li><a href="module-common_idb.html">common/idb</a></li><li><a href="module-common_image.html">common/image</a></li><li><a href="module-common_KArray.html">common/KArray</a></li><li><a href="module-common_legacySchema.html">common/legacySchema</a></li><li><a href="module-common_mapper.html">common/mapper</a></li><li><a href="module-common_misc.html">common/misc</a></li><li><a href="module-common_scale.html">common/scale</a></li><li><a href="module-common_sw.html">common/sw</a></li><li><a href="module-component_button.html">component/button</a></li><li><a href="module-component_formBox.html">component/formBox</a></li><li><a href="module-component_formBoxGroup.html">component/formBoxGroup</a></li><li><a href="module-component_formListBox.html">component/formListBox</a></li><li><a href="module-component_formRangeBox.html">component/formRangeBox</a></li><li><a href="module-component_modal.html">component/modal</a></li><li><a href="module-component_table.html">component/table</a></li><li><a href="module-control.html">control</a></li><li><a href="module-datagrid.html">datagrid</a></li><li><a href="module-datagrid_component.html">datagrid/component</a></li><li><a href="module-datagrid_datagridApp.html">datagrid/datagridApp</a></li><li><a href="module-datagrid_newDatagrid.html">datagrid/newDatagrid</a></li><li><a href="module-datagrid_rowFilter.html">datagrid/rowFilter</a></li><li><a href="module-datagrid_sort.html">datagrid/sort</a></li><li><a href="module-datagrid_state.html">datagrid/state</a></li><li><a href="module-datagrid_view.html">datagrid/view</a></li><li><a href="module-dialog_community.html">dialog/community</a></li><li><a href="module-dialog_fieldConfig.html">dialog/fieldConfig</a></li><li><a href="module-dialog_fieldFetch.html">dialog/fieldFetch</a></li><li><a href="module-dialog_fieldFile.html">dialog/fieldFile</a></li><li><a href="module-dialog_filter.html">dialog/filter</a></li><li><a href="module-dialog_formGroup.html">dialog/formGroup</a></li><li><a href="module-dialog_networkgen.html">dialog/networkgen</a></li><li><a href="module-dialog_rename.html">dialog/rename</a></li><li><a href="module-dialog_sdf.html">dialog/sdf</a></li><li><a href="module-dialog_search.html">dialog/search</a></li><li><a href="module-dialog_struct.html">dialog/struct</a></li><li><a href="module-network.html">network</a></li><li><a href="module-network_communityDetection.html">network/communityDetection</a></li><li><a href="module-network_component.html">network/component</a></li><li><a href="module-network_controlBox.html">network/controlBox</a></li><li><a href="module-network_force.html">network/force</a></li><li><a href="module-network_interaction.html">network/interaction</a></li><li><a href="module-network_networkApp.html">network/networkApp</a></li><li><a href="module-network_state.html">network/state</a></li><li><a href="module-network_view.html">network/view</a></li><li><a href="module-profile.html">profile</a></li><li><a href="module-testAPI.html">testAPI</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Feb 22 2018 21:42:17 GMT+0900 (JST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
