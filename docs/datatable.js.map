{"version":3,"file":"datatable.js","sources":["../src/helper/d3Selection.js","../src/helper/definition.js","../src/helper/file.js","../src/store/StoreConnection.js","../src/Loader.js","../src/helper/dataStructure.js","../src/helper/formatValue.js","../src/helper/parser.js","../src/helper/image.js","../src/component/Component.js","../src/component/Dialog.js","../src/component/Header.js","../src/component/DataGrid.js","../src/datatable.js","../src/store/IDBStore.js","../src/fetcher/Fetcher.js","../src/fetcher/LocalServer.js","../src/fetcher/Screener.js","../src/fetcher/ScreenerTestStub.js"],"sourcesContent":["\nimport d3 from 'd3';\n\n\nexport function formValue(selector) {\n  return d3.select(selector).node().value;\n}\n\n\nexport function formInt(selector) {\n  return parseInt(d3.select(selector).node().value);\n}\n\n\nexport function formFloat(selector) {\n  return parseFloat(d3.select(selector).node().value);\n}\n\n\nexport function formChecked(selector) {\n  return d3.select(selector).node().checked;\n}\n\n\nexport function firstFile(selector) {\n  return d3.select(selector).node().files[0];\n}\n\n\nexport function checkboxValues(selector) {\n  return d3.selectAll(selector).selectAll('input:checked').nodes().map(e => e.value);\n}\n\n\nexport function selectedOptionValues(selector) {\n  return d3.selectAll(selector).selectAll('select').nodes().map(e => e.value);\n}\n\n\nexport function textareaLines(selector) {\n  return d3.select(selector).node().value.split('\\n').filter(e => e.length > 0);\n}\n\n\nexport function selectedOptionData(selector) {\n  const si = d3.select(selector).property('selectedIndex');\n  return d3.select(selector).selectAll('option').data().find((d, i) => i === si);\n}\n\n\nexport function selectedCheckboxesData(selector) {\n  return d3.selectAll(selector).selectAll('input:checked').data();\n}\n","\nexport function fetchable(tbl) {\n  return ['In progress', 'Queued', 'Aborting'].includes(tbl.status);\n}\n\n\nexport function abortRequestable(tbl) {\n  return ['In progress', 'Queued'].includes(tbl.status);\n}\n\n\nexport function conclike(col) {\n  return col.hasOwnProperty('valueType')\n    && ['AC50', 'IC50', 'ED50'].includes(col.valueType);\n}\n\n\nexport function dataSourceId(domain, resource, column) {\n  return [domain, resource, column]\n    .map(e => e.capitalize())\n    .join('');  // DomainResourceColumn\n}\n","\nimport pako from 'pako';\n\n\nexport function readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nexport function parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nexport function loadJSON(file) {\n  const compressed = file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nexport function fetchJSON(url) {\n  const compressed = url.endsWith('.gz');\n  return fetch(url)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nexport function downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = \"data:application/json,\" + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent(\"click\", {\n      \"view\": window,\n      \"bubbles\": true,\n      \"cancelable\": false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nexport function downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = compress ? '.gz' : '';\n  downloadDataFile(data, `${name}.json${ext}`);\n}\n","\nimport {dataSourceId} from '../helper/definition.js';\nimport {default as store} from './IDBStore.js';\nimport {LocalServerActivity, LocalServerChemical} from '../fetcher/LocalServer.js';\nimport {ScreenerFitting, ScreenerRawValue} from '../fetcher/Screener.js';\nimport {ScreenerFittingStub, ScreenerRawValueStub} from '../fetcher/ScreenerTestStub.js';\n\n\n// Global config\n\nconst globalConfig = {\n  \"onLine\": true,\n  \"server\": {},\n  \"templates\": {},\n  \"urlQuery\": {}\n};\n\nwindow.location.search.substring(1).split(\"&\")\n  .map(e => e.split('=')).forEach(e => {\n    globalConfig.urlQuery[e[0]] = e[1];\n  });\n\n\nexport function getGlobalConfig(key) {\n  return globalConfig[key];\n}\n\n\nexport function setGlobalConfig(key, value) {\n  globalConfig[key] = value;\n}\n\n\n// API instances\n\nconst API = new Map(Object.entries({\n  chemical: new LocalServerChemical(),\n  activity: new LocalServerActivity(),\n  screenerrawvalue: new ScreenerRawValue(),\n  screenerfitting: new ScreenerFitting(),\n  screenerrawvaluestub: new ScreenerRawValueStub(),\n  screenerfittingstub: new ScreenerFittingStub()\n}));\n\n\nexport function localChemInstance() {\n  return API.get('chemical');\n}\n\n\nexport function getFetcher(domain) {\n  return API.get(domain);\n}\n\n\nexport function fetcherInstances() {\n  return Array.from(API.values());\n}\n\n\nexport function dataFetcherInstances() {\n  const res = [];\n  API.forEach((v, k) => {\n    if (k !== 'chemical') res.push(v);\n  });\n  return res;\n}\n\n\nexport function dataFetcherDomains() {\n  const res = [];\n  API.forEach((v, k) => {\n    if (k !== 'chemical') res.push(k);\n  });\n  return res;\n}\n\n\n// API data resource on local IndexedDB\n\nexport function getResources(domains) {\n  return store.getResources().then(rsrcs => {\n    return rsrcs.filter(e => domains.includes(e.domain));\n  });\n}\n\n\nexport function setResources(rsrcs) {\n  return store.putResources(rsrcs);\n}\n\n\nexport function getResourceColumns(domains) {\n  return getResources(domains).then(rsrcs => {\n    return rsrcs.map(rsrc => {\n      return rsrc.columns.map(col => {\n        col.domain = rsrc.domain;\n        col.key = dataSourceId(rsrc.domain, rsrc.id, col.key);\n        col.entity = rsrc.entity;\n        if (!col.hasOwnProperty('tags')) col.tags = rsrc.tags;\n        return col;\n      });\n    }).extend();\n  });\n}\n\n\nexport function getDataSourceColumns(domain, ids) {\n  return store.getResources([domain]).then(rsrcs => {\n    return ids.map(d => rsrcs.find(e => e.id === d).columns)\n      .extend();\n  });\n}\n\n\n// Datatable on local IndexedDB\n\nexport function getAllTables() {\n  return store.getAllItems();\n}\n\n\nexport function getTablesByFormat(format) {\n  return store.getItemsByFormat(format);\n}\n\n\nexport function getTable(tableId) {\n  return store.getItemById(tableId);\n}\n\n\nexport function getRecords(tableId) {\n  return store.getItemById(tableId)\n    .then(tbl => tbl.records);\n}\n\n\nexport function getCurrentTable() {\n  const q = getGlobalConfig('urlQuery');\n  if (!q.hasOwnProperty('id')) return Promise.resolve();\n  return store.getItemById(q.id);\n}\n\n\nexport function getCurrentRecords() {\n  return getCurrentTable().then(tbl => tbl.records);\n}\n\n\nexport function setColumnsToShow(updates) {\n  return store.updateItem(getGlobalConfig('urlQuery').id, item => {\n    item.columns.forEach((col, i) => {\n      col.visible = updates.visibles.includes(col.key);\n      col.sort = updates.sorts[i];\n      col.digit = updates.digits[i];\n    });\n  });\n}\n\n\nexport function joinColumn(mapping, tableId=globalConfig.urlQuery.id) {\n  const cols = mapping.hasOwnProperty('column') ? mapping.column : mapping.columns;\n  return store.updateItem(tableId, item => {\n    item.records\n      .filter(rcd => mapping.mapping.hasOwnProperty(rcd[mapping.key]))\n      .forEach(rcd => {\n        if (mapping.hasOwnProperty('column')) {\n          rcd[mapping.column.key] = mapping.mapping[rcd[mapping.key]];\n        } else {\n          mapping.columns.forEach((col, i) => {\n            rcd[col.key] = mapping.mapping[rcd[mapping.key]][i];\n          });\n        }\n      });\n    item.columns = item.columns.concat(cols).unique('key');\n    item.lastUpdated = mapping.lastUpdated;\n  });\n}\n\n\nexport function updateTableAttribute(tblID, key, value) {\n  return store.updateItem(tblID, item => {\n    item[key] = value;\n  });\n}\n\n\nexport function insertTable(data) {\n  return store.putItem(data);\n}\n\n\nexport function updateTable(data) {\n  if (data === undefined) return Promise.resolve();  // No update\n  if (data.status === 'Failure') {  // No data found on server\n    return updateTableAttribute(data.id, 'status', 'Failure');\n  }\n  // update\n  return store.updateItem(data.id, item => {\n    const update = {\n      responseDate: data.responseDate,\n      records: data.records,\n      columns: data.columns,\n      recordCount: data.recordCount,\n      searchDoneCount: data.searchDoneCount,\n      execTime: data.execTime,\n      progress: data.progress,\n      status: data.status,\n    };\n    if (data.hasOwnProperty('lastUpdated')) {\n      update.lastUpdated = data.lastUpdated;\n    }\n    Object.assign(item, update);\n  });\n}\n\n\nexport function deleteTable(id) {\n  return store.deleteItem(id);\n}\n\n\nexport function reset() {\n  return store.reset();\n}\n","\nimport {\n  setGlobalConfig, localChemInstance, fetcherInstances, setResources\n} from './store/StoreConnection.js';\n\nconst localServer = localChemInstance();\n\n\nfunction initialize() {\n  if ('serviceWorker' in navigator && !debug) {\n    navigator.serviceWorker\n      .register('sw.js')\n      .then(registration => {\n        console.info(\n          'ServiceWorker registration successful with scope: ',\n          registration.scope\n        );\n      }).catch(err => {\n        console.info('ServiceWorker registration failed: ', err);\n      });\n  } else if (debug) {\n    console.info('Off-line mode is disabled for debugging');\n  } else {\n    console.info('Off-line mode is not supported');\n  }\n  const serverTmpl = localServer.templates().then(res => {\n    setGlobalConfig('templates', res.templates);\n  });\n  const serverConfig = localServer.status().then(res => {\n    setGlobalConfig('server', res);\n  });\n  // TODO: skip loader if there is already resources in the store\n  // 1. collate resource version\n  // 2. if no local resource or server resource is newer, fetch\n  const rsrcFetched = fetcherInstances()\n    .map(api => api.getResources())\n    .extendAsync().then(res => {\n      const indexed = res.map((e, i) => {\n        e.idx = i;\n        return e;\n      });\n      return setResources(indexed);\n    });\n  return Promise.all([serverTmpl, serverConfig, rsrcFetched]);\n}\n\n\nexport function loader() {\n  if (document.location.protocol === \"file:\") {\n    console.info('Off-line mode (local file)');\n    setGlobalConfig('onLine', false);\n    return Promise.resolve();\n  }\n  if ('onLine' in navigator) {\n    if (!navigator.onLine) {\n      console.info('Off-line mode (no internet connection)');\n      setGlobalConfig('onLine', false);\n      return Promise.resolve();\n    }\n  }\n  return fetch(`${localServer.baseURL}favicon.ico`)\n    .then(() => {\n      // HTTP 404\n      setGlobalConfig('onLine', true);\n      return initialize();\n    }).catch(() => {\n      console.info('Off-line mode (server not responding)');\n      setGlobalConfig('onLine', false);\n      return Promise.resolve();\n    });\n}\n","\n/** @module dataStructure */\n\n\nexport function columnMappingToTable(mapping) {\n  const keyCol = {\n    key: mapping.key,\n    name: mapping.key,\n    sort: 'text',\n    visible: true\n  };\n  const cols = mapping.hasOwnProperty('column') ? mapping.column : mapping.columns;\n  const tbl = {\n    columns: [keyCol].concat(cols),\n    records: Object.entries(mapping.mapping).map(entry => {\n      const rcd = {};\n      rcd[mapping.key] = entry[0];\n      if (mapping.hasOwnProperty('column')) {\n        rcd[mapping.column.key] = entry[1];\n      } else {\n        const colKeys = mapping.columns.map(col => col.key);\n        entry[1].forEach((val, i) => {\n          rcd[colKeys[i]] = val;\n        });\n      }\n      return rcd;\n    })\n  };\n  return tbl;\n}\n\n\nexport function csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    columns: [],\n    key: key,\n    mapping: {}\n  };\n  const headerIdx = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    mapping.columns.push({key: h, name: h, sort: 'text', visible: true});\n  });\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\nexport function singleToMultiMapping(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    columns: [mapping.column],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n","\nimport d3 from 'd3';\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nexport function formatNum(value, type) {\n  const conv = {\n    scientific: \".3e\",\n    si: \".3s\",\n    rounded: \".3r\"\n  };\n  if (type === 'raw') return value;\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(conv[type])(value) : value;\n}\n\nexport function partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\nexport function numericAsc(a, b) {\n  const fa = parseFloat(a);\n  const fb = parseFloat(b);\n  if (isNaN(fa) || isNaN(fb)) {\n    return String(b).localeCompare(String(a));\n  }\n  return fb - fa;\n}\n\n\nexport function numericDesc(a, b) {\n  return numericAsc(b, a);\n}\n\n\nexport function textAsc(a, b) {\n  return String(b).localeCompare(String(a));\n}\n\n\nexport function textDesc(a, b) {\n  return textAsc(b, a);\n}\n","\nexport function getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n","import vega from 'vega';\n\nexport function showPlot(vegaSpec, selector) {\n  new vega.View(vega.parse(vegaSpec))\n    .initialize(selector)\n    .run();\n\n}\n\nexport function plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n","\nimport d3 from 'd3';\nimport {\n  formatNum, numericAsc, textAsc, numericDesc, textDesc\n} from '../helper/formatValue.js';\n\n\nexport function selectOptions(selection, data, key, text) {\n  const options = selection.selectAll('option')\n    .data(data, key);\n  options.exit().remove();\n  options.enter().append('option')\n    .merge(options)\n      .attr('value', key)\n      .text(text);\n}\n\n\nexport function checkboxList(selection, data, name, key, text) {\n  const items = selection.selectAll('li').data(data, key);\n  items.exit().remove();\n  const entered = items.enter().append('li')\n    .attr('class', 'form-check')\n    .append('label');\n  entered.append('input');\n  entered.append('span');\n  const updated = entered.merge(items.select('label'))\n    .attr('class', 'form-check-label');\n  updated.select('input')\n    .attr('type', 'checkbox')\n    .attr('class', 'form-check-input')\n    .attr('name', name)\n    .attr('value', key);\n  updated.select('span')\n    .text(text);\n}\n\n\nexport function createTable(selection, tbl) {\n  // Header\n  if (!selection.select('thead').size()) {\n    selection.append('thead').append('tr');\n  }\n  // Records\n  if (!selection.select('tbody').size()) {\n    selection.append('tbody');\n  }\n  const cols = tbl.columns\n    .filter(e => !e.hasOwnProperty('visible') || e.visible !== false\n  );\n  const header = selection.select('thead tr').selectAll('th')\n    .data(cols, d => d.key);\n  header.exit().remove();\n  header.enter().append('th')\n    .merge(header)\n      .text(d => d.hasOwnProperty('name') ? d.name : d.key);\n}\n\n\nexport function updateTableRecords(selection, rcds, keyFunc) {\n  const header = selection.select('thead tr').selectAll('th')\n    .data();\n  const rowSelection = selection.select('tbody').selectAll('tr')\n    .data(rcds, keyFunc);\n  rowSelection.exit().remove();\n  const rowEntered = rowSelection.enter().append('tr');\n  rowEntered.selectAll('td')\n    .data(d => header.map(e => d[e.key]))\n    .enter().append('td');\n  rowEntered.merge(rowSelection)\n    .selectAll('td')\n    .classed('align-middle', true)\n    .html((d, i) => {\n      if (d === undefined) return '';\n      if (header[i].valueType === 'plot') return '[plot]';\n      if (header[i].valueType === 'image') return '[image]';\n      if (header[i].hasOwnProperty('digit') && header[i].digit !== 'raw') {\n        return formatNum(d, header[i].digit);\n      }\n      return d;\n    });\n}\n\n\nexport function appendTableRows(selection, rcds, keyFunc) {\n  const newRcds = selection.select('tbody').selectAll('tr').data();\n  Array.prototype.push.apply(newRcds, rcds);\n  updateTableRecords(selection, newRcds, keyFunc);\n}\n\n\nexport function addSort(selection) {\n  selection.select('thead tr').selectAll('th')\n    .filter(d => d.sort !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      const isNum = !d.hasOwnProperty('sort') || d.sort === 'numeric';\n      const cmp = isAsc\n        ? (isNum ? numericAsc : textAsc)\n        : (isNum ? numericDesc : textDesc);\n      selection.select('tbody').selectAll('tr')\n        .sort((a, b) => cmp(a[d.key], b[d.key]));\n      d3.select(`#sort-${d.key}`)\n        .text(isAsc ? '^' : 'v');\n    });\n}\n\n\nexport function formatNumbers(selection) {\n  // DEPRECATED: no longer used\n  selection.select('thead tr').selectAll('th')\n    .each((col, colIdx) => {\n      if (!col.hasOwnProperty('digit') || col.digit === 'raw') return;\n      selection.select('tbody').selectAll('tr')\n        .selectAll('td')\n          .filter((d, i) => i === colIdx)\n          .text(d => formatNum(d, col.digit));\n    });\n}\n","\nimport d3 from 'd3';\nimport {\n  formValue, formInt, formFloat, formChecked,\n  checkboxValues, selectedOptionValues, textareaLines,\n  firstFile, selectedCheckboxesData, selectedOptionData\n} from '../helper/d3Selection.js';\nimport {\n  csvToMapping, columnMappingToTable, singleToMultiMapping\n} from '../helper/dataStructure.js';\nimport {partialMatch} from '../helper/formatValue.js';\nimport {readFile} from '../helper/file.js';\nimport {getSDFPropList} from '../helper/parser.js';\nimport {plotThumbnail} from '../helper/image.js';\nimport {\n  localChemInstance, getFetcher, dataFetcherDomains, getGlobalConfig,\n  getResourceColumns, getDataSourceColumns, setColumnsToShow\n} from '../store/StoreConnection.js';\nimport {\n  checkboxList, selectOptions, createTable, updateTableRecords\n} from './Component.js';\n\nconst localServer = localChemInstance();\n\n\nfunction mergeDataSourceColumns(data) {\n  return getDataSourceColumns(data.domain, data.dataSource)\n  .then(cols => getFetcher(data.domain).formatResult(cols, data));\n}\n\n\nexport function pickDialog(rsrc, callback) {\n  d3.select('#pick-target')\n    .call(selectOptions, rsrc, d => d.entity, d => d.name)\n    .on('change', function () {\n      const rsrctbl = selectedOptionData(this);\n      d3.select('#pick-queryarea').text(rsrctbl.placeholders.ID);\n    });\n  d3.select('#pick-queryarea').text(rsrc[0].placeholders.ID);  // initial value\n  d3.select('#pick-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const query = {\n        method: 'chemsql',\n        targets: [formValue('#pick-target')],\n        key: 'ID',\n        values: textareaLines('#pick-queryarea'),\n        operator: 'fm'\n      };\n      return localServer.getRecords(query)\n        .then(mergeDataSourceColumns)\n        .then(callback);\n    });\n}\n\n\nexport function propDialog(rsrc, callback) {\n  d3.select('#prop-targets')\n    .call(checkboxList, rsrc, 'targets', d => d.entity, d => d.name)\n    .on('change', function () {\n      const cols = selectedCheckboxesData('#prop-targets')\n        .map(d => d.columns)\n        .extend().unique('key');\n      d3.select('#prop-key')\n        .call(selectOptions, cols, d => d.key, d => d.name);\n    });\n  d3.select('#prop-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const selectedColumn = selectedOptionData('#prop-key');\n      const query = {\n        method: selectedColumn.method,\n        targets: checkboxValues('#prop-targets'),\n        key: selectedColumn.key,\n        values: textareaLines('#prop-queryarea'),\n        operator: formValue('#prop-operator')\n      };\n      return localServer.getRecords(query)\n      .then(mergeDataSourceColumns)\n      .then(callback);\n    });\n}\n\n\nexport function structDialog(rsrc, callback) {\n  d3.select('#struct-qsrc')\n    .call(selectOptions, rsrc, d => d.entity, d => d.name);\n  d3.select('#struct-targets')\n    .call(checkboxList, rsrc, 'targets', d => d.entity, d => d.name);\n  d3.select('#struct-method').selectAll('option.rd')\n    .attr('disabled', getGlobalConfig('rdk') === true ? null : 'disabled');\n  d3.select('#struct-method')\n    .on('change', function () {\n      const op = d3.select(this.selectedOptions[0]);\n      d3.select('#struct-thldtype')\n        .attr('disabled', op.classed('thld') ? null : 'disabled')\n        .property('value', op.classed('edge') ? 'edge' : 'sim');\n      d3.select('#struct-thld')\n        .attr('disabled', op.classed('thld') ? null : 'disabled');\n      d3.select('#struct-thldtype option.sim')\n        .attr('disabled', op.classed('sim') ? null : 'disabled');\n      d3.select('#struct-thldtype option.edge')\n        .attr('disabled', op.classed('edge') ? null : 'disabled');\n      d3.select('#struct-options').selectAll('.gls')\n        .attr('disabled', op.classed('gls') ? null : 'disabled');\n      d3.select('#struct-options').selectAll('.fmcs')\n        .attr('disabled', this.value === 'rdfmcs' ? null : 'disabled');\n      d3.select('#struct-thld')\n        .attr('value', formValue('#struct-thldtype') === 'edge' ? 15 : 0.7)\n        .attr('min', formValue('#struct-thldtype') === 'edge' ? 5 : 0)\n        .attr('max', formValue('#struct-thldtype') === 'edge' ? 999 : 1.0)\n        .attr('step', formValue('#struct-thldtype') === 'edge' ? 1 : 0.01);\n    });\n  d3.select('#struct-thldtype')\n    .on('change', function () {\n      d3.select('#struct-thld')\n        .attr('value', this.value === 'edge' ? 15 : 0.7)\n        .attr('min', this.value === 'edge' ? 5 : 0)\n        .attr('max', this.value === 'edge' ? 999 : 1.0)\n        .attr('step', this.value === 'edge' ? 1 : 0.01);\n    });\n  d3.select('#struct-format')\n    .on('change', function () {\n      d3.select('#struct-qsrc')\n        .attr('disabled', this.value === 'dbid' ? null : 'disabled');\n    });\n  d3.select('#struct-preview')\n    .on('click', () => {\n      const fmt = formValue('#struct-format');\n      const query = {\n        format: fmt,\n        querySource: fmt === 'dbid' ? formValue('#struct-qsrc') : null,\n        value: fmt === 'molfile'\n          ? formValue('#struct-queryarea') : textareaLines('#struct-queryarea')[0],\n      };\n      return localServer.strprev(query)\n        .then(res => d3.select('#struct-image').html(res));\n    });\n  d3.select('#struct-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const mthdop = d3.select(d3.select('#struct-method').node().selectedOptions[0]);\n      const fmt = formValue('#struct-format');\n      const query = {\n        method: formValue('#struct-method'),\n        targets: checkboxValues('#struct-targets'),\n        format: fmt,\n        querySource: fmt === 'dbid' ? formValue('#struct-qsrc') : null,\n        value: fmt === 'molfile'\n          ? formValue('#struct-queryarea') : textareaLines('#struct-queryarea')[0],\n        thresholdType: formValue('#struct-thldtype'),\n        threshold: formFloat('#struct-thld'),\n        ignoreHs: formChecked('#struct-ignoreh'),\n        diameter: mthdop.classed('gls') ? formInt('#struct-diam') : null,\n        maxTreeSize: mthdop.classed('gls') ? formInt('#struct-tree') : null,\n        molSizeCutoff: mthdop.classed('gls') ? formInt('#struct-skip') : null,\n        timeout: mthdop.classed('rd') ? formInt('#struct-timeout') : null\n      };\n      return localServer.getRecords(query)\n        .then(mergeDataSourceColumns)\n        .then(callback);\n    });\n}\n\n\nexport function sdfDialog(callback) {\n  d3.select('#sdf-file')\n    .on('change', () => {\n      const reader = new FileReader();\n      const file = document.getElementById('sdf-file').files[0];\n      reader.onload = (e) => {\n        d3.select('#sdf-cols')\n          .call(checkboxList, getSDFPropList(e.target.result),\n                'columns', d => d, d => d\n          );\n      };\n      // Scan only first 100mb of the file due to memory limit.\n      reader.readAsText(file.slice(0, 100 * 1024 * 1024));\n    });\n  d3.select('#sdf-selectall')\n    .on('change', () => {\n      d3.select('#sdf-cols').selectAll('input')\n        .property('checked', formChecked('#sdf-selectall'));\n    });\n  d3.select('#sdf-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const query = {\n        contents: firstFile('#sdf-file'),\n        query: JSON.stringify({\n          columns: checkboxValues('#sdf-cols'),\n          implh: formChecked('#sdf-implh'),\n          recalc: formChecked('#sdf-recalc')\n        })\n      };\n      return localServer.importSDF(query).then(callback);\n    });\n}\n\nexport function columnDialog(tbl, callback) {\n  // TODO: need refactoring\n  const coltbl = {\n    columns: [\n      {key: 'name', sort: 'text', visible: true},\n      {key: 'visible', sort: 'text', visible: true},\n      {key: 'sort', sort: 'text', visible: true},\n      {key: 'digit', sort: 'numeric', visible: true}\n    ]\n  };\n  d3.select('#column-table thead').remove();\n  d3.select('#column-table tbody').remove();\n  d3.select('#column-table').call(createTable, coltbl)\n    .select('tbody').selectAll('tr')\n    .data(tbl.columns).enter().append('tr')\n    .each(function (row) {\n      d3.select(this).selectAll('td')\n        .data(d => coltbl.columns.map(e => d[e.key])).enter().append('td')\n        .each(function (cell, i) {\n          if (i === 0) {\n            d3.select(this).text(d => d);\n          } else if (i === 1) {\n            d3.select(this).classed('column-vis-select', true)\n              .append('input')\n                .attr('type', 'checkbox')\n                .attr('value', row.key)\n                .property('checked', d => d);\n          } else if (i === 2) {\n            d3.select(this).classed('column-sort-select', true)\n              .append('select')\n              .call(selectOptions,\n                    cell === 'none' ? ['none'] : ['numeric', 'text'], null, d => d)\n              .each(function (value) {\n                d3.select(this).selectAll('option')\n                  .property('selected', d => d === value);\n              });\n          } else if (i === 3) {\n            d3.select(this).classed('column-digit-select', true)\n              .append('select')\n              .call(selectOptions, ['raw', 'rounded', 'scientific', 'si'], null, d => d)\n              .each(function (value) {\n                d3.select(this).selectAll('option')\n                  .property('selected', d => d === value);\n              });\n            if (row.sort !== 'numeric') {\n              d3.select(this).select('select').attr('disabled', 'disabled');\n            }\n          }\n        });\n    });\n  d3.select('#column-table tbody').selectAll('tr')\n    .on('change', function () {\n        const sort = d3.select(this).select('.column-sort-select select').node().value;\n        d3.select(this).select('.column-digit-select select')\n          .attr('disabled', sort === 'numeric' ? null : 'disabled');\n    });\n  d3.select('#column-submit')\n    .on('click', () => {\n      const query = {\n        visibles: checkboxValues('.column-vis-select'),\n        sorts: selectedOptionValues('.column-sort-select'),\n        digits: selectedOptionValues('.column-digit-select')\n      };\n      return setColumnsToShow(query).then(callback);\n    });\n}\n\n\nexport function joinDialog(tbl, rcds, callback) {\n  const domains = dataFetcherDomains();\n  // Prevent implicit submission\n  document.getElementById('join-search')\n    .addEventListener('keypress', event => {\n      if (event.keyCode === 13) event.preventDefault();\n    });\n  return getResourceColumns(domains).then(rsrcs => {\n    const shownCols = tbl.columns.map(e => e.key);\n    d3.select('#join-keys')\n      .call(checkboxList, rsrcs.unique('key'), 'keys',\n            d => d.key, d => d.name)\n      .selectAll('li')\n      .each(function(d) { // disable already shown columns\n        const ex = shownCols.includes(d.key);\n        d3.select(this).selectAll('label').select('input')\n          .property('checked', ex)\n          .attr('disabled', ex ? 'disabled' : null);\n      });\n    d3.select('#join-search').on('keyup', function () {\n      const match = d => partialMatch(formValue(this), d.name);\n      d3.select('#join-keys').selectAll('li')\n        .style('visibility', d => match(d) ? null : 'hidden')\n        .style('position', d => match(d) ? null : 'absolute');\n    });\n    d3.select('#join-submit').on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const selectedCols = checkboxValues('#join-keys');\n      const mpgs = rsrcs\n        .filter(col => !shownCols.includes(col.key))\n        .filter(col => selectedCols.includes(col.key))\n        .map(col => {\n          const ids = rcds.map(row => row.ID);\n          const api = getFetcher(col.domain);\n          return api.getMapping(ids, col);\n        });\n      return Promise.all(mpgs).then(res => {\n        // callback(res.filter(e => Object.keys(e.mapping).length !== 0));\n        callback(res);\n      });\n    });\n  });\n}\n\n\nexport function importColDialog(tbl, callback) {\n  d3.select('#importcol-file')\n    .on('change', () => {\n      const file = document.getElementById('importcol-file').files[0];\n      const isCsv = file.name.split('.').pop() === 'csv';\n      readFile(file).then(res => {\n        const mapping = isCsv ? csvToMapping(res) : JSON.parse(res);\n        const tbl = columnMappingToTable(mapping);\n        d3.select('#importcol-preview').call(createTable, tbl)\n          .call(updateTableRecords,\n                tbl.records.slice(0, 5), d => d[tbl.columns[0].key]);\n        // bind mapping\n        d3.select('#importcol-preview').datum(mapping);\n      });\n    });\n  d3.select('#importcol-submit')\n    .on('click', () => {\n      let mapping = d3.select('#importcol-preview').datum();\n      d3.select('#importcol-preview').datum(null);  // unbind mapping\n      // Generate thumbnails\n      const plotCols = [];\n      if (mapping.hasOwnProperty('column')) {\n        mapping = singleToMultiMapping(mapping);\n      }\n      mapping.columns.forEach((e, i) => {\n        if (e.valueType === 'plot') {\n          mapping.columns[i].valueType = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        Promise.all(ps).then(() => callback([mapping]));\n      } else {\n        callback([mapping]);\n      }\n    });\n}\n\n\nexport function graphDialog(tbl, rcds, callback) {\n  d3.select('#graph-measure').selectAll('option.rd')\n    .attr('disabled', getGlobalConfig('rdk') === true ? null : 'disabled');\n  d3.select('#graph-measure')\n    .on('change', function () {\n      d3.select('#graph-options').selectAll('.gls')\n        .attr('disabled', this.value === 'gls' ? null : 'disabled');\n      d3.select('#graph-options').selectAll('.fmcs')\n        .attr('disabled', this.value === 'rdfmcs' ? null : 'disabled');\n    });\n  d3.select('#graph-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const mthdop = d3.select(d3.select('#graph-measure').node().selectedOptions[0]);\n      const query = {\n        measure: formValue('#graph-measure'),\n        indices: [],\n        molecules: [],\n        nodeTableId: tbl.id,\n        threshold: formFloat('#graph-thld'),\n        ignoreHs: formChecked('#graph-ignoreh'),\n        diameter: mthdop.node().value === 'gls' ? formInt('#graph-diam') : null,\n        maxTreeSize: mthdop.node().value === 'gls' ? formInt('#graph-tree') : null,\n        molSizeCutoff: mthdop.node().value === 'gls' ? formInt('#graph-skip') : null,\n        timeout: mthdop.classed('rd') ? formInt('#graph-timeout') : null\n      };\n      rcds.forEach(e => {\n        query.molecules.push(e._mol);\n        query.indices.push(e._index);\n      });\n      return localServer.getRecords(query).then(callback);\n    });\n}\n\n\nexport function graphConfigDialog(edges, callback) {\n  d3.select('#graphconfig-thld')\n    .attr('value', edges.networkThreshold)\n    .attr('max', 1.0)\n    .attr('min', edges.query.threshold);\n  d3.select('#graphconfig-submit')\n    .on('click', () => {\n      const newThld = formFloat('#graphconfig-thld');\n      if (newThld < edges.query.threshold) return;  // TODO: fool proof\n      callback(newThld);\n    });\n}\n\n\nexport function communityDialog(callback) {\n  d3.select('#community-name').attr('value', 'comm_');\n  d3.select('#community-submit')\n    .on('click', () => {\n      const query = {\n        name: formValue('#community-name'),\n        nulliso: formChecked('#community-nulliso')\n      };\n      callback(query);\n    });\n}\n","\nimport d3 from 'd3';\nimport {fetchable, abortRequestable} from '../helper/definition.js';\n\n\nexport function renderStatus(tbl, refresh_callback, abort_callback) {\n  d3.select('#loading-circle').style('display', 'none');\n  if (!tbl.hasOwnProperty('status')) tbl.status = 'Completed';\n  d3.select('title').text(tbl.name);\n  d3.select('#title').text(tbl.name);\n  d3.select('#refresh')\n    .text(tbl.status === 'Aborting' ? 'Abort requested' : 'Refresh')\n    .style('display', fetchable(tbl) ? 'inline-block' : 'none');\n  d3.select('#abort')\n    .style('display', abortRequestable(tbl) ? 'inline-block' : 'none');\n  const doneText = {\n    'datatable': 'entries found',\n    'connection': 'connections created'\n  };\n  const dtx = doneText[tbl.format];\n  d3.select('#progress')\n    .text(`(${tbl.status} - ${tbl.recordCount} ${dtx} in ${tbl.execTime} sec.)`);\n  if (tbl.status === 'In progress') {\n    d3.select('#progress').append('div').append('progress')\n      .attr('max', 100)\n      .attr('value', tbl.progress)\n      .text(`${tbl.progress}%`);\n  }\n  d3.select('#refresh').on('click', refresh_callback);\n  d3.select('#abort')\n    .on('click', () => {\n      d3.select('#confirm-message')\n        .text('Are you sure you want to abort this calculation job?');\n      d3.select('#confirm-submit')\n        .classed('btn-primary', false)\n        .classed('btn-warning', true)\n        .on('click', () => {\n          abort_callback();\n        });\n    });\n  console.info('Query');\n  console.info(tbl.query);  // query datails are available on browser console.\n}\n\n\nexport function initializeWithData() {\n  d3.select('#new-data').style('display', 'none');\n  d3.select('#loading-circle').style('display', 'none');\n}\n\n\nexport function initialize() {\n  d3.select('#data-control').style('display', 'none');\n  d3.select('#nodedata').style('display', 'none');\n  d3.select('#refresh').style('display', 'none');\n  d3.select('#abort').style('display', 'none');\n  d3.select('#loading-circle').style('display', 'none');\n  d3.select('#status').selectAll('li').style('display', 'none');\n}\n","\nimport d3 from 'd3';\nimport {\n  formatNum, numericAsc, textAsc, numericDesc, textDesc\n} from '../helper/formatValue.js';\nimport {showPlot} from '../helper/image.js';\n\n\nconst defaultColumnWidth = {\n  numeric: 120,\n  text: 200,\n  none: 200\n};\n\nconst defaultColumnHeight = {\n  numeric: 40,\n  text: 40,\n  none: 200\n};\n\n\nexport function createDataGrid(selection, tbl) {\n  // Header\n  if (!selection.select('div.dg-header').size()) {\n    selection.append('div').classed('dg-header', true);\n  }\n  // Body\n  if (!selection.select('div.dg-viewport').size()) {\n    selection.append('div').classed('dg-viewport', true)\n      .append('div').classed('dg-body', true);\n  }\n  const cols = tbl.columns\n    .filter(e => !e.hasOwnProperty('visible') || e.visible !== false)\n    .map(e => {\n      e.width = defaultColumnWidth[e.sort || 'numeric'];\n      e.height = defaultColumnHeight[e.sort || 'numeric'];\n      return e;\n    });\n  const rowSize = {\n    height: cols.reduce((a, b) => a.height > b.height ? a : b).height,\n    width: cols.reduce((a, b) => ({width: a.width + b.width})).width\n  };\n  selection.style('width', `${rowSize.width}px`);\n  selection.select('.dg-header').datum(rowSize);\n  const header = selection.select('.dg-header').selectAll('.dg-hcell')\n    .data(cols, d => d.key);\n  header.exit().remove();\n  header.enter().append('div')\n      .classed('dg-hcell', true)\n      .style('display', 'inline-block')\n    .merge(header)\n      .style('width', d => `${d.width}px`)\n      .text(d => d.hasOwnProperty('name') ? d.name : d.key);\n}\n\n\nfunction updateRows(selection, rcds, keyFunc, position, visibleRows) {\n  const rSize = selection.select('.dg-header').datum();\n  const cData = selection.select('.dg-header').selectAll('.dg-hcell')\n    .data();\n  const topPos = Math.min(position, Math.max(0, rcds.length - visibleRows + 1));\n  const bottomPos = topPos + visibleRows;\n  const rcdSlice = rcds.slice(topPos, Math.min(bottomPos, rcds.length));\n  const rowSelection = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(rcdSlice, keyFunc)\n      .style('height', `${rSize.height}px`);\n  rowSelection.exit().remove();\n  const rowEntered = rowSelection.enter().append('div')\n      .attr('class', 'dg-row')\n      .style('position', \"absolute\");\n  rowEntered.selectAll('.dg-cell')\n    .data(cData.map(e => e.width))\n    .enter().append('div')\n      .classed('dg-cell', true)\n      .classed('align-middle', true)\n      .style('display', 'inline-block')\n      .style('width', d => `${d}px`);\n  rowEntered.merge(rowSelection)\n    .order()\n    .each(function(d, ri) {\n      const rowPos = (position + ri) * rSize.height;\n      d3.select(this)\n        .style('transform', `translate(0px, ${rowPos}px)`)\n        .classed('odd', (position + ri) % 2 === 0)\n      .selectAll('.dg-cell')\n        .html(function(_, i) {\n          d3.select(this).attr('id', `c${ri}-${i}`);\n          const value = d[cData[i].key];\n          if (value === undefined) return '';\n          if (cData[i].valueType === 'plot') return '';\n          if (cData[i].valueType === 'image') {  // data URI\n            return `<img src=\"${value}\" width=\"180\" height=\"180\"/>`;\n          }\n          if (cData[i].hasOwnProperty('digit') && cData[i].digit !== 'raw') {\n            return formatNum(value, cData[i].digit);\n          }\n          return value;\n        })\n        .each(function(_, i) {\n          if (cData[i].valueType !== 'plot') return;\n          if (!d.hasOwnProperty(cData[i].key)) return;\n          const value = d[cData[i].key];\n          showPlot(value, `#c${ri}-${i}`);\n        });\n    });\n}\n\n\nexport function dataGridRecords(selection, rcds, keyFunc) {\n  const rSize = selection.select('.dg-header').datum();\n  const bodyHeight = rcds.length * rSize.height;\n  let position;\n  let visibleRows;\n  selection.select('.dg-body')\n    .style('height', `${bodyHeight}px`)\n    .style('position', \"relative\");\n  selection.select('.dg-viewport')\n    .style('overflow-y', 'auto')\n    .on('scroll', function() {\n      const scrollTop = d3.select(this).node().scrollTop;\n      const newPos = Math.min(Math.floor(scrollTop / rSize.height), rcds.length);\n      if (newPos !== position) {\n        position = newPos;\n        updateRows(selection, rcds, keyFunc, position, visibleRows);\n      }\n    });\n  d3.select(window)\n    .on('resize', function() {\n      const viewport = selection.select('.dg-viewport');\n      const viewportTop = viewport.node().getBoundingClientRect().top;\n      const viewportHeight = window.innerHeight - viewportTop - 5;\n      viewport.style('height', `${viewportHeight}px`);\n      const newVis = Math.ceil(viewportHeight / rSize.height) + 1;\n      if (newVis !== visibleRows) {\n        visibleRows = newVis;\n        viewport.dispatch('scroll');\n      }\n    })\n    .dispatch('resize');\n}\n\n\nexport function addSort(selection, rcds, keyFunc) {\n  selection.select('.dg-header').selectAll('.dg-hcell')\n    .filter(d => d.sort !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n      const isNum = !d.hasOwnProperty('sort') || d.sort === 'numeric';\n      const cmp = isAsc\n        ? (isNum ? numericAsc : textAsc)\n        : (isNum ? numericDesc : textDesc);\n      const sorted = rcds.sort((a, b) => cmp(a[d.key], b[d.key]));\n      dataGridRecords(selection, sorted, keyFunc);\n    });\n}\n","\nimport d3 from 'd3';\n\nimport {formValue} from './helper/d3Selection.js';\nimport {fetchable} from './helper/definition.js';\nimport {fetchJSON, loadJSON, downloadJSON, downloadDataFile} from './helper/file.js';\nimport {loader} from './Loader.js';\nimport {\n  getGlobalConfig, getFetcher, getResources, getDataSourceColumns,\n  localChemInstance, insertTable, updateTable, joinColumn,\n  getCurrentTable, getCurrentRecords, updateTableAttribute\n} from './store/StoreConnection.js';\nimport {pickDialog, structDialog, propDialog, sdfDialog,\n  columnDialog, importColDialog, joinDialog, graphDialog\n} from './component/Dialog.js';\nimport {renderStatus, initialize, initializeWithData} from './component/Header.js';\nimport {\n  createDataGrid, dataGridRecords, addSort\n} from './component/DataGrid.js';\nconst localServer = localChemInstance();\n\n\nfunction idLink(rcds, idKey) {\n  rcds.filter(e => e.hasOwnProperty(idKey))\n    .forEach(e => {\n      e[idKey] = `<a href=\"profile.html?compound=${e[idKey]}\" target=\"_blank\">${e[idKey]}</a>`;\n    });\n}\n\n\nfunction renderTableContents(tbl) {\n  return getCurrentRecords().then(rcds => {\n    const copied = JSON.parse(JSON.stringify(rcds));  // deep copy\n    idLink(copied, 'ID');\n    d3.select('#datatable')\n      .call(createDataGrid, tbl)\n      .call(dataGridRecords, copied, d => d._index)\n      .call(addSort, copied, d => d._index);\n    if (!getGlobalConfig('onLine')) return Promise.resolve();\n    graphDialog(tbl, rcds, res => {\n      res.networkThreshold = res.query.threshold;\n      return insertTable(res).then(() => {\n        d3.select('#loading-circle').style('display', 'none');\n        window.open(`graph.html?id=${res.id}`, '_blank');\n      });\n    });\n    joinDialog(tbl, rcds, mappings => {\n      return Promise.all(mappings.map(e => joinColumn(e))).then(render);\n    });\n  });\n}\n\n\nfunction render() {\n  return getCurrentTable().then(tbl => {\n    columnDialog(tbl, render);\n    importColDialog(tbl, colMaps => {\n      const joined = colMaps.map(mp => joinColumn(mp));\n      return Promise.all(joined).then(render);\n    });\n    renderStatus(tbl, refresh, abort);\n    d3.select('#rename')\n      .on('click', () => {\n        d3.select('#prompt-title').text('Rename table');\n        d3.select('#prompt-label').text('New name');\n        d3.select('#prompt-input').attr('value', tbl.name);\n        d3.select('#prompt-submit')\n          .on('click', () => {\n            const name = formValue('#prompt-input');\n            return updateTableAttribute(tbl.id, 'name', name)\n              .then(getCurrentTable)\n              .then(t => renderStatus(t, refresh, abort));\n          });\n      });\n    d3.select('#export')\n      .on('click', () => downloadJSON(tbl, tbl.name, true));\n    if (getGlobalConfig('onLine')) {\n      d3.select('#excel')\n        .on('click', () => {\n          const query = {json: new Blob([JSON.stringify(tbl)])};\n          return localServer.exportExcel(query)\n            .then(xhr => downloadDataFile(xhr, `${tbl.name}.xlsx`));\n        });\n      d3.select('#sdfile')\n        .on('click', () => {\n          const query = {json: new Blob([JSON.stringify(tbl)])};\n          return localServer.exportSDFile(query)\n            .then(xhr => downloadDataFile(xhr, `${tbl.name}.sdf`));\n        });\n    }\n    return renderTableContents(tbl);\n  });\n}\n\n\nd3.select('#import-json')\n  .on('click', () => document.getElementById('select-file').click());\nd3.select('#select-file')\n  .on('change', () => {\n    const file = document.getElementById('select-file').files[0];\n    loadJSON(file).then(loadNewTable);\n  });\n\n\nfunction loadNewTable(data) {\n  return insertTable(data).then(() => {\n    window.location = `datatable.html?id=${data.id}`;\n  });\n}\n\n\nfunction fetch_(command) {\n  return getCurrentTable().then(data => {\n    if (!fetchable(data)) return;\n    const queries = {id: data.id, command: command};\n    return localServer.getRecords(queries)\n      .then(res => {\n        return getDataSourceColumns(res.domain, res.dataSource)\n          .then(cols => getFetcher(res.domain).formatResult(cols, res));\n      }).then(updateTable);\n  });\n}\n\n\nfunction refresh() {\n  if (!getGlobalConfig('onLine')) return Promise.resolve();\n  return fetch_('update').then(isUpdated => {\n    if (isUpdated !== undefined) return render();\n  });\n}\n\n\nfunction abort() {\n  return fetch_('abort').then(isUpdated => {\n    if (isUpdated !== undefined) return render();\n  });\n}\n\n\nfunction run() {\n  if (getGlobalConfig('urlQuery').hasOwnProperty('location')) {\n    const url = getGlobalConfig('urlQuery').location;\n    return fetchJSON(url)\n      .then(tbl => insertTable(tbl).then(() => tbl.id))\n      .then(id => {\n        window.location = `datatable.html?id=${id}`;\n      });\n  }\n  return loader().then(() => {\n    if (!getGlobalConfig('onLine')) {\n      d3.selectAll('.online-command')\n        .style('color', '#cccccc')\n        .classed('disabled', true)\n        .on('click', () => d3.event.stopPropagation());\n    }\n    if (getGlobalConfig('urlQuery').hasOwnProperty('id')) {\n      initializeWithData();\n      return fetch_('update').then(render);\n    } else {\n      initialize();\n      sdfDialog(loadNewTable);\n      if (!getGlobalConfig('onLine')) return Promise.resolve();\n      return getResources('chemical').then(rsrc => {\n        pickDialog(rsrc, loadNewTable);\n        structDialog(rsrc, loadNewTable);\n        propDialog(rsrc, loadNewTable);\n      });\n    }\n  });\n}\nrun();\n","\nimport Dexie from 'Dexie';\n\n// TODO: can indexed records improve query performance ?\n// TODO: remove app table. no longer used\n\nconst schema = {\n  app: 'key',\n  items: 'id, format, responseDate',\n  resources: 'idx, id'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\nfunction getAppSetting(key) {\n  return idb.app.where('key').equals(key).first()\n    .then(res => {\n      if (res === undefined) return undefined;\n      return res.value;\n    });\n}\n\n\nfunction putAppSetting(k, v) {  // returns id in success\n  return idb.app.put({ key: k, value: v });\n}\n\n\nfunction getResources() {\n  return idb.resources.orderBy('idx')\n    .toArray();\n}\n\n\nfunction putResources(data) { // returns last id in success\n  return idb.resources.bulkPut(data);\n}\n\n\nfunction getAllItems() {\n  return idb.items.orderBy('responseDate').reverse()\n    .toArray();\n}\n\n\nfunction getItemsByFormat(format) {\n  return idb.items.where('format').equals(format).reverse()\n    .sortBy('responseDate');\n}\n\n\nfunction getItemById(tableId) {\n  return idb.items.where('id').equals(tableId).first();\n}\n\n\nfunction updateItem(tableId, callback) {  // returns num of updated items\n  return idb.items.where('id').equals(tableId).modify(callback);\n}\n\n\nfunction deleteItem(tableId) { // returns num of deleted items\n  return idb.items.where('id').equals(tableId).delete();\n}\n\n\nfunction putItem(data) { // returns id in success\n  return idb.items.put(data);\n}\n\n\nfunction reset() {\n  // Try this before tackling with local db troubles\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\nexport default {\n  getAppSetting, putAppSetting, getResources, putResources,\n  getAllItems, getItemsByFormat, getItemById,\n  updateItem, deleteItem, putItem, reset\n};\n","\nexport default class Fetcher {\n  constructor() {\n    this.baseURL = \"\";\n    this.available = false;\n  }\n\n  xhrRequest(url, formData=null, options={}) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open('method' in options ? options.method : 'POST', url);\n      xhr.responseType = 'responseType' in options ? options.responseType : 'json';\n      xhr.withCredentials = 'withCredentials' in options ? options.withCredentials : false;\n      xhr.onload = () => {\n        if (xhr.status !== 200) {\n          reject(xhr);\n        } else {\n          resolve(xhr.response);\n        }\n      };\n      xhr.send(formData);\n    });\n  }\n\n  now() {\n    const now = new Date();\n    return now.toString();\n  }\n\n  getResources() {\n    // required\n  }\n\n  formatResult(cols, data) {\n    // to be called by store.updateTable\n    // required for chemical domain\n    data.lastUpdated = this.now();\n    return data;\n  }\n\n  getRecords() {\n    // required\n  }\n\n  getRecordsByCompound() {\n    // required for activity domain\n  }\n\n  getMapping() {\n    // required for activity domain\n  }\n\n  getGraphEdges() {\n\n  }\n}\n","\nimport {default as Fetcher} from './Fetcher.js';\n\n\nexport class LocalServerActivity extends Fetcher {\n  constructor() {\n    super();\n    this.baseURL = './';\n    this.domain = 'activity';\n    this.entities = [];\n  }\n\n  serializedRequest(url, query={}) {\n    const formData = new FormData();\n    formData.set('query', JSON.stringify(query));\n    return fetch(`${this.baseURL}${url}`,\n      {method: 'post', body: formData, credentials: 'include'});\n  }\n\n  request(url, query={}) {\n    const formData = new FormData();\n    const qmap = new Map(Object.entries(query));\n    qmap.forEach((v, k) => {\n      if (Array.isArray(v)) {\n        v.forEach(e => formData.append(k, e));\n      } else {\n        formData.set(k, v);\n      }\n    });\n    return fetch(`${this.baseURL}${url}`,\n      {method: 'post', body: formData, credentials: 'include'});\n  }\n\n  getResources() {\n    return this.request('schema', {domain: this.domain})\n      .then(res => res.json())\n      .then(json => {\n        json.resources.forEach(rsrc => {\n          rsrc.domain = this.domain;\n          rsrc.columns.forEach(col =>{\n            if (!col.hasOwnProperty('name')) col.name = col.key;\n            if (!col.hasOwnProperty('dataColumn')) col.dataColumn = col.key;\n            if (!col.hasOwnProperty('method')) col.method = 'sql';\n            col.visible = true;\n          });\n          this.entities.push(rsrc.entity);\n        });\n        this.available = true;\n        return json.resources;\n      });\n  }\n\n  getRecords(queries) {\n    return this.serializedRequest('sql', queries)\n      .then(res => res.json())\n      .then(json => {\n        json.domain = this.domain;\n        return json;\n      });\n  }\n\n  getRecordsByCompound(compound) {\n    // TODO: this.entities\n    const query = {\n      method: 'sql',\n      targets: this.entities,\n      key: 'ID',\n      values: [compound],\n      operator: 'eq'\n    };\n    return this.getRecords(query);\n  }\n\n  getMapping(ids, column) {\n    const query = {\n      method: 'sql',\n      targets: [column.entity],\n      key: 'ID',\n      values: ids,\n      operator: 'fm'\n    };\n    return this.serializedRequest('sql', query)\n      .then(res => res.json())\n      .then(json => {\n        const mapping = {};\n        json.records.filter(row => row.hasOwnProperty(column.dataColumn))\n          .forEach(row => { mapping[row.ID] = row[column.dataColumn]; });\n        return {\n          key: query.key,\n          column: column,\n          mapping: mapping,\n          lastUpdated: this.now(),\n        };\n      });\n  }\n\n  status() {\n    return this.request('server').then(res => res.json());\n  }\n\n  templates() {\n    return this.request('templates').then(res => res.json());\n  }\n\n  strprev(query) {\n    return this.serializedRequest('strprev', query).then(res => res.text());\n  }\n\n  exportExcel(query) {\n    return this.request('xlsx', query).then(res => res.blob());\n  }\n\n  exportSDFile(query) {\n    return this.request('exportsdf', query).then(res => res.text());\n  }\n\n  reportPreview(query) {\n    return this.request('reportprev', query).then(res => res.json());\n  }\n\n  report(query) {\n    return this.request('report', query).then(res => res.blob());\n  }\n}\n\n\nexport class LocalServerChemical extends LocalServerActivity {\n  constructor() {\n    super();\n    this.domain = 'chemical';\n    this.hiddenColumns = [\"_mw\", \"_mw_wo_sw\", \"_formula\", \"_logp\", \"_nonH\"];\n  }\n\n  formatResult(cols, data) {\n    if (cols.length === 0) {  // sdf\n      data.columns.forEach(col => {\n        col.visible = this.hiddenColumns.includes(col.key) ? false : true;\n      });\n      return data;\n    }\n    Array.prototype.push.apply(data.columns, cols);\n    if (data.hasOwnProperty('extraColumns')) {\n      Array.prototype.push.apply(data.columns, data.extraColumns);\n      delete data.extraColumns;\n    }\n    data.columns.forEach(col => {\n      if (!col.hasOwnProperty('name')) col.name = col.key;\n      if (col.key === data.query.key) {\n        col.visible = true;  // Search key\n      } else {\n        col.visible = this.hiddenColumns.includes(col.key) ? false : true;\n      }\n    });\n    data.lastUpdated = this.now();\n    return data;\n  }\n\n  getResources() {\n    return this.request('schema', {domain: this.domain})\n      .then(res => res.json())\n      .then(json => {\n        json.resources.forEach(rsrc => {\n          rsrc.domain = this.domain;\n          rsrc.columns.forEach(col =>{\n            if (!col.hasOwnProperty('name')) col.name = col.key;\n            if (!col.hasOwnProperty('dataColumn')) col.dataColumn = col.key;\n            if (!col.hasOwnProperty('method')) col.method = 'chemsql';\n            col.visible = true;\n          });\n        });\n        this.available = true;\n        return json.resources;\n      });\n  }\n\n  getRecords(query) {\n    let url;\n    if (query.hasOwnProperty('command')) {\n      url = 'rows';\n    } else if (query.hasOwnProperty('nodeTableId')) {\n      url = 'graph';\n    } else if (['chemsql', 'sql'].includes(query.method)) {\n      url = 'sql';\n    } else {\n      url = 'compute';\n    }\n    return this.serializedRequest(url, query)\n      .then(res => res.json())\n      .then(json => {\n        json.domain = this.domain;\n        return json;\n      });\n  }\n\n  importSDF(query) {\n    return this.request('sdf', query)\n    .then(res => res.json())\n    .then(json => {\n      json.domain = this.domain;\n      json.columns.forEach(col =>{\n        col.visible = this.hiddenColumns.includes(col.key) ? false : true;\n      });\n      const now = new Date();\n      json.lastUpdated = now.toString();\n      return json;\n    });\n  }\n}\n","\nimport {default as Fetcher} from './Fetcher.js';\n\n\nexport class ScreenerFitting extends Fetcher {\n  constructor() {\n    super();\n    this.resourceFile = 'screener_fitting.yaml';\n    this.domain = null;\n    this.baseURL = null;\n  }\n\n  getResources() {\n    const formData = new FormData();\n    formData.set('filename', this.resourceFile);\n    return fetch('source', {method: 'post', body: formData, credentials: 'include'})\n      .then(res => res.json())\n      .then(json => {\n        if (json.hasOwnProperty('enabled') && json.enabled === false) return;\n        this.available = true;\n        this.domain = json.domain;\n        this.baseURL = json.url;\n        return json.resources.map(rsrc => {\n          rsrc.domain = json.domain;\n          rsrc.entity = `${rsrc.qcsRefId}:${rsrc.layerIndex}`;\n          delete rsrc.qcsRefId;\n          delete rsrc.layerIndex;\n          rsrc.columns.forEach(col => {\n            if (!col.hasOwnProperty('name')) col.name = col.key;\n            if (!col.hasOwnProperty('dataColumn')) col.dataColumn = col.key;\n            col.visible = true;\n          });\n          return rsrc;\n        });\n    });\n  }\n\n  request(queryString) {\n    return fetch(`${this.baseURL}${queryString}`, {\n      method: 'GET',\n      credentials : 'include'\n    }).then(res => res.json());\n  }\n\n  requestRecords(queryString) {\n    return this.request(queryString)\n      .then(json => {\n        const rcds = json.compounds.map(c => {\n          return {\n            ID: c.compoundId,\n            qcsRefId: c.qcsRefId,\n            layerIndex: c.layerIndex,\n            drcPlot: c.fitting.drcPlot,\n            AC50: c.fitting.linearAC50,\n            hill: Math.round(c.fitting.hillCoefficient * 100) / 100\n          };\n        });\n        return { records: rcds };\n      });\n  }\n\n  getRecords(q) {\n    const joinedIds = q.qcsRefIds.join('%2C');\n    const queryString = `/compounds?qcsRefIds=${joinedIds}\\\n&layerIndices=${q.layerIndex - 1}\\\n&fields=compoundId%2Cfitting.drcPlot%2Cfitting.linearAC50%2Cfitting.hillCoefficient`;\n    return this.requestRecords(queryString);\n  }\n\n  getRecordsByCompound(compound) {\n    const queryString = `/compounds?q=compoundId%3A${compound}\\\n&fields=compoundId%2CqcsRefId%2ClayerIndex\\\n%2Cfitting.drcPlot%2Cfitting.linearAC50%2Cfitting.hillCoefficient`;\n    return this.requestRecords(queryString);\n  }\n\n  getMapping(ids, column) {\n    const refid_layer = column.entity.split(':');\n    const query = {\n      qcsRefId: refid_layer[0],\n      layerIndex: parseInt(refid_layer[1])\n    };\n    return this.getRecords(query).then(res => {\n      const mapping = {};\n      res.records.filter(row => ids.includes(row.ID))\n        .forEach(row => { mapping[row.ID] = row[column.dataColumn]; });\n      return {\n        key: 'ID',\n        column: column,\n        mapping: mapping,\n        lastUpdated: this.now()\n      };\n    });\n  }\n\n  getDrcPlot(compoundId, plotId, min = -20, max = 120) {\n    // compoundResult.fitting.drcPlot -> drcPlots/idstring\n    // returns image/png\n    const queryString = `/${plotId}?width=180&height=180&title=compoundId\\\n&activityRangeMin=${min}&activityRangeMax=${max}`;\n    return this.request(queryString);\n  }\n\n  getQcsInfo(qcsRefIds) {\n    const ids = qcsRefIds.map(e => `qcsRefId:${e}`).join(' OR ');\n    const queryString = `/qcSessions?q=${ids}`;\n    return this.request(queryString).then(res => res.qcSessions);\n  }\n}\n\n\nexport class ScreenerRawValue extends ScreenerFitting{\n  constructor() {\n    super();\n    this.resourceFile = 'screener_rawvalue.yaml';\n  }\n\n  getResources() {\n    const formData = new FormData();\n    formData.set('filename', this.resourceFile);\n    return fetch('source', {method: 'post', body: formData, credentials: 'include'})\n      .then(res => res.json())\n      .then(json => {\n        if (json.hasOwnProperty('enabled') && json.enabled === false) return;\n        this.available = true;\n        this.domain = json.domain;\n        this.baseURL = json.url;\n        return json.resources.map(rsrc => {\n          rsrc.domain = json.domain;\n          rsrc.entity = `${rsrc.qcsRefId}:${rsrc.layerIndex}`;\n          delete rsrc.qcsRefId;\n          delete rsrc.layerIndex;\n          rsrc.columns.forEach(col => {\n            col.key = 'rawValue';\n            if (!col.hasOwnProperty('name')) col.name = col.key;\n            if (!col.hasOwnProperty('dataColumn')) col.dataColumn = col.key;\n            col.visible = true;\n          });\n          return rsrc;\n        });\n      });\n  }\n\n  requestRecords(queryString, pred) {\n    return this.request(queryString).then(res => {\n      const rcds = res.plates.filter(plt => plt.wells.hasOwnProperty('compoundIds'))\n        .map(plt => {\n          return plt.wells.compoundIds.map((c, i) => {\n            return {\n              ID: c,\n              qcsRefId: plt.qcsRefId,\n              layerIndex: plt.layerIndex,\n              rawValue: plt.wells.rawValues[i]\n            };\n          }).filter(pred);\n        }).extend();\n      return { records: rcds };\n    });\n  }\n\n  getRecords(q) {\n    const joinedIds = q.qcsRefIds.join('%2C');\n    const queryString = `/plates?qcsRefIds=${joinedIds}\\\n&layerIndices=${q.layerIndex - 1}\\\n&limit=200\\\n&fields=wells.rawValues%2Cwells.compoundIds`;\n    return this.requestRecords(queryString, e => e.ID !== null);\n  }\n\n  getRecordsByCompound(compound) {\n    const queryString = `/plates?q=wells.compoundIds%3A${compound}\\\n&fields=wells.rawValues%2Cwells.compoundIds`;\n    return this.requestRecords(queryString, e => e.ID === compound);\n  }\n}\n\n\n/*\nfunction request(query) {\n  return store.getDBResources('activity')\n    .then(rsrc => {\n      const url = `${rsrc.find(e => e.id === 'screenerapi').url}${query}`;\n      return server.request(url, null, {\n        method: 'GET',\n        responseType: 'json',\n        withCredentials : true\n      });\n    });\n}\n\n\nfunction getRawValuesByQcs(qcsRefIds, layerIndex) {\n  const joined = qcsRefIds.join('%2C');\n  const query = `/plates?qcsRefIds=${joined}\\\n&layerIndices=${layerIndex - 1}\\\n&limit=200\\\n&fields=wells.rawValues%2Cwells.compoundIds`;\n  return request(query).then(res => {\n    const rcds = [];\n    res.plates.forEach(plt => {\n      if (!plt.wells.hasOwnProperty('compoundIds')) return;  // unmapped\n      const values = plt.wells.compoundIds.map((c, i) => {\n        if (c !== null) return { ID: c, rawValue: plt.wells.rawValues[i]};\n      }).filter(e => e !== undefined);\n      Array.prototype.push.apply(rcds, values);\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      records: rcds\n    };\n  });\n}\nexports.getRawValuesByQcs = getRawValuesByQcs;\n\n\nfunction getRawValuesMappingColumn(qcsRefIds, layerIndex, compoundIds) {\n  const joined = qcsRefIds.join('%2C');\n  const query = `/plates?qcsRefIds=${joined}\\\n&layerIndices=${layerIndex - 1}\\\n&limit=200\\\n&fields=wells.rawValues%2Cwells.compoundIds`;\n  return request(query).then(res => {\n    const mapping = {};\n    res.plates.forEach(plt => {\n      if (!plt.wells.hasOwnProperty('compoundIds')) return;  // unmapped\n      plt.wells.compoundIds.forEach((c, i) => {\n        if (compoundIds.includes(c)) {\n          mapping[c] = plt.wells.rawValues[i];\n        }\n      });\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      mapping: mapping\n    };\n  });\n}\nexports.getRawValuesMappingColumn = getRawValuesMappingColumn;\n\n\nfunction getRawValuesByCompound(compoundId) {\n  const query = `/plates?q=wells.compoundIds%3A${compoundId}\\\n&fields=wells.rawValues%2Cwells.compoundIds`;\n  return request(query).then(res => {\n    const rcds = [];\n    res.plates.forEach(plt => {\n      if (!plt.wells.hasOwnProperty('compoundIds')) return;  // unmapped\n      const i = plt.wells.compoundIds.findIndex(c => c === compoundId);\n      rcds.push({\n        qcsRefId: plt.qcsRefId,\n        layerIndex: plt.layerIndex,\n        rawValue: plt.wells.rawValues[i]\n      });\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      records: rcds\n    };\n  });\n}\nexports.getRawValuesByCompound = getRawValuesByCompound;\n\n\nfunction getFittingByQcs(qcsRefIds, layerIndex) {\n  const joined = qcsRefIds.join('%2C');\n  const query = `/compounds?qcsRefIds=${joined}\\\n&layerIndices=${layerIndex - 1}\\\n&fields=compoundId%2Cfitting.drcPlot%2Cfitting.linearAC50%2Cfitting.hillCoefficient`;\n  return request(query).then(res => {\n    const rcds = res.compounds.map(c => {\n      return {\n        ID: c.compoundId,\n        drcPlot: c.fitting.drcPlot,\n        AC50: c.fitting.linearAC50,\n        hill: Math.round(c.fitting.hillCoefficient * 100) / 100\n      };\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      records: rcds\n    };\n  });\n}\nexports.getFittingByQcs = getFittingByQcs;\n\n\nfunction getAC50MappingColumn(qcsRefIds, layerIndex, compoundIds) {\n  const joined = qcsRefIds.join('%2C');\n  const query = `/compounds?qcsRefIds=${joined}\\\n&layerIndices=${layerIndex - 1}\\\n&fields=compoundId%2Cfitting.linearAC50`;\n  return request(query).then(res => {\n    const mapping = {};\n    res.compounds.forEach(c => {\n      if (compoundIds.includes(c.compoundId)) {\n        mapping[c] = c.fitting.linearAC50;\n      }\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      mapping: mapping\n    };\n  });\n}\nexports.getAC50MappingColumn = getAC50MappingColumn;\n\n\nfunction getFittingByCompound(compoundId) {\n  const query = `/compounds?q=compoundId%3A${compoundId}\\\n&fields=compoundId%2CqcsRefId%2ClayerIndex\\\n%2Cfitting.drcPlot%2Cfitting.linearAC50%2Cfitting.hillCoefficient`;\n  return request(query).then(res => {\n    const rcds = res.compounds.map(c => {\n      return {\n        ID: c.compoundId,\n        drcPlot: c.fitting.drcPlot,\n        AC50: c.fitting.linearAC50,\n        hill: Math.round(c.fitting.hillCoefficient * 100) / 100,\n        qcsRefId: c.qcsRefId,\n        layerIndex: c.layerIndex\n      };\n    });\n    const now = new Date();\n    return {\n      created: now.toString(),\n      records: rcds\n    };\n  });\n}\nexports.getFittingByCompound = getFittingByCompound;\n\n\nfunction getDrcPlot(compoundId, plotId, min = -20, max = 120) {\n  const query = `/${plotId}?width=180&height=180&title=compoundId\\\n&activityRangeMin=${min}&activityRangeMax=${max}`;\n  return request(query);\n}\nexports.getDrcPlot = getDrcPlot;\n\n\nfunction getQcsInfo(qcsRefIds) {\n  const ids = qcsRefIds.map(e => `qcsRefId:${e}`).join(' OR ');\n  const query = `/qcSessions?q=${ids}`;\n  return request(query).then(res => res.qcSessions);\n}\nexports.getQcsInfo = getQcsInfo;\n\nfunction getAllResults(qcsRefId, layerIdx) {\n  const query = `/plates?qcsRefIds=${qcsRefId}\\\n&layerIndices=${layerIdx}\\\n&limit=200\\\n&fields=barcode%2CzPrime%2CwellTypes%2Cwells.rawValues%2Cwells.compoundIds`;\n  return request(query, res => res);\n}\nexports.getAllResults = getAllResults;\n\n\nfunction getPlateStats(allResults) {\n  const plates = allResults.plates;\n  const parsed = plates.map(p => {\n    const lowMean = p.wellTypes.NEUTRAL_CONTROL.mean;\n    const lowStdDev = p.wellTypes.NEUTRAL_CONTROL.sd;\n    const highMean = p.wellTypes.INHIBITOR_CONTROL.mean;\n    const highStdDev = p.wellTypes.INHIBITOR_CONTROL.sd;\n    return {\n      barcode: p.barcode,\n      lowCtrlMean: lowMean,\n      lowCtrlStdDev: lowStdDev,\n      lowCtrlCV: lowStdDev / lowMean * 100,\n      highCtrlMean: highMean,\n      highCtrlStdDev: highStdDev,\n      highCtrlCV: highStdDev / highMean * 100,\n      SignalBackground: lowMean / highMean,\n      zPrime: p.zPrime\n    };\n  });\n  return parsed;\n}\nexports.getPlateStats = getPlateStats;\n\n\nfunction getWellValues(allResults) {\n  const plates = allResults.plates;\n  const results = {};\n  plates.forEach(p => {\n    p.wells.compoundIds.forEach((value, i) => {\n      if (value !== null) {\n        results[value] = p.wells.rawValues[i];\n      }\n    });\n  });\n  return results;\n}\nexports.getWellValues = getWellValues;\n\n\nfunction getFirstPlateValues(qcsRefId, layerIdxs) {\n  const query = `/plates?qcsRefIds=${qcsRefId}\\\n&layerIndices=${layerIdxs}\\\n&q=plateIndex%3A0\\\n&fields=layerIndex%2CzPrime%2CwellTypes%2Cwells.rawValues%2Cwells.compoundIds`;\n  return request(query, res => {\n    const results = {};\n    res.plates.forEach(p => {\n      const idx = p.layerIndex;\n      p.wells.compoundIds.forEach(value => {\n        if (value !== null) {\n          if (!results.hasOwnProperty(value)) {\n            results[value] = {};\n          }\n          results[value][idx] = p.wells.rawValues[idx];\n        }\n      });\n    });\n  });\n}\nexports.getFirstPlateValues = getFirstPlateValues;\n*/\n","\nimport {ScreenerFitting, ScreenerRawValue} from './Screener.js';\n\n\nexport class ScreenerFittingStub extends ScreenerFitting {\n  constructor() {\n    super();\n    this.resourceFile = 'screener_fitting_stub.yaml';\n  }\n\n  fittingStub(q) {\n    if (typeof q.qcsRefId !== 'string') throw `${q.qcsRefId} is not a string`;\n    if (typeof q.layerIndex !== 'number') throw `${q.layerIndex} is not a number`;\n    return [\n      {ID: 'DB00189', drcPlot: 'dummy1', AC50: 2.1e-6, hill: 1.1, source: 'target1_validation'},\n      {ID: 'DB00193', drcPlot: 'dummy2', AC50: 4.2e-6, hill: null, source: 'target1_validation'},\n      {ID: 'DB00203', drcPlot: 'dummy3', AC50: 1.0e-5, hill: 0.9, source: 'target1_validation'},\n      {ID: 'DB00865', drcPlot: 'dummy4', AC50: 8.8e-8, hill: 2.1, source: 'target1_validation'},\n      {ID: 'DB01143', drcPlot: 'dummy5', AC50: 'n.d.', hill: null, source: 'target1_validation'},\n      {ID: 'DB01240', drcPlot: 'dummy6', AC50: null, hill: null, source: 'target1_validation'}\n    ];\n  }\n\n  getRecords(q) {\n    return Promise.resolve({ records: this.fittingStub(q) });\n  }\n\n  getRecordsByCompound(compound) {\n    const rcds = this.fittingStub({qcsRefId: 'QCS-YYYY', layerIndex: 1})\n      .filter(e => e.ID === compound);\n    return Promise.resolve({ records: rcds });\n  }\n\n  qcsInfoStub(ids) {\n    if (!Array.isArray(ids)) throw `${ids} is not a string`;\n    const layers = [\n      {layerIndex: 0, name: 'Activity%'},\n      {layerIndex: 1, name: 'Background%'},\n      {layerIndex: 2, name: 'Correction'}\n    ];\n    return [\n      {qcsRefId: 'QCS-XXX0', name: 'hoge', layers: layers},\n      {qcsRefId: 'QCS-XXX1', name: 'fuga', layers: layers},\n      {qcsRefId: 'QCS-XXX2', name: 'piyo', layers: layers}\n    ];\n  }\n\n  getQcsInfo(qcsRefIds) {\n    return Promise.resolve(this.qcsInfoStub(qcsRefIds));\n  }\n}\n\n\nexport class ScreenerRawValueStub extends ScreenerRawValue {\n  constructor() {\n    super();\n    this.resourceFile = 'screener_rawvalue_stub.yaml';\n  }\n\n  rawValueStub(q) {\n    if (typeof q.qcsRefId !== 'string') throw `${q.qcsRefId} is not a string`;\n    if (typeof q.layerIndex !== 'number') throw `${q.layerIndex} is not a number`;\n    return [\n        {ID: 'DB00189', rawValue: 12.7, source: 'target1_screen'},\n        {ID: 'DB00193', rawValue: 43.6, source: 'target1_screen'},\n        {ID: 'DB00203', rawValue: 102.6, source: 'target1_screen'},\n        {ID: 'DB00865', rawValue: -0.6, source: 'target1_screen'},\n        {ID: 'DB01143', rawValue: 50, source: 'target1_screen'},\n        {ID: 'DB01240', rawValue: null, source: 'target1_screen'}\n    ];\n  }\n\n  getRecords(q) {\n    return Promise.resolve({ records: this.rawValueStub(q) });\n  }\n\n  getRecordsByCompound(compound) {\n    const rcds = this.rawValueStub({qcsRefId: 'QCS-XXXX', layerIndex: 1})\n      .filter(e => e.ID === compound);\n    return Promise.resolve({ records: rcds });\n  }\n}\n"],"names":["formValue","selector","d3","select","node","value","formInt","parseInt","formFloat","parseFloat","formChecked","checked","firstFile","files","checkboxValues","selectAll","nodes","map","e","selectedOptionValues","textareaLines","split","filter","length","selectedOptionData","si","property","data","find","d","i","selectedCheckboxesData","fetchable","tbl","includes","status","abortRequestable","dataSourceId","domain","resource","column","capitalize","join","readFile","file","sizeLimit","blob","Promise","resolve","reject","reader","FileReader","truncated","slice","onload","event","target","result","onerror","error","readAsArrayBuffer","readAsText","parseJSON","compressed","text","pako","inflate","to","JSON","parse","loadJSON","name","endsWith","then","fetchJSON","url","fetch","res","arrayBuffer","json","downloadDataFile","window","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","downloadJSON","compress","str","stringify","gzip","getGlobalConfig","key","globalConfig","setGlobalConfig","localChemInstance","API","get","getFetcher","fetcherInstances","Array","from","values","dataFetcherDomains","forEach","v","k","push","getResources","domains","store","rsrcs","setResources","putResources","getResourceColumns","rsrc","columns","col","id","entity","hasOwnProperty","tags","extend","getDataSourceColumns","ids","getCurrentTable","q","getItemById","getCurrentRecords","records","setColumnsToShow","updates","updateItem","item","visible","visibles","sort","sorts","digit","digits","joinColumn","mapping","tableId","urlQuery","cols","rcd","concat","unique","lastUpdated","updateTableAttribute","tblID","insertTable","putItem","updateTable","undefined","update","responseDate","recordCount","searchDoneCount","execTime","progress","Object","assign","initialize","navigator","debug","serviceWorker","register","registration","console","info","scope","catch","err","serverTmpl","localServer","templates","serverConfig","rsrcFetched","api","extendAsync","idx","all","loader","location","protocol","onLine","baseURL","columnMappingToTable","keyCol","entries","entry","colKeys","val","csvToMapping","csvString","lines","header","shift","created","Date","toString","headerIdx","h","line","singleToMultiMapping","newMapping","m","formatNum","type","conv","scientific","rounded","Number","isNaN","format","partialMatch","query","toUpperCase","indexOf","numericAsc","b","fa","fb","String","localeCompare","numericDesc","textAsc","textDesc","getSDFPropList","re","uniqCols","Set","arr","exec","add","showPlot","vegaSpec","vega","View","run","plotThumbnail","toImageURL","selectOptions","selection","options","exit","remove","enter","append","merge","attr","checkboxList","items","entered","updated","createTable","size","updateTableRecords","rcds","keyFunc","rowSelection","rowEntered","classed","html","valueType","mergeDataSourceColumns","dataSource","formatResult","pickDialog","callback","call","on","rsrctbl","this","placeholders","ID","style","method","targets","operator","getRecords","propDialog","selectedColumn","structDialog","op","selectedOptions","fmt","querySource","strprev","mthdop","thresholdType","threshold","ignoreHs","diameter","maxTreeSize","molSizeCutoff","timeout","sdfDialog","getElementById","contents","implh","recalc","importSDF","columnDialog","coltbl","each","row","cell","joinDialog","addEventListener","keyCode","preventDefault","shownCols","ex","match","selectedCols","mpgs","getMapping","importColDialog","isCsv","pop","datum","plotCols","ps","p","img","graphDialog","measure","indices","molecules","nodeTableId","_mol","_index","renderStatus","refresh_callback","abort_callback","dtx","datatable","connection","initializeWithData","createDataGrid","width","defaultColumnWidth","height","defaultColumnHeight","rowSize","reduce","updateRows","position","visibleRows","rSize","cData","topPos","Math","min","max","bottomPos","rcdSlice","order","ri","rowPos","_","dataGridRecords","bodyHeight","scrollTop","newPos","floor","viewport","viewportTop","getBoundingClientRect","top","viewportHeight","innerHeight","newVis","ceil","dispatch","addSort","isAsc","isNum","cmp","sorted","idLink","idKey","renderTableContents","copied","networkThreshold","open","mappings","render","colMaps","joined","mp","refresh","abort","t","exportExcel","xhr","exportSDFile","loadNewTable","fetch_","command","queries","isUpdated","schema","app","resources","idb","Dexie","version","stores","getAppSetting","where","equals","first","putAppSetting","put","orderBy","toArray","bulkPut","getAllItems","reverse","getItemsByFormat","sortBy","modify","deleteItem","delete","Fetcher","[object Object]","available","formData","XMLHttpRequest","responseType","withCredentials","response","send","now","LocalServerActivity","super","entities","FormData","set","body","credentials","Map","isArray","request","dataColumn","serializedRequest","compound","LocalServerChemical","hiddenColumns","prototype","apply","extraColumns","ScreenerFitting","resourceFile","enabled","qcsRefId","layerIndex","queryString","compounds","c","compoundId","drcPlot","fitting","AC50","linearAC50","hill","round","hillCoefficient","qcsRefIds","requestRecords","refid_layer","plotId","qcSessions","ScreenerRawValue","pred","plates","plt","wells","compoundIds","rawValue","rawValues","ScreenerFittingStub","source","fittingStub","layers","qcsInfoStub","ScreenerRawValueStub","rawValueStub","server","search","substring","chemical","activity","screenerrawvalue","screenerfitting","screenerrawvaluestub","screenerfittingstub","numeric","none","click","stopPropagation"],"mappings":"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"}